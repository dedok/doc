





<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2. Internals</title>
    <link rel="icon" type="image/png" sizes="192x192"
          href="/theme/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32"
          href="/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96"
          href="/theme/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16"
          href="/theme/favicon/favicon-16x16.png">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.1',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          // Replace PAGE_URL with your page's canonical URL variable
          // this.page.url = PAGE_URL;
          this.page.identifier = "dev_guide/internals_index";
          this.language = "ru"
      };
    </script>
    <script id="dsq-count-scr" src="https://tarantooldb.disqus.com/count.js" async/></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/headers.js"></script>
    <script type="text/javascript" src="../_static/jquery.sticky-kit.min.js"></script>
    <script type="text/javascript" src="/js/menu.js"></script>
    <script type="text/javascript" src="/js/mobile_menu.js"></script>
    <link rel="stylesheet" href="/theme/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="../_static/sphinx_design.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design b-doc-dev_guide/internals_index">
  
    <div class="b-wrapper">
      <!-- HEADER > -->
      
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search" action="../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

        </nav>
      </div>
      
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      </nav>
    </div>
  </header>

      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
    <div class="b-block-wrapper">
      <h2
      
        class="b-section-title b-ellipsis toggle-navigation"
      
        title="2. Internals">
          2. Internals
      </h2>
  <div class="b-doc-language_selector">
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../dev_guide/internals_index.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>
  </div>
</div>
  </section>
  
    <div class="b-cols_content b-clearbox">
      <div class="b-cols_content_left">
        <div class="b-menu-toc">
          
<form id="searchbox" role="search" class="search b-search" action="../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Общие сведения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#an-application-server-together-with-a-database-manager">An application server together with a database manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#database-features">Database features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Вопросы и ответы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/lua_tutorials.html">1. Lua tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#insert-one-million-tuples-with-a-lua-stored-procedure">1.1. Insert one million tuples with a Lua stored procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#configure">1.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#delimiter">1.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-returns-a-string">1.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-calls-another-function-and-sets-a-variable">1.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-one-letter-random-string">1.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-ten-letter-random-string">1.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#make-a-tuple-out-of-a-number-and-a-string">1.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-tuple-into-the-database">1.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-million-tuples-into-the-database">1.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#tutorial-sum-a-json-field-for-all-tuples">1.2. Tutorial: Sum a JSON field for all tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#indexed-pattern-search">1.3. Indexed pattern search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/c_tutorial.html">2. C tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/c_tutorial.html#c-stored-procedures">2.1. C stored procedures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../book/index.html">User's Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../book/intro.html">1. Предисловие</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/intro.html#how-to-read-the-documentation">1.1. Как пользоваться документацией</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/intro.html#getting-in-touch-with-the-tarantool-community">1.2. Как связаться с сообществом разработчиков Tarantool'а</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/user_guide_getting_started.html">2. Начало работы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Скачивание и установка бинарного пакета</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Первичный запуск Tarantool'а и создание базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#connecting-remotely">2.3. Установка удаленного соединения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/box/index.html">3. Функционал СУБД</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#data-model">3.1. Data model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#space">3.1.1. Пространство</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#tuple-set">3.1.2. Tuple set</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#index">3.1.3. Индекс</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#data-types">3.1.4. Типы данных</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#operations">3.1.5. Операции</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#persistence">3.1.6. Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#data-manipulation">3.1.7. Манипулирование данными</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#index-operations">3.1.8. Операции с индексами</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#the-box-library">3.2. Библиотека &quot;box&quot;</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#transaction-control">3.3. Transaction control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#cooperative-multitasking-environment">3.3.1. Среда взаимной многозадачности</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#example">3.3.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#implicit-yields">3.3.2. Implicit yields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#access-control">3.4. Ограничение доступа</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#passwords">3.4.1. Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#users-and-the-user-space">3.4.2. Users and the _user space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#privileges-and-the-priv-space">3.4.3. Privileges and the _priv space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#functions-and-the-func-space">3.4.4. Functions and the _func space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#box-session-and-security">3.4.5. box.session and security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#roles">3.4.6. Roles</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#example-showing-a-role-within-a-role">3.4.6.1. Example showing a role within a role</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#triggers">3.5. Триггеры</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#connection-triggers">3.5.1. Connection triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#id1">3.5.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#authentication-triggers">3.5.2. Authentication triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#lua-module.box.space">3.5.3. Replace triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#id2">3.5.3.1. Пример</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#another-example">3.5.3.2. Another example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#getting-a-list-of-triggers">3.5.4. Getting a list of triggers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#limitations">3.6. Ограничения</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/index.html#vinyl-storage-engine">3.7. Vinyl storage engine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#differences-between-memtx-and-vinyl-storage-engines">3.7.1. Различия между движками memtx и vinyl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#vinyl-features">3.7.2. Vinyl features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/index.html#under-the-hood">3.7.3. А что там &quot;под капотом&quot;?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#inserting-the-first-200-000-keys">3.7.3.1. Inserting the first 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#inserting-the-next-300-000-keys">3.7.3.2. Inserting the next 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#inserting-the-next-200-000-keys">3.7.3.3. Inserting the next 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#inserting-the-last-300-000-keys">3.7.3.4. Inserting the last 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/index.html#reading-million-keys">3.7.3.5. Reading million keys</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/app_server.html">4. Application server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#about-modules-rocks">4.1. About modules/rocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#installing-an-existing-module">4.2. Установка существующего модуля</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-new-lua-module-locally">4.3. Создание нового модуля на языке Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-new-c-c-module-locally">4.4. Создание нового модуля на языке C/C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-mixed-lua-c-module-locally">4.5. Создание нового модуля на смеси языков Lua/C</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#tips-for-special-situations">4.6. Примечания для особых случаев</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#cookbook-recipes">4.7. Cookbook recipes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/administration.html">5. Администрирование серверной части</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#using-tarantool-as-a-client">5.1. Использование tarantool в качестве клиента</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#conventions-used-in-this-section">5.1.1. Условные обозначения, используемые в этом разделе</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#options-when-starting-client-from-the-command-line">5.1.2. Параметры запуска клиента из командной строки</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#tokens-requests-and-special-key-combinations">5.1.3. Токены, запросы и специальные комбинации клавиш</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#requests">5.1.4. Запросы</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#utility-tarantoolctl">5.2. Утилита tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#configuration-for-tarantoolctl">5.2.1. Конфигурирование tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#commands-for-tarantoolctl">5.2.2. Команды для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#typical-code-snippets-for-tarantoolctl">5.2.3. Примеры кода для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#a-detailed-example-for-tarantoolctl">5.2.4. Подробный пример для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#an-example-for-tarantoolctl-connect">5.2.5. An example for tarantoolctl connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#administrative-ports">5.3. Administrative ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#administrative-requests">5.4. Служебные запросы</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#server-introspection">5.5. Просмотр состояния сервера</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#lua-module.box.cfg">5.5.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#lua-module.box.info">5.5.2. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#lua-module.box.slab">5.5.3. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#submodule-box-stat">5.5.4. Submodule <cite>box.stat</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#replication">5.6. Репликация</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#replication-architecture">5.6.1. Архитектура механизма репликации</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#setting-up-a-master">5.6.2. Setting up a master</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#setting-up-a-replica">5.6.3. Настройка сервера-реплики</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#recovering-from-a-degraded-state">5.6.4. Восстановление после сбоя</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#quick-startup-of-a-new-simple-two-server-cluster">5.6.5. Quick startup of a new simple two-server cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#monitoring-a-replica-s-actions">5.6.6. Мониторинг действий реплики</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#preventing-duplicate-actions">5.6.7. Предотвращение дублирующихся действий</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#master-master-replication">5.6.8. Репликация по схеме master-master</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#all-the-what-if-questions">5.6.9. Ответы на вопросы &quot;Что если?&quot;</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#hands-on-replication-tutorial">5.6.10. Практическое руководство по репликации</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#backups">5.7. Резервное копирование</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#cold-backup">5.7.1. Cold backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#continuous-remote-backup">5.7.2. Continuous remote backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#hot-backup">5.7.3. Hot backup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#updates-upgrades">5.8. Updates/upgrades</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#updating-tarantool-in-production">5.8.1. Обновление Tarantool'а в условиях эксплуатации</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#upgrading-a-tarantool-database">5.8.2. Upgrading a Tarantool database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#server-signal-handling">5.9. Обработка сигналов от сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#process-title">5.10. Название процесса</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#system-specific-administration-notes">5.11. Заметки по администрированию для разных платформ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#debian-gnu-linux-and-ubuntu">5.11.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#fedora-rhel-centos">5.11.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#freebsd">5.11.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#mac-os-x">5.11.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#notes-for-systemd-users">5.12. Заметки для пользователей systemd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#instance-management">5.12.1. Управление экземплярами</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#creating-instances">5.12.1.1. Создание экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#starting-instances">5.12.1.2. Запуск экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#monitoring-instances">5.12.1.3. Мониторинг экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#attaching-to-instances">5.12.1.4. Подсоединение к экземплярам</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#checking-logs">5.12.1.5. Проверка журнала</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#stopping-instances">5.12.1.6. Остановка экземпляров</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#daemon-supervision">5.12.2. Контроль за фоновыми программами</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#customizing-the-service-file">5.12.3. Правка настроек сервисного файла</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#debugging">5.12.4. Отладка</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#precautions">5.12.5. Особые указания</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/connectors/index.html">6. Коннекторы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#protocol">6.1. Протокол</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#packet-example">6.2. Пример пакета данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#setting-up-the-server-for-connector-examples">6.3. Настройка окружения для примеров работы с коннекторами</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#java">6.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#go">6.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#r">6.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#perl">6.7. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#php">6.8. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#python">6.9. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#c">6.10. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/connectors/index.html#example-1">6.10.1. Пример 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/connectors/index.html#example-2">6.10.2. Пример 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#interpreting-function-return-values">6.11. Интерпретация возвращаемых значений</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/app/a_errcodes.html">7. Приложение A. Коды ошибок</a></li>
<li class="toctree-l2"><a class="reference internal" href="../book/app/g_changes.html">8. Appendix B. Version-specific changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/app/g_changes.html#changes-in-tarantool-version-1-7">8.1. Изменения в версии Tarantool 1.7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_lua/index.html">1. Library reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box.html">1.1. Module <cite>box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_schema.html">1.1.1. Вложенный модуль <cite>box.schema</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_space.html">1.1.2. Вложенный модуль <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_space.html#example-use-box-space-functions-to-read-space-tuples">1.1.2.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">1.1.2.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_index.html">1.1.3. Вложенный модуль <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#example-showing-use-of-the-box-functions">1.1.3.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#example-showing-a-user-defined-iterator">1.1.3.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">1.1.3.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_session.html">1.1.4. Вложенный модуль <cite>box.session</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_session.html#example">1.1.4.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_tuple.html">1.1.5. Вложенный модуль <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_tuple.html#example">1.1.5.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_introspection.html">1.1.6. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_introspection.html#lua-module.box.info">1.1.7. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_introspection.html#lua-module.box.slab">1.1.8. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_introspection.html#submodule-box-stat">1.1.9. Submodule <cite>box.stat</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/triggers.html">1.1.10. Connection triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/triggers.html#example">1.1.10.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/triggers.html#authentication-triggers">1.1.11. Authentication triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/triggers.html#lua-module.box.space">1.1.12. Replace triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/triggers.html#id1">1.1.12.1. Пример</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/triggers.html#another-example">1.1.12.2. Another example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/triggers.html#getting-a-list-of-triggers">1.1.13. Getting a list of triggers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/console.html">1.3. Module <cite>console</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/crypto.html">1.4. Module <cite>crypto</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#incremental-methods-in-the-crypto-module">1.4.1. Incremental methods in the crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">1.4.2. Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/csv.html">1.5. Module <cite>csv</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/digest.html">1.6. Module <cite>digest</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#incremental-methods-in-the-digest-module">1.6.1. Incremental methods in the digest module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#example">1.6.2. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_error.html">1.7. Submodule <cite>box.error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber.html">1.8. Module <cite>fiber</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber.html#example-of-fiber-use">1.8.1. Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html">1.9. Submodule <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#example">1.9.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fio.html">1.10. Module <cite>fio</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-pathname-manipulations">1.10.1. Common pathname manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-file-manipulations">1.10.2. Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fun.html">1.11. Module <cite>fun</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/jit.html">1.12. Module <cite>jit</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/json.html">1.13. Module <cite>json</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/json.html#configuration-settings">1.13.1. Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/log.html">1.14. Module <cite>log</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/log.html#example">1.14.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/msgpack.html">1.15. Module <cite>msgpack</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/msgpack.html#example">1.15.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/net_box.html">1.16. Module <cite>net.box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/net_box.html#example-showing-use-of-most-of-the-net-box-methods">1.16.1. Example showing use of most of the net.box methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_once.html">1.17. Function <cite>box.once</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/os.html">1.18. Module <cite>os</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/pickle.html">1.19. Module <cite>pickle</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/socket.html">1.20. Module <cite>socket</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/socket.html#example">1.20.1. Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">1.20.1.1. Use of a TCP socket over the Internet</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-udp-socket-on-localhost">1.20.1.2. Use of a UDP socket on localhost</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">1.20.1.3. Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/strict.html">1.21. Module <cite>strict</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tap.html">1.22. Module <cite>tap</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/tap.html#example">1.22.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tarantool.html">1.23. Module <cite>tarantool</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/uuid.html">1.24. Module <cite>uuid</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/uuid.html#example">1.24.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/yaml.html">1.25. Module <cite>yaml</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/yaml.html#example">1.25.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/other.html">1.26. Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_rock/index.html">2. Rocks reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/dbms.html">2.1. SQL DBMS Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#mysql-example">2.1.1. MySQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#installation">2.1.1.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-luarocks">2.1.1.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-github">2.1.1.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#connecting">2.1.1.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#how-to-ping">2.1.1.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#executing-a-statement">2.1.1.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#closing-connection">2.1.1.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#example">2.1.1.6. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#postgresql-example">2.1.2. PostgreSQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id1">2.1.2.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id2">2.1.2.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id3">2.1.2.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id4">2.1.2.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id5">2.1.2.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id6">2.1.2.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id7">2.1.2.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id8">2.1.2.6. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/expirationd.html">2.2. Module <cite>expirationd</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/shard.html">2.3. Module <cite>shard</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-one-shard">2.3.1. Example: shard.init syntax for one shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-three-shards">2.3.2. Example: shard.init syntax for three shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-minimal-configuration">2.3.3. Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-scaling-out">2.3.4. Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/tdb.html">2.4. Module <cite>tdb</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#debugger-commands">2.4.1. Debugger Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#example-session">2.4.2. Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration/index.html">3. Configuration reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#command-options">3.1. Command options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#uri">3.2. URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#initialization-file">3.3. Initialization file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#configuration-parameters">3.4. Configuration parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#basic-parameters">3.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#configuring-the-storage">3.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#snapshot-daemon">3.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#binary-logging-and-snapshots">3.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#replication">3.4.5. Replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#networking">3.4.6. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#logging">3.4.7. Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor's Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="reference_capi/index.html">1. C API reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/box.html">1.1. Module <cite>box</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/coio.html">1.3. Module <cite>coio</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/error.html">1.4. Module <cite>error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/fiber.html">1.5. Module <cite>fiber</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/box_index.html">1.6. Module <cite>index</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/latch.html">1.7. Module <cite>latch</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/utils.html">1.8. Module <cite>lua/utils</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/say.html">1.9. Module <cite>say</cite> (logging)</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/schema.html">1.10. Module <cite>schema</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/trivia.html">1.11. Module <cite>trivia/config</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/tuple.html">1.12. Module <cite>tuple</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/txn.html">1.13. Module <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2. Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tarantool-s-binary-protocol">2.1. Бинарный протокол в Tarantool'е</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#notion-in-diagrams">2.1.1. Обозначения на диаграммах</a></li>
<li class="toctree-l4"><a class="reference internal" href="#greeting-packet">2.1.2. Greeting packet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unified-packet-structure">2.1.3. Unified packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authentication">2.1.4. Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requests">2.1.5. Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#response-packet-structure">2.1.6. Response packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replication-packet-structure">2.1.7. Replication packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xlog-snap">2.1.8. XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-persistence-and-the-wal-file-format">2.2. Data persistence and the WAL file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-snapshot-file-format">2.3. The snapshot file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-recovery-process">2.4. The recovery process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-startup-with-replication">2.5. Server startup with replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_contribute_index.html">3. Build and contribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html">3.1. Сборка из исходных файлов</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_documentation.html">3.2. Сборка документации</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_management.html">3.3. Работа с релизами</a><ul>
<li class="toctree-l4"><a class="reference internal" href="release_management.html#how-to-make-a-minor-release">3.3.1. How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="guidelines_index.html">4. Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developer_guidelines.html">4.1. Соглашения по разработке</a><ul>
<li class="toctree-l4"><a class="reference internal" href="developer_guidelines.html#how-to-work-on-a-bug">4.1.1. How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="documentation_guidelines.html">4.2. Соглашения по документации</a><ul>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#markup-issues">4.2.1. Markup issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#wrapping-text">4.2.1.1. Wrapping text</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#formatting-code-snippets">4.2.1.2. Formatting code snippets</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#using-separated-links">4.2.1.3. Using separated links</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#creating-labels-for-local-links">4.2.1.4. Creating labels for local links</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#making-comments">4.2.1.5. Making comments</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#language-and-style-issues">4.2.2. Language and style issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#us-vs-british-spelling">4.2.2.1. US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#examples-and-templates">4.2.3. Examples and templates</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#module-and-function">4.2.3.1. Module and function</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#module-class-and-method">4.2.3.2. Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="c_style_guide.html">4.3. Соглашения по разработке на языке C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="c_style_guide.html#general-guidelines">4.3.1. General guidelines</a><ul>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#commenting-style">4.3.1.1. Commenting style</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#header-files">4.3.1.2. Header files</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#allocating-memory">4.3.1.3. Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#other">4.3.1.4. Other</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="c_style_guide.html#linux-kernel-coding-style">4.3.2. Linux kernel coding style</a><ul>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-1-indentation">4.3.2.1. Chapter 1: Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-2-breaking-long-lines-and-strings">4.3.2.2. Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-3-placing-braces-and-spaces">4.3.2.3. Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-3-1-spaces">4.3.2.4. Chapter 3.1:  Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-4-naming">4.3.2.5. Chapter 4: Naming</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-5-typedefs">4.3.2.6. Chapter 5: Typedefs</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-6-functions">4.3.2.7. Chapter 6: Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-7-centralized-exiting-of-functions">4.3.2.8. Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-8-commenting">4.3.2.9. Chapter 8: Commenting</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-9-you-ve-made-a-mess-of-it">4.3.2.10. Chapter 9: You've made a mess of it</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-10-kconfig-configuration-files">4.3.2.11. Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-11-data-structures">4.3.2.12. Chapter 11: Data structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-12-macros-enums-and-rtl">4.3.2.13. Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-13-printing-kernel-messages">4.3.2.14. Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-14-allocating-memory">4.3.2.15. Chapter 14: Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-15-the-inline-disease">4.3.2.16. Chapter 15: The inline disease</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-16-function-return-values-and-names">4.3.2.17. Chapter 16: Function return values and names</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-17-don-t-re-invent-the-kernel-macros">4.3.2.18. Chapter 17:  Don't re-invent the kernel macros</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#chapter-18-editor-modelines-and-other-cruft">4.3.2.19. Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l5"><a class="reference internal" href="c_style_guide.html#appendix-i-references">4.3.2.20. Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python_style_guide.html">4.4. Соглашения по разработке на языке Python</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#introduction">4.4.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">4.4.2. A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#code-lay-out">4.4.3. Code lay-out</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#indentation">4.4.3.1. Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#tabs-or-spaces">4.4.3.2. Tabs or Spaces?</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#maximum-line-length">4.4.3.3. Maximum Line Length</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#blank-lines">4.4.3.4. Blank Lines</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#encodings-pep-263">4.4.3.5. Encodings (PEP 263)</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#imports">4.4.3.6. Imports</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#whitespace-in-expressions-and-statements">4.4.4. Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#pet-peeves">4.4.4.1. Pet Peeves</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#other-recommendations">4.4.4.2. Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#comments">4.4.5. Comments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#block-comments">4.4.5.1. Block Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#inline-comments">4.4.5.2. Inline Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#documentation-strings">4.4.5.3. Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#version-bookkeeping">4.4.6. Version Bookkeeping</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#naming-conventions">4.4.7. Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#descriptive-naming-styles">4.4.7.1. Descriptive: Naming Styles</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#prescriptive-naming-conventions">4.4.7.2. Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#names-to-avoid">4.4.7.2.1. Names to Avoid</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#package-and-module-names">4.4.7.2.2. Package and Module Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#class-names">4.4.7.2.3. Class Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#exception-names">4.4.7.2.4. Exception Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#global-variable-names">4.4.7.2.5. Global Variable Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#function-names">4.4.7.2.6. Function Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#function-and-method-arguments">4.4.7.2.7. Function and method arguments</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#method-names-and-instance-variables">4.4.7.2.8. Method Names and Instance Variables</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#constants">4.4.7.2.9. Constants</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#designing-for-inheritance">4.4.7.2.10. Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#references">4.4.8. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#copyright">4.4.9. Copyright</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="b-cols_content_right">
        <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="index.html"
             class="b-path-list-item-url b-ellipsis">
            Contributor's Guide
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="2. Internals" class="b-path_current b-ellipsis">
          2. Internals
        </div>
      </li>
      
    </ul>
  </div>

  <div class="section" id="internals">
<h1>2. Internals<a class="headerlink" href="#internals" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="tarantool-s-binary-protocol">
<span id="box-protocol-iproto-protocol"></span><h2>2.1. Бинарный протокол в Tarantool'е<a class="headerlink" href="#tarantool-s-binary-protocol" title="Ссылка на этот заголовок">¶</a></h2>
<p>Бинарный протокол в Tarantool'е -- это бинарный протокол для обмена запросами и ответами.</p>
<div class="section" id="notion-in-diagrams">
<h3>2.1.1. Обозначения на диаграммах<a class="headerlink" href="#notion-in-diagrams" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre><span></span>0    X
+----+
|    | - X байт
+----+
 TYPE - тип переменной из библиотеки MsgPack (если это объект из библиотеки MsgPack)

+====+
|    | - объект из библиотеки MsgPack, динамически изменяемого размера
+====+
 TYPE - тип переменной из библиотеки MsgPack

+~~~~+
|    | - массив/сопоставление из библиотеки MsgPack, динамически изменяемого размера
+~~~~+
 TYPE - тип переменной из библиотеки MsgPack
</pre></div>
</div>
<p>Типы данных из библиотеки MsgPack:</p>
<ul class="simple">
<li><p class="first"><strong>MP_INT</strong> - целое число (integer)</p>
</li>
<li><p class="first"><strong>MP_MAP</strong> - соответствие (map)</p>
</li>
<li><p class="first"><strong>MP_ARR</strong> - массив (array)</p>
</li>
<li><p class="first"><strong>MP_STRING</strong> - строка (string)</p>
</li>
<li><p class="first"><strong>MP_FIXSTR</strong> - строка фиксированной длины (fixed size string)</p>
</li>
<li><p class="first"><strong>MP_OBJECT</strong> - объект типа MsgPack (MsgPack object)</p>
</li>
</ul>
</div>
<div class="section" id="greeting-packet">
<h3>2.1.2. Greeting packet<a class="headerlink" href="#greeting-packet" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre><span></span>TARANTOOL&#39;S GREETING:

0                                     63
+--------------------------------------+
|                                      |
| Tarantool Greeting (server version)  |
|               64 bytes               |
+---------------------+----------------+
|                     |                |
| BASE64 encoded SALT |      NULL      |
|      44 bytes       |                |
+---------------------+----------------+
64                  107              127
</pre></div>
</div>
<p>The server begins the dialogue by sending a fixed-size (128 bytes) text greeting
to the client. The greeting always contains two 64 byte lines of ASCII text, each
line ending with newline character ('\n'). The first line contains the server
version and protocol type. The second line contains up to 44 bytes of base64-encoded
random string, to use in authentication packet, and ends with up to 23 spaces.</p>
</div>
<div class="section" id="unified-packet-structure">
<h3>2.1.3. Unified packet structure<a class="headerlink" href="#unified-packet-structure" title="Ссылка на этот заголовок">¶</a></h3>
<p>Once a greeting is read, the protocol becomes pure request/response and features
a complete access to Tarantool functionality, including:</p>
<ul class="simple">
<li>request multiplexing, e.g. ability to asynchronously issue multiple requests
via the same connection</li>
<li>response format that supports zero-copy writes</li>
</ul>
<p>For data structuring and encoding, the protocol uses msgpack data format, see
<a class="reference external" href="http://msgpack.org">http://msgpack.org</a></p>
<p>Tarantool protocol mandates use of a few integer constants serving as keys in
maps used in the protocol. These constants are defined in <a class="reference external" href="https://github.com/tarantool/tarantool/blob/1.7/src/box/iproto_constants.h">src/box/iproto_constants.h</a></p>
<p>Let's list them here too:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-- user keys
&lt;code&gt;          ::= 0x00
&lt;sync&gt;          ::= 0x01
&lt;schema_id&gt;     ::= 0x05
&lt;space_id&gt;      ::= 0x10
&lt;index_id&gt;      ::= 0x11
&lt;limit&gt;         ::= 0x12
&lt;offset&gt;        ::= 0x13
&lt;iterator&gt;      ::= 0x14
&lt;key&gt;           ::= 0x20
&lt;tuple&gt;         ::= 0x21
&lt;function_name&gt; ::= 0x22
&lt;username&gt;      ::= 0x23
&lt;expression&gt;    ::= 0x27
&lt;ops&gt;           ::= 0x28
&lt;data&gt;          ::= 0x30
&lt;error&gt;         ::= 0x31
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>-- -- Value for &lt;code&gt; key in request can be:
-- User command codes
&lt;select&gt;  ::= 0x01
&lt;insert&gt;  ::= 0x02
&lt;replace&gt; ::= 0x03
&lt;update&gt;  ::= 0x04
&lt;delete&gt;  ::= 0x05
&lt;call&gt;    ::= 0x06
&lt;auth&gt;    ::= 0x07
&lt;eval&gt;    ::= 0x08
&lt;upsert&gt;  ::= 0x09
-- Admin command codes
&lt;ping&gt;    ::= 0x40

-- -- Value for &lt;code&gt; key in response can be:
&lt;OK&gt;      ::= 0x00
&lt;ERROR&gt;   ::= 0x8XXX
</pre></div>
</div>
<p>Both <code class="code docutils literal"><span class="pre">&lt;header&gt;</span></code> and <code class="code docutils literal"><span class="pre">&lt;body&gt;</span></code> are msgpack maps:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Request/Response:

0        5
+--------+ +============+ +===================================+
| BODY + | |            | |                                   |
| HEADER | |   HEADER   | |               BODY                |
|  SIZE  | |            | |                                   |
+--------+ +============+ +===================================+
  MP_INT       MP_MAP                     MP_MAP
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>UNIFIED HEADER:

+================+================+=====================+
|                |                |                     |
|   0x00: CODE   |   0x01: SYNC   |    0x05: SCHEMA_ID  |
| MP_INT: MP_INT | MP_INT: MP_INT |  MP_INT: MP_INT     |
|                |                |                     |
+================+================+=====================+
                          MP_MAP
</pre></div>
</div>
<p>They only differ in the allowed set of keys and values, the key defines the type
of value that follows. If a body has no keys, entire msgpack map for the body
may be missing. Such is the case, for example, in &lt;ping&gt; request. <code class="docutils literal"><span class="pre">schema_id</span></code>
may be absent in request's header, that means that there'll be no version
checking, but it must be present in the response. If <code class="docutils literal"><span class="pre">schema_id</span></code> is sent in
the header, then it'll be checked.</p>
</div>
<div class="section" id="authentication">
<span id="box-protocol-authentication"></span><h3>2.1.4. Authentication<a class="headerlink" href="#authentication" title="Ссылка на этот заголовок">¶</a></h3>
<p>When a client connects to the server, the server responds with a 128-byte
text greeting message. Part of the greeting is base-64 encoded session salt -
a random string which can be used for authentication. The length of decoded
salt (44 bytes) exceeds the amount necessary to sign the authentication
message (first 20 bytes). An excess is reserved for future authentication
schemas.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>PREPARE SCRAMBLE:

    LEN(ENCODED_SALT) = 44;
    LEN(SCRAMBLE)     = 20;

prepare &#39;chap-sha1&#39; scramble:

    salt = base64_decode(encoded_salt);
    step_1 = sha1(password);
    step_2 = sha1(step_1);
    step_3 = sha1(salt, step_2);
    scramble = xor(step_1, step_3);
    return scramble;

AUTHORIZATION BODY: CODE = 0x07

+==================+====================================+
|                  |        +-------------+-----------+ |
|  (KEY)           | (TUPLE)|  len == 9   | len == 20 | |
|   0x23:USERNAME  |   0x21:| &quot;chap-sha1&quot; |  SCRAMBLE | |
| MP_INT:MP_STRING | MP_INT:|  MP_STRING  | MP_STRING | |
|                  |        +-------------+-----------+ |
|                  |                   MP_ARRAY         |
+==================+====================================+
                        MP_MAP
</pre></div>
</div>
<p><code class="code docutils literal"><span class="pre">&lt;key&gt;</span></code> holds the user name. <code class="code docutils literal"><span class="pre">&lt;tuple&gt;</span></code> must be an array of 2 fields:
authentication mechanism (&quot;chap-sha1&quot; is the only supported mechanism right now)
and password, encrypted according to the specified mechanism. Authentication in
Tarantool is optional, if no authentication is performed, session user is 'guest'.
The server responds to authentication packet with a standard response with 0 tuples.</p>
</div>
<div class="section" id="requests">
<h3>2.1.5. Requests<a class="headerlink" href="#requests" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li>SELECT: CODE - 0x01
Find tuples matching the search pattern</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>SELECT BODY:

+==================+==================+==================+
|                  |                  |                  |
|   0x10: SPACE_ID |   0x11: INDEX_ID |   0x12: LIMIT    |
| MP_INT: MP_INT   | MP_INT: MP_INT   | MP_INT: MP_INT   |
|                  |                  |                  |
+==================+==================+==================+
|                  |                  |                  |
|   0x13: OFFSET   |   0x14: ITERATOR |   0x20: KEY      |
| MP_INT: MP_INT   | MP_INT: MP_INT   | MP_INT: MP_ARRAY |
|                  |                  |                  |
+==================+==================+==================+
                          MP_MAP
</pre></div>
</div>
<ul class="simple">
<li>INSERT:  CODE - 0x02
Inserts tuple into the space, if no tuple with same unique keys exists. Otherwise throw <em>duplicate key</em> error.</li>
<li>REPLACE: CODE - 0x03
Insert a tuple into the space or replace an existing one.</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>INSERT/REPLACE BODY:

+==================+==================+
|                  |                  |
|   0x10: SPACE_ID |   0x21: TUPLE    |
| MP_INT: MP_INT   | MP_INT: MP_ARRAY |
|                  |                  |
+==================+==================+
                 MP_MAP
</pre></div>
</div>
<ul class="simple">
<li>UPDATE: CODE - 0x04
Update a tuple</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>UPDATE BODY:

+==================+=======================+
|                  |                       |
|   0x10: SPACE_ID |   0x11: INDEX_ID      |
| MP_INT: MP_INT   | MP_INT: MP_INT        |
|                  |                       |
+==================+=======================+
|                  |          +~~~~~~~~~~+ |
|                  |          |          | |
|                  | (TUPLE)  |    OP    | |
|   0x20: KEY      |    0x21: |          | |
| MP_INT: MP_ARRAY |  MP_INT: +~~~~~~~~~~+ |
|                  |            MP_ARRAY   |
+==================+=======================+
                 MP_MAP
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>OP:
    Works only for integer fields:
    * Addition    OP = &#39;+&#39; . space[key][field_no] += argument
    * Subtraction OP = &#39;-&#39; . space[key][field_no] -= argument
    * Bitwise AND OP = &#39;&amp;&#39; . space[key][field_no] &amp;= argument
    * Bitwise XOR OP = &#39;^&#39; . space[key][field_no] ^= argument
    * Bitwise OR  OP = &#39;|&#39; . space[key][field_no] |= argument
    Works on any fields:
    * Delete      OP = &#39;#&#39;
      delete &lt;argument&gt; fields starting
      from &lt;field_no&gt; in the space[&lt;key&gt;]

0           2
+-----------+==========+==========+
|           |          |          |
|    OP     | FIELD_NO | ARGUMENT |
| MP_FIXSTR |  MP_INT  |  MP_INT  |
|           |          |          |
+-----------+==========+==========+
              MP_ARRAY
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>    * Insert      OP = &#39;!&#39;
      insert &lt;argument&gt; before &lt;field_no&gt;
    * Assign      OP = &#39;=&#39;
      assign &lt;argument&gt; to field &lt;field_no&gt;.
      will extend the tuple if &lt;field_no&gt; == &lt;max_field_no&gt; + 1

0           2
+-----------+==========+===========+
|           |          |           |
|    OP     | FIELD_NO | ARGUMENT  |
| MP_FIXSTR |  MP_INT  | MP_OBJECT |
|           |          |           |
+-----------+==========+===========+
              MP_ARRAY

    Works on string fields:
    * Splice      OP = &#39;:&#39;
      take the string from space[key][field_no] and
      substitute &lt;offset&gt; bytes from &lt;position&gt; with &lt;argument&gt;
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>0           2
+-----------+==========+==========+========+==========+
|           |          |          |        |          |
|    &#39;:&#39;    | FIELD_NO | POSITION | OFFSET | ARGUMENT |
| MP_FIXSTR |  MP_INT  |  MP_INT  | MP_INT |  MP_STR  |
|           |          |          |        |          |
+-----------+==========+==========+========+==========+
                         MP_ARRAY
</pre></div>
</div>
<p>It's an error to specify an argument of a type that differs from expected type.</p>
<ul class="simple">
<li>DELETE: CODE - 0x05
Delete a tuple</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>DELETE BODY:

+==================+==================+==================+
|                  |                  |                  |
|   0x10: SPACE_ID |   0x11: INDEX_ID |   0x20: KEY      |
| MP_INT: MP_INT   | MP_INT: MP_INT   | MP_INT: MP_ARRAY |
|                  |                  |                  |
+==================+==================+==================+
                          MP_MAP
</pre></div>
</div>
<ul class="simple">
<li>CALL: CODE - 0x06
Call a stored function</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>CALL BODY:

+=======================+==================+
|                       |                  |
|   0x22: FUNCTION_NAME |   0x21: TUPLE    |
| MP_INT: MP_STRING     | MP_INT: MP_ARRAY |
|                       |                  |
+=======================+==================+
                    MP_MAP
</pre></div>
</div>
<ul class="simple">
<li>EVAL: CODE - 0x08
Evaulate Lua expression</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>EVAL BODY:

+=======================+==================+
|                       |                  |
|   0x27: EXPRESSION    |   0x21: TUPLE    |
| MP_INT: MP_STRING     | MP_INT: MP_ARRAY |
|                       |                  |
+=======================+==================+
                    MP_MAP
</pre></div>
</div>
<ul class="simple">
<li>UPSERT: CODE - 0x09
Update tuple if it would be found elsewhere try to insert tuple. Always use primary index for key.</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre><span></span>UPSERT BODY:

+==================+==================+==========================+
|                  |                  |             +~~~~~~~~~~+ |
|                  |                  |             |          | |
|   0x10: SPACE_ID |   0x21: TUPLE    |       (OPS) |    OP    | |
| MP_INT: MP_INT   | MP_INT: MP_ARRAY |       0x28: |          | |
|                  |                  |     MP_INT: +~~~~~~~~~~+ |
|                  |                  |               MP_ARRAY   |
+==================+==================+==========================+
                                MP_MAP

Operations structure same as for UPDATE operation.
   0           2
+-----------+==========+==========+
|           |          |          |
|    OP     | FIELD_NO | ARGUMENT |
| MP_FIXSTR |  MP_INT  |  MP_INT  |
|           |          |          |
+-----------+==========+==========+
              MP_ARRAY

Supported operations:

&#39;+&#39; - add a value to a numeric field. If the filed is not numeric, it&#39;s
      changed to 0 first. If the field does not exist, the operation is
      skipped. There is no error in case of overflow either, the value
      simply wraps around in C style. The range of the integer is MsgPack:
      from -2^63 to 2^64-1
&#39;-&#39; - same as the previous, but subtract a value
&#39;=&#39; - assign a field to a value. The field must exist, if it does not exist,
      the operation is skipped.
&#39;!&#39; - insert a field. It&#39;s only possible to insert a field if this create no
      nil &quot;gaps&quot; between fields. E.g. it&#39;s possible to add a field between
      existing fields or as the last field of the tuple.
&#39;#&#39; - delete a field. If the field does not exist, the operation is skipped.
      It&#39;s not possible to change with update operations a part of the primary
      key (this is validated before performing upsert).
</pre></div>
</div>
</div>
<div class="section" id="response-packet-structure">
<h3>2.1.6. Response packet structure<a class="headerlink" href="#response-packet-structure" title="Ссылка на этот заголовок">¶</a></h3>
<p>We'll show whole packets here:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>OK:    LEN + HEADER + BODY

0      5                                          OPTIONAL
+------++================+================++===================+
|      ||                |                ||                   |
| BODY ||   0x00: 0x00   |   0x01: SYNC   ||   0x30: DATA      |
|HEADER|| MP_INT: MP_INT | MP_INT: MP_INT || MP_INT: MP_OBJECT |
| SIZE ||                |                ||                   |
+------++================+================++===================+
 MP_INT                MP_MAP                      MP_MAP
</pre></div>
</div>
<p>Set of tuples in the response <code class="code docutils literal"><span class="pre">&lt;data&gt;</span></code> expects a msgpack array of tuples as value
EVAL command returns arbitrary <cite>MP_ARRAY</cite> with arbitrary MsgPack values.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>ERROR: LEN + HEADER + BODY

0      5
+------++================+================++===================+
|      ||                |                ||                   |
| BODY ||   0x00: 0x8XXX |   0x01: SYNC   ||   0x31: ERROR     |
|HEADER|| MP_INT: MP_INT | MP_INT: MP_INT || MP_INT: MP_STRING |
| SIZE ||                |                ||                   |
+------++================+================++===================+
 MP_INT                MP_MAP                      MP_MAP

Where 0xXXX is ERRCODE.
</pre></div>
</div>
<p>Error message is present in the response only if there is an error <code class="code docutils literal"><span class="pre">&lt;error&gt;</span></code>
expects as value a msgpack string</p>
<p>Convenience macros which define hexadecimal constants for return codes
can be found in <a class="reference external" href="https://github.com/tarantool/tarantool/blob/1.7/src/box/errcode.h">src/box/errcode.h</a></p>
</div>
<div class="section" id="replication-packet-structure">
<h3>2.1.7. Replication packet structure<a class="headerlink" href="#replication-packet-structure" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre><span></span>-- replication keys
&lt;server_id&gt;     ::= 0x02
&lt;lsn&gt;           ::= 0x03
&lt;timestamp&gt;     ::= 0x04
&lt;server_uuid&gt;   ::= 0x24
&lt;cluster_uuid&gt;  ::= 0x25
&lt;vclock&gt;        ::= 0x26
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>-- replication codes
&lt;join&gt;      ::= 0x41
&lt;subscribe&gt; ::= 0x42
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>JOIN:

In the beginning you must send JOIN
                         HEADER                          BODY
+================+================+===================++-------+
|                |                |    SERVER_UUID    ||       |
|   0x00: 0x41   |   0x01: SYNC   |   0x24: UUID      || EMPTY |
| MP_INT: MP_INT | MP_INT: MP_INT | MP_INT: MP_STRING ||       |
|                |                |                   ||       |
+================+================+===================++-------+
               MP_MAP                                   MP_MAP

Then server, which we connect to, will send last SNAP file by, simply,
creating a number of INSERTs (with additional LSN and ServerID)
(don&#39;t reply). Then it&#39;ll send a vclock&#39;s MP_MAP and close a socket.

+================+================++============================+
|                |                ||        +~~~~~~~~~~~~~~~~~+ |
|                |                ||        |                 | |
|   0x00: 0x00   |   0x01: SYNC   ||   0x26:| SRV_ID: SRV_LSN | |
| MP_INT: MP_INT | MP_INT: MP_INT || MP_INT:| MP_INT: MP_INT  | |
|                |                ||        +~~~~~~~~~~~~~~~~~+ |
|                |                ||               MP_MAP       |
+================+================++============================+
               MP_MAP                      MP_MAP

SUBSCRIBE:

Then you must send SUBSCRIBE:

                              HEADER
+===================+===================+
|                   |                   |
|     0x00: 0x41    |    0x01: SYNC     |
|   MP_INT: MP_INT  |  MP_INT: MP_INT   |
|                   |                   |
+===================+===================+
|    SERVER_UUID    |    CLUSTER_UUID   |
|   0x24: UUID      |   0x25: UUID      |
| MP_INT: MP_STRING | MP_INT: MP_STRING |
|                   |                   |
+===================+===================+
                 MP_MAP

      BODY
+================+
|                |
|   0x26: VCLOCK |
| MP_INT: MP_INT |
|                |
+================+
      MP_MAP

Then you must process every query that&#39;ll came through other masters.
Every request between masters will have Additional LSN and SERVER_ID.
</pre></div>
</div>
</div>
<div class="section" id="xlog-snap">
<h3>2.1.8. XLOG / SNAP<a class="headerlink" href="#xlog-snap" title="Ссылка на этот заголовок">¶</a></h3>
<p>XLOG and SNAP have the same format. They start with:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>SNAP\n
0.12\n
Server: e6eda543-eda7-4a82-8bf4-7ddd442a9275\n
VClock: {1: 0}\n
\n
...
</pre></div>
</div>
<p>So, <strong>Header</strong> of an SNAP/XLOG consists of:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;format&gt;\n
&lt;format_version&gt;\n
Server: &lt;server_uuid&gt;\n
VClock: &lt;vclock_map&gt;\n
\n
</pre></div>
</div>
<p>There are two markers: tuple beginning - <strong>0xd5ba0bab</strong> and EOF marker -
<strong>0xd510aded</strong>. So, next, between <strong>Header</strong> and EOF marker there's data with
the following schema:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>0            3 4                                         17
+-------------+========+============+===========+=========+
|             |        |            |           |         |
| 0xd5ba0bab  | LENGTH | CRC32 PREV | CRC32 CUR | PADDING |
|             |        |            |           |         |
+-------------+========+============+===========+=========+
  MP_FIXEXT2    MP_INT     MP_INT       MP_INT      ---

+============+ +===================================+
|            | |                                   |
|   HEADER   | |                BODY               |
|            | |                                   |
+============+ +===================================+
    MP_MAP                     MP_MAP
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-persistence-and-the-wal-file-format">
<span id="b-internals"></span><h2>2.2. Data persistence and the WAL file format<a class="headerlink" href="#data-persistence-and-the-wal-file-format" title="Ссылка на этот заголовок">¶</a></h2>
<p>To maintain data persistence, Tarantool writes each data change request (INSERT,
UPDATE, DELETE, REPLACE) into a write-ahead log (WAL) file in the
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> directory. A new WAL file is created for every
<a class="reference internal" href="../reference/configuration/index.html#cfg-binary-logging-snapshots-rows-per-wal"><span class="std std-ref">rows_per_wal</span></a> records.
Each data change request gets assigned a continuously growing 64-bit log sequence
number. The name of the WAL file is based on the log sequence number of the first
record in the file, plus an extension <code class="docutils literal"><span class="pre">.xlog</span></code>.</p>
<p>Apart from a log sequence number and the data change request (its format is the
same as in <a class="reference internal" href="#box-protocol-iproto-protocol"><span class="std std-ref">Tarantool's binary protocol</span></a>),
each WAL record contains a header, some metadata, and then the data formatted
according to <a class="reference external" href="https://en.wikipedia.org/wiki/MessagePack">msgpack</a> rules.
For example this is what the WAL file looks like after the first INSERT request
(&quot;s:insert({1})&quot;) for the introductory sandbox exercise
&quot;<a class="reference internal" href="../book/user_guide_getting_started.html#user-guide-getting-started-first-database"><span class="std std-ref">Starting Tarantool and making your first database</span></a> “.
On the left are the hexadecimal bytes that one would see with:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> hexdump 00000000000000000000.xlog
</pre></div>
</div>
<p>and on the right are comments.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Hex dump of WAL file       Comment
--------------------       -------
58 4c 4f 47 0a             File header: &quot;XLOG\n&quot;
30 2e 31 32 0a             File header: &quot;0.12\n&quot; = version
...                        (not shown = more header + tuples for system spaces)
d5 ba 0b ab                Magic row marker always = 0xab0bbad5 if version 0.12
19 00                      Length, not including length of header, = 25 bytes
ce 16 a4 38 6f             Record header: previous crc32, current crc32,
a7 cc 73 7f 00 00 66 39
84                         msgpack code meaning &quot;Map of 4 elements&quot; follows
00 02                         element#1: tag=request type, value=0x02=IPROTO_INSERT
02 01                         element#2: tag=server id, value=0x01
03 04                         element#3: tag=lsn, value=0x04
04 cb 41 d4 e2 2f 62 fd d5 d4 element#4: tag=timestamp, value=an 8-byte &quot;Double&quot;
82                         msgpack code meaning &quot;map of 2 elements&quot; follows
10 cd 02 00                   element#1: tag=space id, value=512, big byte first
21 91 01                      element#2: tag=tuple, value=1-element fixed array={1}
</pre></div>
</div>
<p>Tarantool processes requests atomically: a change is either accepted and recorded
in the WAL, or discarded completely. Let's clarify how this happens, using the
REPLACE request as an example:</p>
<ol class="arabic simple">
<li>The server attempts to locate the original tuple by primary key. If found, a
reference to the tuple is retained for later use.</li>
<li>The new tuple is validated. If for example it does not contain an indexed
field, or it has an indexed field whose type does not match the type
according to the index definition, the change is aborted.</li>
<li>The new tuple replaces the old tuple in all existing indexes.</li>
<li>A message is sent to WAL writer running in a separate thread, requesting that
the change be recorded in the WAL. The server switches to work on the next
request until the write is acknowledged.</li>
<li>On success, a confirmation is sent to the client. On failure, a rollback
procedure is begun. During the rollback procedure, the transaction processor
rolls back all changes to the database which occurred after the first failed
change, from latest to oldest, up to the first failed change. All rolled back
requests are aborted with <code class="xref std std-errcode docutils literal"><span class="pre">ER_WAL_IO</span></code> error. No new
change is applied while rollback is in progress. When the rollback procedure
is finished, the server restarts the processing pipeline.</li>
</ol>
<p>One advantage of the described algorithm is that complete request pipelining is
achieved, even for requests on the same value of the primary key. As a result,
database performance doesn't degrade even if all requests refer to the same
key in the same space.</p>
<p>The transaction processor thread communicates with the WAL writer thread using
asynchronous (yet reliable) messaging; the transaction processor thread, not
being blocked on WAL tasks, continues to handle requests quickly even at high
volumes of disk I/O. A response to a request is sent as soon as it is ready,
even if there were earlier incomplete requests on the same connection. In
particular, SELECT performance, even for SELECTs running on a connection packed
with UPDATEs and DELETEs, remains unaffected by disk load.</p>
<p>The WAL writer employs a number of durability modes, as defined in configuration
variable <a class="reference internal" href="../reference/configuration/index.html#index-wal-mode"><span class="std std-ref">wal_mode</span></a>. It is possible to turn the write-ahead
log completely off, by setting
<a class="reference internal" href="../reference/configuration/index.html#cfg-binary-logging-snapshots-wal-mode"><span class="std std-ref">wal_mode</span></a> to <em>none</em>. Even
without the write-ahead log it's still possible to take a persistent copy of the
entire data set with the <a class="reference internal" href="../book/administration.html#admin-snapshot"><span class="std std-ref">box.snapshot()</span></a> request.</p>
<p>An .xlog file always contains changes based on the primary key.
Even if the client requested an update or delete using
a secondary key, the record in the .xlog file will contain the primary key.</p>
</div>
<div class="section" id="the-snapshot-file-format">
<h2>2.3. The snapshot file format<a class="headerlink" href="#the-snapshot-file-format" title="Ссылка на этот заголовок">¶</a></h2>
<p>The format of a snapshot .snap file is nearly the same as the format of a WAL .xlog file.
However, the snapshot header differs: it contains the server's global unique identifier
and the snapshot file's position in history, relative to earlier snapshot files.
Also, the content differs: an .xlog file may contain records for any data-change
requests (inserts, updates, upserts, and deletes), a .snap file may only contain records
of inserts to memtx spaces.</p>
<p>Primarily, the .snap file's records are ordered by space id. Therefore the records of
system spaces, such as _schema and _space and _index and _func and _priv and _cluster,
will be at the start of the .snap file, before the records of any spaces
that were created by users.</p>
<p>Secondarily, the .snap file's records are ordered by primary key within space id.</p>
</div>
<div class="section" id="the-recovery-process">
<h2>2.4. The recovery process<a class="headerlink" href="#the-recovery-process" title="Ссылка на этот заголовок">¶</a></h2>
<p>The recovery process begins when box.cfg{} happens for the
first time after the Tarantool server starts.</p>
<p>The recovery process must recover the databases
as of the moment when the server was last shut down. For this it may
use the latest snapshot file and any WAL files that were written
after the snapshot. One complicating factor is that Tarantool
has two engines -- the memtx data must be reconstructed entirely
from the snapshot and the WAL files, while the vinyl data will
be on disk but might require updating around the time of a checkpoint.
(When a snapshot happens, Tarantool tells the vinyl engine to
make a checkpoint, and the snapshot operation is rolled back if
anything goes wrong, so vinyl's checkpoint is at least as fresh
as the snapshot file.)</p>
<dl class="docutils">
<dt>Step 1</dt>
<dd>Read the configuration parameters in the <code class="docutils literal"><span class="pre">box.cfg{}</span></code> request.
Parameters which affect recovery may include <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-work-dir"><span class="std std-ref">work_dir</span></a>,
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a>, <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a>,
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-vinyl-dir"><span class="std std-ref">vinyl_dir</span></a>,
<a class="reference internal" href="../reference/configuration/index.html#cfg-binary-logging-snapshots-panic-on-snap-error"><span class="std std-ref">panic_on_snap_error</span></a>,
and <a class="reference internal" href="../reference/configuration/index.html#cfg-binary-logging-snapshots-panic-on-wal-error"><span class="std std-ref">panic_on_wal_error</span></a>.</dd>
<dt>Step 2</dt>
<dd>Find the latest snapshot file. Use its data to reconstruct the in-memory
databases. Instruct the vinyl engine to recover to the latest checkpoint.</dd>
</dl>
<p>There are actually two variations of the reconstruction procedure for the memtx
databases, depending whether the recovery process is &quot;default&quot;.</p>
<p>If it is default (<code class="docutils literal"><span class="pre">panic_on_snap_error</span></code> is <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">panic_on_wal_error</span></code>
is <code class="docutils literal"><span class="pre">true</span></code>), memtx can read data in the snapshot with all indexes disabled.
First, all tuples are read into memory. Then, primary keys are built in bulk,
taking advantage of the fact that the data is already sorted by primary key
within each space.</p>
<p>If it is not default (<code class="docutils literal"><span class="pre">panic_on_snap_error</span></code> is <code class="docutils literal"><span class="pre">false</span></code> or <code class="docutils literal"><span class="pre">panic_on_wal_error</span></code>
is <code class="docutils literal"><span class="pre">false</span></code>), Tarantool performs additional checking. Indexes are enabled at
the start, and tuples are added one by one. This means that any unique-key
constraint violations will be caught, and any duplicates will be skipped.
Normally there will be no constraint violations or duplicates, so these checks
are only made if an error has occurred.</p>
<dl class="docutils">
<dt>Step 2</dt>
<dd>Find the WAL file that was made at the time of, or after, the snapshot file.
Read its log entries until the log-entry LSN is greater than the LSN of the
snapshot, or greater than the LSN of the vinyl checkpoint. This is the
recovery process's &quot;start position&quot;; it matches the current state of the
engines.</dd>
<dt>Step 3</dt>
<dd>Redo the log entries, from the start position to the end of the WAL. The
engine skips a redo instruction if it is older than the engine's checkpoint.</dd>
<dt>Step 4</dt>
<dd>For the memtx engine, re-create all secondary indexes.</dd>
</dl>
</div>
<div class="section" id="server-startup-with-replication">
<span id="b-internals-replication"></span><h2>2.5. Server startup with replication<a class="headerlink" href="#server-startup-with-replication" title="Ссылка на этот заголовок">¶</a></h2>
<p>In addition to the recovery process described above, the server must take
additional steps and precautions if <a class="reference internal" href="../book/administration.html#index-box-replication"><span class="std std-ref">replication</span></a> is
enabled.</p>
<p>Once again the startup procedure is initiated by the <code class="docutils literal"><span class="pre">box.cfg{}</span></code> request.
One of the box.cfg parameters may be
<a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a>. We will
refer to this server, which is starting up due to box.cfg, as the &quot;local&quot; server
to distinguish it from the other servers in a cluster, which we will refer to as
&quot;distant&quot; servers.</p>
<p><em>If there is no snapshot .snap file and replication_source is empty</em>: <br />
then the local server assumes it is an unreplicated &quot;standalone&quot; server, or is
the first server of a new replication cluster. It will generate new UUIDs for
itself and for the cluster. The server UUID is stored in the _cluster space; the
cluster UUID is stored in the _schema space. Since a snapshot contains all the
data in all the spaces, that means the local server's snapshot will contain the
server UUID and the cluster UUID. Therefore, when the local server restarts on
later occasions, it will be able to recover these UUIDs when it reads the .snap
file.</p>
<p><em>If there is no snapshot .snap file and replication_source is not empty
and the _cluster space contains no other server UUIDs</em>: <br />
then the local server assumes it is not a standalone server, but is not yet part
of a cluster. It must now join the cluster. It will send its server UUID to the
first distant server which is listed in replication_source, which will act as a
master. This is called the &quot;join request&quot;. When a distant server receives a join
request, it will send back:</p>
<ol class="arabic simple">
<li>the distant server's cluster UUID,</li>
<li>the contents of the distant server's .snap file. <br />
When the local server receives this information, it puts the cluster UUID in
its _schema space, puts the distant server's UUID and connection information
in its _cluster space, and makes a snapshot containing all the data sent by
the distant server. Then, if the local server has data in its WAL .xlog
files, it sends that data to the distant server. The distant server will
receive this and update its own copy of the data, and add the local server's
UUID to its _cluster space.</li>
</ol>
<p><em>If there is no snapshot .snap file and replication_source is not empty
and the _cluster space contains other server UUIDs</em>: <br />
then the local server assumes it is not a standalone server, and is already part
of a cluster. It will send its server UUID and cluster UUID to all the distant
servers which are listed in replication_source. This is called the &quot;on-connect
handshake&quot;. When a distant server receives an on-connect handshake: <br /></p>
<ol class="arabic simple">
<li>the distant server compares its own copy of the cluster UUID to the one in
the on-connect handshake. If there is no match, then the handshake fails and
the local server will display an error.</li>
<li>the distant server looks for a record of the connecting instance in its
_cluster space. If there is none, then the handshake fails. <br />
Otherwise the handshake is successful. The distant server will read any new
information from its own .snap and .xlog files, and send the new requests to
the local server.</li>
</ol>
<p>In the end ... the local server knows what cluster it belongs to, the distant
server knows that the local server is a member of the cluster, and both servers
have the same database contents.</p>
<p><em>If there is a snapshot file and replication source is not empty</em>: <br />
first the local server goes through the recovery process described in the
previous section, using its own .snap and .xlog files. Then it sends a
&quot;subscribe&quot; request to all the other servers of the cluster. The subscribe
request contains the server vector clock. The vector clock has a collection of
pairs 'server id, lsn' for every server in the _cluster system space. Each
distant server, upon receiving a subscribe request, will read its .xlog files'
requests and send them to the local server if (lsn of .xlog file request) is
greater than (lsn of the vector clock in the subscribe request). After all the
other servers of the cluster have responded to the local server's subscribe
request, the server startup is complete.</p>
<p>The following temporary limitations apply for version 1.7:</p>
<ul class="simple">
<li>The URIs in replication_source should all be in the same order on all servers.
This is not mandatory but is an aid to consistency.</li>
<li>The servers of a cluster should be started up at slightly different times.
This is not mandatory but prevents a situation where each server is waiting
for the other server to be ready.</li>
<li>The maximum number of entries in the _cluster space is 32. Tuples for
out-of-date replicas are not automatically re-used, so if this 32-replica
limit is reached, users may have to reorganize the _cluster space manually.</li>
</ul>
</div>
</div>


          
          
  <div id="disqus_thread"></div>
  <script>
    // DON'T EDIT
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//tarantooldb.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
      comments powered by Disqus.
    </a>
  </noscript>

          
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="reference_capi/txn.html"
           class="b-prev b-ellipsis"
           title="1.13. Module &lt;cite&gt;txn&lt;/cite&gt;">1.13. Module <cite>txn</cite></a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../_sources/dev_guide/internals_index.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="build_contribute_index.html"
           class="b-next b-ellipsis"
           title="3. Build and contribute">3. Build and contribute</a>
      </div>
    
    </div>
  
</div>
      </div>
    </div>
  

      </div>
    </div>

  <!-- FOOTER > -->
  
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

  <!-- < FOOTER -->
  <div id="mobile-checker"></div>
  </body>
</html>

