




<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>6. Администрирование серверной части</title>
    <link rel="icon" type="image/png" sizes="192x192"
          href="/theme/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32"
          href="/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96"
          href="/theme/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16"
          href="/theme/favicon/favicon-16x16.png">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
      var disqus_config = function(){
        this.page.language   = "ru";
      };
      var disqus_developer = 1;
    </script>
    <script id="dsq-count-scr"
            src="//tarantooldb.disqus.com/count.js" async/>
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/disqus.js"></script>
    <script type="text/javascript" src="../_static/jquery.pin.min.js"></script>
    <script type="text/javascript" src="../_static/headers.js"></script>
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="/theme/font-awesome.min.css">
    <link rel="stylesheet" href="../_static/sphinx_design.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design">
  
    <div class="b-wrapper">
      <!-- HEADER > -->
      <header class="b-header">
        <div class="b-header-wrapper">
          <nav class="b-header_menu">
            
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          </nav>
        </div>
      </header>
      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
    <div class="b-block-wrapper">
      <h2 class="b-section-title b-ellipsis" title="6. Администрирование серверной части">
        6. Администрирование серверной части
      </h2>
  <div class="b-doc-language_selector">
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../book/administration.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../ru/book/administration.html
  
"
           class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>
  </div>
</div>
  </section>
  
    <div class="b-cols_content b-clearbox b-doc-book/administration">
      <div class="b-cols_content_left">
        
<form id="searchbox" role="search" class="search b-search" action="../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>


        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Общие сведения</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Вопросы и ответы</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Руководство пользователя</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Предисловие</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_guide_getting_started.html">2. Начало работы</a></li>
<li class="toctree-l2"><a class="reference internal" href="box/index.html">3. Функционал СУБД</a></li>
<li class="toctree-l2"><a class="reference internal" href="replication/index.html">4. Репликация</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration/index.html">5. Справочник по конфигурированию</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. Администрирование серверной части</a></li>
<li class="toctree-l2"><a class="reference internal" href="connectors/index.html">7. Коннекторы</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">8. Модули</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/a_errcodes.html">9. Приложение A. Коды ошибок</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/b_internals.html">10. Приложение B. Детали реализации</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/c_lua_tutorial.html">11. Приложение C. Учебные примеры на языке Lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/d_vinyl/index.html">12. Приложение D. Vinyl</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/e_cookbook.html">13. Приложение E. Готовые рецепты</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/f_c_tutorial.html">14. Приложение F. Учебные примеры на языке C</a></li>
<li class="toctree-l2"><a class="reference internal" href="app/g_changes.html">15. Приложение G. Список изменений для версии 1.7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference_lua/index.html">Справочник по Lua API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_rock/index.html">Справочник по Lua rocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_capi/index.html">Справочник по C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Руководство разработчика</a></li>
</ul>

      </div>
      <div class="b-cols_content_right">
        <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="index.html"
             class="b-path-list-item-url b-ellipsis">
            Руководство пользователя
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="6. Администрирование серверной части" class="b-path_current b-ellipsis">
          6. Администрирование серверной части
        </div>
      </li>
      
    </ul>
  </div>

  <div class="section" id="server-administration">
<h1>6. Администрирование серверной части<a class="headerlink" href="#server-administration" title="Ссылка на этот заголовок">¶</a></h1>
<p>Типичные задачи администрирования серверной части включают в себя запуск и остановку сервера, перезагрузку настроек, создание снимков, ротацию логов.</p>
<div class="section" id="server-signal-handling">
<h2>6.1. Обработка сигналов от сервера<a class="headerlink" href="#server-signal-handling" title="Ссылка на этот заголовок">¶</a></h2>
<p>Во время основного цикла Tarantool-сервер обрабатывает следующие сигналы:</p>
<dl class="glossary docutils">
<dt id="term-sighup">SIGHUP</dt>
<dd><p class="first last">может привести к ротации лога, см. <a class="reference internal" href="configuration/index.html#cfg-logging-logging-example"><span class="std std-ref">пример в разделе &quot;Запись в журнал&quot;</span></a>.</p>
</dd>
<dt id="term-sigusr1">SIGUSR1</dt>
<dd><p class="first last">может привести к сохранению снимка, см. описание функции <a class="reference internal" href="box/admin.html#admin-snapshot"><span class="std std-ref">box.snapshot</span></a>.</p>
</dd>
<dt id="term-sigterm">SIGTERM</dt>
<dd><p class="first last">может привести к корректному завершению работы (с предварительным сохранением всех данных).</p>
</dd>
<dt id="term-sigint">SIGINT</dt>
<dd><p class="first last">(или &quot;прерывание с клавиатуры&quot;) может привести к корректному завершению работы (с предварительным сохранением всех данных).</p>
</dd>
<dt id="term-sigkill">SIGKILL</dt>
<dd><p class="first last">приводит к аварийному завершению работы (с возможной потерей данных).</p>
</dd>
</dl>
<p>Действие других сигналов определяется операционной системой. Все сигналы, кроме SIGKILL, могут быть проигнорированы, особенно если Tarantool-сервер выполняет длительную процедуру, которая позволяет вернуться к главному циклу.</p>
</div>
<div class="section" id="process-title">
<span id="administration-proctitle"></span><h2>6.2. Название процесса<a class="headerlink" href="#process-title" title="Ссылка на этот заголовок">¶</a></h2>
<p>Операционные системы Linux и FreeBSD позволяют запущенному процессу менять его название (title), в котором изначально содержится имя программы (name). Tarantool использует эту возможность, чтобы упростить работу системного администратора, например посмотреть, какие службы запущены на хосте, их статус и т.д.</p>
<p>Название процесса Tarantool-сервера состоит из следующих частей:</p>
<p><code class="extsamp docutils literal"><strong><span class="pre">имя_программы</span></strong> <span class="pre">[</span><strong><span class="pre">имя_файла_инициализации</span></strong><span class="pre">]</span> <strong><span class="pre">&lt;имя_роли&gt;</span></strong> <span class="pre">[</span><strong><span class="pre">название_процесса</span></strong><span class="pre">]</span></code></p>
<ul class="simple">
<li><p class="first"><strong>имя_программы</strong> -- это, как правило, &quot;tarantool&quot;.</p>
</li>
<li><p class="first"><strong>имя_файла_инициализации</strong> -- это имя  <a class="reference internal" href="configuration/index.html#index-init-label"><span class="std std-ref">файла инициализации на Lua</span></a>, если этот файл был указан при запуске.</p>
</li>
<li><p class="first"><strong>имя_роли</strong> -- это может быть один из следующих вариантов:</p>
<ul>
<li><p class="first">&quot;running&quot; (узел находится в режиме &quot;готов к принятию запросов&quot;),</p>
</li>
<li><p class="first">&quot;loading&quot; (узел, который загружает данные из ранее сохраненного снимка и WAL-файла),</p>
</li>
<li><p class="first">&quot;orphan&quot; (узел не входит в состав кластера),</p>
</li>
<li><p class="first">&quot;hot_standby&quot; (см. раздел про <a class="reference internal" href="configuration/index.html#book-cfg-local-hot-standby"><span class="std std-ref">режим горячего резервирования (local hot standby)</span></a>), либо</p>
</li>
<li><p class="first">&quot;dumper&quot; + process-id (идет сохранение снимка).</p>
</li>
</ul>
</li>
<li><p class="first"><strong>название_процесса</strong> -- это необязательное название Tarantool-процесса в системе, которое берется из конфигурационного параметра <a class="reference internal" href="configuration/index.html#cfg-basic-custom-proc-title"><span class="std std-ref">custom_proc_title</span></a>, если он указан.</p>
</li>
</ul>
<p>Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ps -AF <span class="p">|</span> grep tarantool
<span class="go">1000     17337 16716  1 91362  6916   0 11:07 pts/5    00:00:13 tarantool script.lua &lt;running&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-tarantool-as-a-client">
<span id="administration-using-tarantool-as-a-client"></span><h2>6.3. Использование tarantool в качестве клиента<a class="headerlink" href="#using-tarantool-as-a-client" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если <strong class="program">tarantool</strong> запущен без <a class="reference internal" href="configuration/index.html#index-init-label"><span class="std std-ref">файла инициализации</span></a>, или же в файле инициализации указана функция <a class="reference internal" href="../reference_lua/console.html#console-start"><span class="std std-ref">console.start()</span></a>, то <strong class="program">tarantool</strong> стартует в интерактивном режиме: он выводит приглашение командной строки (&quot;<code class="docutils literal"><span class="pre">tarantool&gt;</span></code>&quot;), и запросы можно вводить прямо в консоли. В таком режиме <strong class="program">tarantool</strong> можно использовать в качестве клиента для удаленного сервера.</p>
<p>В этом разделе описаны синтаксические правила для ввода запросов в консоли Tarantool'а, с примечаниями и примерами. Другие клиентские программы могут иметь схожие параметры и синтаксис запросов. Некоторые сведения из этого раздела дублируются в главе <a class="reference internal" href="configuration/index.html#index-book-cfg"><span class="std std-ref">Справочник по конфигурированию</span></a>.</p>
<div class="section" id="conventions-used-in-this-section">
<h3>6.3.1. Условные обозначения, используемые в этом разделе<a class="headerlink" href="#conventions-used-in-this-section" title="Ссылка на этот заголовок">¶</a></h3>
<p>Токены -- это последовательности символов, которые рассматриваются как синтаксические единицы в рамках запроса. Квадратные скобки [ и ] используются для обозначения необязательных токенов. Три точки в строке ... означают, что предыдущие токены могут повторяться. Вертикальная черта | означает, что предыдущие и последующие токены являются взаимоисключающими альтернативами.</p>
</div>
<div class="section" id="options-when-starting-client-from-the-command-line">
<h3>6.3.2. Параметры запуска клиента из командной строки<a class="headerlink" href="#options-when-starting-client-from-the-command-line" title="Ссылка на этот заголовок">¶</a></h3>
<p>Общий вид:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span>$ tarantool
ИЛИ
$ tarantool опции
ИЛИ
$ tarantool файл-инициализации-на-lua [ аргументы ]
</pre></div>
</div>
<p><em>файл-инициализации-на-lua</em> -- это любой скрипт, содержащий логику инициализации. Код из этого файла выполняется при запуске Tarantool'а.  Например: <code class="samp docutils literal"><span class="pre">init.lua</span></code>. <br /> Примечания: При использовании скрипта, Tarantool не выводит приглашение командной строки. Скрипт должен содержать конфигурационные настройки, в т.ч. <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...listen=...</span></em></code> или <code class="samp docutils literal"><span class="pre">box.listen(...)</span></code>, чтобы внешние программы могли установить соединение с Tarantool-сервером на одном из указанных портов.</p>
<p><em>Опция</em> -- это одно из следующих значений (указаны в алфавитном порядке, по полному имени опции):</p>
<dl class="option">
<dt id="cmdoption-tarantool-?">
<span id="cmdoption-tarantool-h"></span><span id="cmdoption-tarantool--help"></span><code class="descname">-?</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">-h</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--help</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-?" title="Ссылка на это определение">¶</a></dt>
<dd><p>Tarantool-клиент выводит краткую справку, включая список всех параметров. Например: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--help</span></code>. Вывод останавливается после показа справки.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantool-V">
<span id="cmdoption-tarantool--version"></span><code class="descname">-V</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--version</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-V" title="Ссылка на это определение">¶</a></dt>
<dd><p>Tarantool-клиент выводит свой номер версии. Например: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--version</span></code>. Вывод останавливается после показа номера версии.</p>
</dd></dl>

</div>
<div class="section" id="tokens-requests-and-special-key-combinations">
<h3>6.3.3. Токены, запросы и специальные комбинации клавиш<a class="headerlink" href="#tokens-requests-and-special-key-combinations" title="Ссылка на этот заголовок">¶</a></h3>
<p>Идентификатором процедуры может быть любая последовательность букв, цифр и/или подчеркиваний, которая отвечает правилам именования идентификаторов в Lua. Термин &quot;идентификаторы процедур&quot; также применяют к именам функций. <br /> Примечание: в случае с именами функций регистр имеет значение, поэтому <code class="docutils literal"><span class="pre">insert</span></code> и <code class="docutils literal"><span class="pre">Insert</span></code> -- это не одно и то же.</p>
<p>Строковым литералом может быть любая последовательность из нуля и более символов, которая заключена в <em>одинарные кавычки</em>. <em>Двойные кавычки</em> также допустимы, но предпочтительным вариантом являются одинарные кавычки. А <em>двойные квадратные скобки</em> нужны для многострочных литералов (см. <a class="reference external" href="http://www.lua.org/pil/2.4.html">документацию по языку Lua</a>). <br /> Например: 'Hello, world', 'A', [[A\B!]].</p>
<p>Числовым литералом может быть любая последовательность символов, состоящая из одной и более цифр с необязательным знаком + или - в начале. В состав больших числовых литералов, а также числовых литералов с плавающей точкой может входить десятичный разделитель (запятая или точка), символы для экспоненциального представления и суффиксы. <br /> Например: 500, -500, 5e2, 500.1, 5LL, 5ULL.</p>
<p>Однобайтовым символом может быть запятая, открывающая или закрывающая круглая скобка, а также арифметический оператор. <br /> Например: * , ( ).</p>
<p>Токены должны разделяться одним или бОльшим количеством пробелов. Исключением являются однобайтовые токены и строковые литералы -- вокруг них пробелы не нужны.</p>
</div>
<div class="section" id="requests">
<span id="administration-setting-delimiter"></span><h3>6.3.4. Запросы<a class="headerlink" href="#requests" title="Ссылка на этот заголовок">¶</a></h3>
<p>Запросы вводятся после приглашения командной строки, когда Tarantool работает в интерактивном режиме. (Приглашение -- это слово tarantool и знак &quot;больше&quot;, вот так: <code class="samp docutils literal"><span class="pre">tarantool&gt;</span></code>). Маркером конца запроса по умолчанию является перевод строки.</p>
<p>Для ввода многострочных запросов можно задать другой маркер конца запроса. Для этого введите команду следующего вида: <code class="samp docutils literal"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">require('console');</span> <span class="pre">console.delimiter(</span><em><span class="pre">новый-маркер</span></em><span class="pre">)</span></code>. В качестве нового маркера укажите строковый литерал в одинарных кавычках. После этого вам нужно будет вводить указанный маркер в конце каждого запроса, потому что Tarantool перестанет интерпретировать перевод строки как конец запроса. Чтобы вернуться к обычному режиму, введите: <code class="samp docutils literal"><span class="pre">console.delimiter('')</span><em><span class="pre">string-literal</span></em></code>. Как правило, задавать свой маркер нет необходимости, поскольку Tarantool сам распознает, что запрос введен не полностью (скажем, когда Tarantool не встречает слова <code class="samp docutils literal"><span class="pre">end</span></code> в объявлении функции). Например:</p>
<div class="highlight-lua_tarantool"><div class="highlight"><pre><span></span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">);</span> <span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">!&#39;</span><span class="p">)</span>
<span class="k">function</span> <span class="nf">f</span> <span class="p">()</span>
  <span class="n">statement_1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">a&#39;</span>
  <span class="n">statement_2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">b&#39;</span>
<span class="k">end</span><span class="p">!</span>
<span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">)!</span>
</pre></div>
</div>
<p>См. также <a class="reference internal" href="../dev_guide/box_protocol.html#box-protocol-iproto-protocol"><span class="std std-ref">описание формата клиентских запросов</span></a> в виде аннотированных BNF-диаграмм (Backus-Naur Form).</p>
<p>Работая в  <em>интерактивном</em> режиме, Tarantool-сервер принимает введенные запросы и выводит результаты. Запросы, как правило, вводит пользователь. Вот пример интерактивной пользовательской сессии:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool
<span class="go">[ здесь tarantool выводит приветствие и номер версии ]</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">[ здесь tarantool выводит свои текущие настройки ]</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="go">[ здесь tarantool может вывести сообщение о том,</span>
<span class="go">  что идет обработка запроса ]</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">hash&#39;</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">unsigned&#39;</span><span class="p">}})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">My first tuple&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">2014-04-30 10:28:00.886 [20436] main/101/spawner I&gt; Exiting: master shutdown</span>
<span class="go">$</span>
</pre></div>
</div>
<p>Пояснения к приведенному выше примеру:</p>
<ul class="simple">
<li><p class="first">На многие запросы Tarantool возвращает типизированные объекты. В ответ на запрос <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code> Tarantool выведет результат на экран. Если в запросе задано, что его результат должен быть записан в некоторую переменную, например <code class="samp docutils literal"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code>, то в таком случае вывода результата на экран не происходит.</p>
</li>
<li><p class="first">Вывод объекта в Tarantool'е всегда начинается со строки &quot;<code class="docutils literal"><span class="pre">---</span></code>&quot; и заканчивается строкой &quot;<code class="docutils literal"><span class="pre">...</span></code>&quot;.</p>
</li>
<li><p class="first">По запросу на вставку данных возвращается объект типа тапл (tuple), и в этом случае перед выводом будет стоять одиночное тире ('<code class="docutils literal"><span class="pre">-</span></code>'). А по запросу на выборку данных возвращается объект типа таблица таплов (table of tuples), и в этом случае перед выводом будут стоять два тире ('<code class="docutils literal"><span class="pre">-</span> <span class="pre">-</span></code>').</p>
</li>
</ul>
</div>
</div>
<div class="section" id="utility-tarantoolctl">
<span id="administration-tarantoolctl"></span><h2>6.4. Утилита tarantoolctl<a class="headerlink" href="#utility-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h2>
<p>С помощью программы <strong class="program">tarantoolctl</strong> вы можете задать буквально следующее: &quot;с помощью стандартных системных механизмов запустить экземпляр Tarantool-сервера, который должен исполнить такую-то пользовательскую программу на Lua, выделив для нее пространство на диске&quot;. Если Tarantool установлен из пакета для Debian или Red Hat, то путь к скрипту <strong class="program">tarantoolctl</strong> будет <code class="file docutils literal"><span class="pre">/usr/bin/tarantoolctl</span></code> или <code class="file docutils literal"><span class="pre">/usr/local/bin/tarantoolctl</span></code>. Этот скрипт решает задачи запуска, остановки, ротации журналов, авторизации в консоли и проверки статуса.</p>
<p>Об использовании <strong class="program">tarantoolctl</strong> в качестве клиента читайте далее в разделе <a class="reference internal" href="#administration-tarantoolctl-connect"><span class="std std-ref">Утилита tarantoolctl connect</span></a>.</p>
<div class="section" id="configuration-for-tarantoolctl">
<h3>6.4.1. Конфигурирование tarantoolctl<a class="headerlink" href="#configuration-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Скрипт <strong class="program">tarantoolctl</strong> сначала проверяет наличие файла конфигурации в текущей директории (<code class="file docutils literal"><span class="pre">$PWD/.tarantoolctl</span></code>). Если не находит, то проверяет домашнюю директорию текущего пользователя (<code class="file docutils literal"><span class="pre">$HOME/.config/tarantool/tarantool</span></code>). Если опять не находит, то проверяет директорию, указанную в переменной SYSCONFDIR (обычно это <code class="file docutils literal"><span class="pre">/etc/sysconfig/tarantool</span></code>, но на разных платформах этот путь может различаться). Большинство параметров <strong class="program">tarantoolctl</strong> аналогичны тем, что задаются в запросе <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...</span></em></code>; однако <strong class="program">tarantoolctl</strong> меняет значение некоторых параметров, дописывая к ним имя приложения. Далее приводится копия файла <code class="file docutils literal"><span class="pre">usr/local/etc/default/tarantool</span></code>, где для всех параметров указаны их значения по умолчанию:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/run/tarantool&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span>    <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">logger</span>     <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/log/tarantool&quot;</span><span class="p">,</span>
    <span class="n">username</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/etc/tarantool/instances.enabled&quot;</span>
</pre></div>
</div>
<p>Комментарии к параметрам в приведенном выше скрипте:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">pid_file</span></code></dt>
<dd><p class="first last">Директория, где хранятся pid-файл и socket-файл. Скрипт <strong class="program">tarantoolctl</strong> добавляет &quot;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&quot; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">wal_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся <code class="file docutils literal"><span class="pre">*.xlog</span></code>-файлы. Скрипт <strong class="program">tarantoolctl</strong> добавляет &quot;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&quot; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">snap_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся <code class="file docutils literal"><span class="pre">*.snap</span></code>-файлы. Скрипт <strong class="program">tarantoolctl</strong> добавляет &quot;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&quot; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">vinyl_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся файлы движка vinyl. Скрипт <strong class="program">tarantoolctl</strong> добавляет &quot;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&quot; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">logger</span></code></dt>
<dd><p class="first last">Директория, где хранятся файлы журнала с сообщениями от Tarantool-приложений. Скрипт <strong class="program">tarantoolctl</strong> добавляет &quot;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&quot; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">username</span></code></dt>
<dd><p class="first last">Имя пользователя, из-под которого запущен Tarantool-сервер. Это имя пользователя в операционной системе, а не в Tarantool-клиенте.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">instance_dir</span></code></dt>
<dd><p class="first last">Имя директории, где хранятся исходные файлы всех Tarantool-приложений для данного хоста. Пользователю, который пишет приложение для <strong class="program">tarantoolctl</strong>, нужно положить исходный код своего приложения в эту директорию или настроить симлинк. Далее для примеров в этом разделе мы используем Tarantool-приложение с именем <code class="docutils literal"><span class="pre">my_app</span></code>, и его исходный код должен лежать в файле <code class="samp docutils literal"><em><span class="pre">instance_dir</span></em><span class="pre">/my_app.lua</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="commands-for-tarantoolctl">
<h3>6.4.2. Команды для tarantoolctl<a class="headerlink" href="#commands-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Команды для <strong class="program">tarantoolctl</strong> имеют вид <code class="samp docutils literal"><span class="pre">tarantoolctl</span> <em><span class="pre">операция</span></em> <em><span class="pre">имя_приложения</span></em></code>. В качестве <em>операции</em> можно указать одно из следующих значений: start, stop, enter, logrotate, status, eval.</p>
<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-start">
<code class="descname">start</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-start" title="Ссылка на это определение">¶</a></dt>
<dd><p>Запустить приложение с именем <em>&lt;application&gt;</em></p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-stop">
<code class="descname">stop</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-stop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Остановить приложение</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-enter">
<code class="descname">enter</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-enter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Вывести консоль для управления приложением</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-logrotate">
<code class="descname">logrotate</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-logrotate" title="Ссылка на это определение">¶</a></dt>
<dd><p>Произвести ротацию журналов указанного приложения (создать новые, удалить старые)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-status">
<code class="descname">status</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-status" title="Ссылка на это определение">¶</a></dt>
<dd><p>Проверить статус приложения</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-eval">
<code class="descname">eval</code><code class="descclassname"> &lt;application&gt; &lt;scriptname&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-eval" title="Ссылка на это определение">¶</a></dt>
<dd><p>Выполнить код из файла <em>&lt;scriptname&gt;</em> от имени запущенного экземпляра приложения <em>&lt;application&gt;</em></p>
</dd></dl>

</div>
<div class="section" id="typical-code-snippets-for-tarantoolctl">
<h3>6.4.3. Примеры кода для tarantoolctl<a class="headerlink" href="#typical-code-snippets-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Проверить, запущено ли приложение <code class="docutils literal"><span class="pre">my_app</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">if</span> tarantoolctl status my_app<span class="p">;</span> <span class="k">then</span>
...
<span class="k">fi</span>
</pre></div>
</div>
<p>Выполнить инструкции из файла <code class="file docutils literal"><span class="pre">init.d</span></code> во время запуска приложения:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span>каждый файл в директории instance_dir<span class="o">)</span>:
    tarantoolctl start <span class="sb">`</span>basename $ file .lua<span class="sb">`</span>
</pre></div>
</div>
<p>Указать файл конфигурации для ротации журнала, например:</p>
<pre class="highlight literal-block">
/path/to/tarantool/*.log {
    daily
    size 512k
    missingok
    rotate 10
    compress
    delaycompress
    create 0640 tarantool adm
    postrotate
        /path/to/tarantoolctl logrotate <cite>basename $ 1 .log</cite>
    endscript
}
</pre>
</div>
<div class="section" id="a-detailed-example-for-tarantoolctl">
<h3>6.4.4. Подробный пример для tarantoolctl<a class="headerlink" href="#a-detailed-example-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом примере мы создадим временную директорию, в которой <strong class="program">tarantoolctl</strong> сможет запускать и мониторить некое долго работающее приложение.</p>
<p>Итак, наши исходные условия: нам известен пароль root-пользователя; компьютер используется только для тестирования; Tarantool-сервер настроен и готов к запуску, но пока еще не запущен ;программа <strong class="program">tarantoolctl</strong> установлена в пользовательском окружении; пока не существует директории с именем <code class="file docutils literal"><span class="pre">tarantool_test</span></code>.</p>
<p>Создадим директорию с именем <code class="file docutils literal"><span class="pre">/tarantool_test</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo mkdir /tarantool_test
</pre></div>
</div>
<p>Отредактируем файл <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code>. Для этого нам сначала может понадобиться выполнить команду <code class="samp docutils literal"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/usr/local/etc/default</span></code>. Указанный файл будет содержать следующие настройки:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/my_app.pid&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/log&quot;</span><span class="p">,</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span>
</pre></div>
</div>
<p>Создадим файл <code class="file docutils literal"><span class="pre">/tarantool_test/my_app.lua</span></code> для приложения <code class="docutils literal"><span class="pre">my_app</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">passwd</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Gx5!&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">guest&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">read,write,execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">universe&#39;</span><span class="p">)</span>
<span class="n">fiber</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">fiber&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,{})</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">do</span>
    <span class="n">fiber</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">insert &#39;</span> <span class="o">..</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">my_app tuple&#39;</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>С помощью <strong class="program">tarantoolctl</strong> запустим наше приложение...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> sudo tarantoolctl start my_app
</pre></div>
</div>
<p>... и получим сообщения о том, что экземпляр нашего приложения запущен. Затем скажем:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /tarantool_test/my_app
</pre></div>
</div>
<p>... и увидим <code class="file docutils literal"><span class="pre">.snap</span></code>-файл и <code class="file docutils literal"><span class="pre">.xlog</span></code>-файл. Затем скажем:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo less /tarantool_test/log/my_app.log
</pre></div>
</div>
<p>... и увидим содержимое файла журнала для приложения <code class="docutils literal"><span class="pre">my_app</span></code>, в т.ч. сообщения об ошибках, если они были. Затем скажем:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> <span class="c1"># допустим, что &#39;tarantool&#39; запускает Tarantool-сервер</span>
<span class="gp">$</span> sudo tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{}</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">localhost:3301&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>... и увидим те несколько таплов, которые создало приложение <code class="docutils literal"><span class="pre">my_app</span></code>.</p>
<p>Всё. Теперь остановим приложение <code class="docutils literal"><span class="pre">my_app</span></code>. Единственный корректный способ -- это использовать <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo tarantoolctl stop my_app
</pre></div>
</div>
<p>Почистим систему после тестирования. Приведем содержимое файла <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code> к исходному виду и удалим нашу тестовую директорию:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /
<span class="gp">$</span> sudo rm -R tarantool_test
</pre></div>
</div>
</div>
</div>
<div class="section" id="utility-tarantoolctl-connect">
<span id="administration-tarantoolctl-connect"></span><h2>6.5. Утилита tarantoolctl connect<a class="headerlink" href="#utility-tarantoolctl-connect" title="Ссылка на этот заголовок">¶</a></h2>
<p>Утилита <strong class="program">tarantoolctl connect</strong> является клиентской программой. Вы можете использовать ее, чтобы устанавливать соединение с Tarantool-сервером и передавать запросы.</p>
<p>Для запуска этой утилиты введите:</p>
<pre class="highlight literal-block">
tarantoolctl connect <em>URI</em>
</pre>
<p>Формат URI описан <a class="reference internal" href="configuration/index.html#index-uri"><span class="std std-ref">тут</span></a>.</p>
<p>Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl connect username:password@127.0.0.1:3306
</pre></div>
</div>
<p>Вместо <strong class="program">tarantoolctl connect</strong> вы можете использовать модули <a class="reference internal" href="../reference_lua/console.html#console-module"><span class="std std-ref">console</span></a> или <a class="reference internal" href="../reference_lua/net_box.html#net-box-module"><span class="std std-ref">net.box</span></a> из библиотеки Tarantool'а. Еще одна альтернатива -- это написать клиентскую программу под любой из существующих Tarantool-коннекторов. Но для большинства примеров в текущей документации мы используем <strong class="program">tarantoolctl connect</strong> или <a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">Tarantool-сервер в качестве клиента</span></a>.</p>
<p>Всё, что написано о поведении <a class="reference internal" href="../reference_lua/console.html#console-connect"><span class="std std-ref">console.connect()</span></a>, в большинстве случаев верно и для <strong class="program">tarantoolctl connect</strong>. Например, <a class="reference internal" href="box/triggers.html#triggers-authentication-triggers"><span class="std std-ref">триггер аутентификации</span></a> активируется при каждом запуске и завершении программы <strong class="program">tarantoolctl connect</strong>.</p>
</div>
<div class="section" id="admin-ports">
<span id="administration-admin-ports"></span><h2>6.6. Порты для администрирования<a class="headerlink" href="#admin-ports" title="Ссылка на этот заголовок">¶</a></h2>
<p>Термины &quot;порт для администрирования&quot;, &quot;консоль для администрирования&quot;, &quot;текстовый протокол&quot; относятся к установке соединения с помощью <a class="reference internal" href="../reference_lua/console.html#console-listen"><span class="std std-ref">console.listen(...)</span></a> для ввода запросов от администраторов.</p>
<p>Термины &quot;бинарный порт&quot;, &quot;бинарный протокол&quot;, &quot;первичный порт&quot; относятся к другому виду соединения -- тому, что устанавливается с помощью параметра <a class="reference internal" href="configuration/index.html#cfg-basic-listen"><span class="std std-ref">box.cfg{listen=...}</span></a> и предназначено для ввода запросов от любых пользователей.</p>
<p>Для обычных соединений с Tarantool-сервером должен использоваться бинарный протокол. А порты для администрирования нужны для особых случаев, когда повышены требования к безопасности.</p>
<p>При установке соединение через порт для администрирования:</p>
<ul class="simple">
<li><p class="first">Пароль не требуется</p>
</li>
<li><p class="first">Пользователь автоматически получает привилегии администратора.</p>
</li>
</ul>
<p>Поэтому порты для администрирования следует настраивать очень осторожно. Если это TCP-порт, то он должен быть открыть только для определенного IP-адреса. В идеале мы рекомендуем вовсе не использовать TCP-порты. Вместо них лучше настроить доменный Unix-сокет, который требует настройки прав доступа к серверной машине. Тогда типичная настройка порта для администрирования будет выглядеть следующим образом:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">console.listen(&#39;/var/lib/tarantool/socket_name.sock&#39;)</span>
</pre></div>
</div>
<p>а типичный <a class="reference internal" href="configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> для соединения будет таким:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>admin:any_string@/var/lib/tarantool/socket_name.sock
</pre></div>
</div>
<p>Это в том случае, если у сервера (listener'а) есть привилегии на запись в файл <code class="file docutils literal"><span class="pre">/var/lib/tarantool</span></code>, а на стороне клиента (connector'а) есть привилегии на чтение из того же файла. Аналогично можно установить соединение и задать настройки с помощью <a class="reference internal" href="#administration-tarantoolctl"><span class="std std-ref">tarantoolctl</span></a>.</p>
<p>Если не задан пароль администратора, который можно сообщить пользователям, а порты для администрирования настроены с ограничением доступа по IP либо через сокеты, то запросы, требующие привилегий администратора, можно делать только локально, где вопросы безопасности и мониторинга регулируются с помощью средств Unix-системы.</p>
<p>В целях дополнительной безопасности некоторые запросы на портах для администрирования запрещены. Например, <a class="reference internal" href="../reference_lua/net_box.html#net-box-eval"><span class="std std-ref">conn:eval</span></a> вернет сообщение об ошибке <code class="docutils literal"><span class="pre">-</span> <span class="pre">error:</span> <span class="pre">console</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">support</span> <span class="pre">this</span> <span class="pre">request</span> <span class="pre">type</span></code>, поскольку запрос <code class="docutils literal"><span class="pre">conn:eval</span></code> должен осуществляться в рамках бинарного протокола.</p>
<p>Если вопросы безопасности на портах для администрирования неактуальны, то стать пользователем с правами администратора можно, <a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">используя Tarantool-сервер в качестве клиента</span></a> или указав администраторский пароль при установке соединения по бинарному протоколу.</p>
<p>Выяснить, является ли некий TCP-порт портом для администрирования, можно с помощью <strong class="program">telnet</strong>. Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> telnet <span class="m">0</span> 3303
<span class="go">Trying 0.0.0.0...</span>
<span class="go">Connected to 0.</span>
<span class="go">Escape character is &#39;^]&#39;.</span>
<span class="go">Tarantool 1.7.1-70-gbc479ad (Lua console)</span>
<span class="go">type &#39;help&#39; for interactive help</span>
</pre></div>
</div>
<p>В этом примере в ответе от сервера нет слова &quot;binary&quot; и есть слова &quot;Lua console&quot;. Это значит, что мы установили соединение на порту для администрирования и можем вводить администраторские запросы на этом терминале.</p>
</div>
<div class="section" id="system-specific-administration-notes">
<h2>6.7. Заметки по администрированию для разных платформ<a class="headerlink" href="#system-specific-administration-notes" title="Ссылка на этот заголовок">¶</a></h2>
<p>В этом разделе приводится информация по проблемам и особенностям, которые относятся только к конкретным платформам. Например, к определенным версиям Linux-систем.</p>
<div class="section" id="debian-gnu-linux-and-ubuntu">
<h3>6.7.1. Debian GNU/Linux and Ubuntu<a class="headerlink" href="#debian-gnu-linux-and-ubuntu" title="Ссылка на этот заголовок">¶</a></h3>
<p>Настройка конкретного экземпляра Tarantool-сервера:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /etc/tarantool/instances.available/*instance-name.cfg* /etc/tarantool/instances.enabled/
</pre></div>
</div>
<p>Запуск всех экземпляров:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool start
</pre></div>
</div>
<p>Остановка всех экземпляров:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool stop
</pre></div>
</div>
<p>Запуск/остановка конкретного экземпляра:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool-instance-name start/stop
</pre></div>
</div>
</div>
<div class="section" id="fedora-rhel-centos">
<h3>6.7.2. Fedora, RHEL, CentOS<a class="headerlink" href="#fedora-rhel-centos" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данных платформ нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &quot;RHEL&quot;, &quot;CentOS&quot;, &quot;Fedora&quot; или &quot;Red Hat&quot;.</p>
</div>
<div class="section" id="freebsd">
<h3>6.7.3. FreeBSD<a class="headerlink" href="#freebsd" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данной платформы нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &quot;FreeBSD&quot;.</p>
</div>
<div class="section" id="mac-os-x">
<h3>6.7.4. Mac OS X<a class="headerlink" href="#mac-os-x" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данных платформ нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &quot;OS X&quot;.</p>
</div>
</div>
<div class="section" id="notes-for-systemd-users">
<h2>6.8. Заметки для пользователей systemd<a class="headerlink" href="#notes-for-systemd-users" title="Ссылка на этот заголовок">¶</a></h2>
<p>Tarantool полностью поддерживает работу с <strong class="program">systemd</strong> как со средством для управления экземплярами и контроля за фоновыми программами базы данных.</p>
<div class="section" id="instance-management">
<h3>6.8.1. Управление экземплярами<a class="headerlink" href="#instance-management" title="Ссылка на этот заголовок">¶</a></h3>
<p>В архитектуре Tarantool'а заложена возможность запуска сразу многих экземпляров Tarantool-сервера на одной машине. С помощью <code class="samp docutils literal"><span class="pre">systemctl</span> <em><span class="pre">start|stop|restart|status</span></em> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> можно управлять базами данных и Lua-приложениями.</p>
<div class="section" id="creating-instances">
<h4>6.8.1.1. Создание экземпляров<a class="headerlink" href="#creating-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Задайте все настройки в виде Lua-скрипта и поместите их в файл <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3313</span><span class="p">}</span>
<span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myappcode&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>(это пример минимально достаточной конфигурации).</p>
<p>Также вы можете посмотреть пример Lua-скрипт в файле <code class="file docutils literal"><span class="pre">example.lua</span></code>, который входит в состав дистрибутива Tarantool'а и содержит значения всех опций.</p>
</div>
<div class="section" id="starting-instances">
<h4>6.8.1.2. Запуск экземпляров<a class="headerlink" href="#starting-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для запуска экземпляра <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl start tarantool@example
<span class="gp">$</span> ps axuf<span class="p">|</span>grep exampl<span class="o">[</span>e<span class="o">]</span>
<span class="go">taranto+  5350  1.3  0.3 1448872 7736 ?        Ssl  20:05   0:28 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>(здесь и далее мы приводим примеры консольного вывода для Fedora).</p>
<p>Для автоматической загрузки экземпляра <code class="docutils literal"><span class="pre">${MYAPP}</span></code> во время запуска всей системы используйте команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>.</p>
</div>
<div class="section" id="monitoring-instances">
<h4>6.8.1.3. Мониторинг экземпляров<a class="headerlink" href="#monitoring-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для проверки информации об экземпляре <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example
<span class="go">tarantool@example.service - Tarantool Database Server</span>
<span class="go">Loaded: loaded (/etc/systemd/system/tarantool@.service; disabled; vendor preset: disabled)</span>
<span class="go">Active: active (running)</span>
<span class="go">Docs: man:tarantool(1)</span>
<span class="go">Process: 5346 ExecStart=/usr/bin/tarantoolctl start %I (code=exited, status=0/SUCCESS)</span>
<span class="go">Main PID: 5350 (tarantool)</span>
<span class="go">Tasks: 11 (limit: 512)</span>
<span class="go">CGroup: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">+ 5350 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>Для проверки журнала загрузки выполните команду <code class="samp docutils literal"><span class="pre">journalctl</span> <span class="pre">-u</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 5
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:17:47 MSK. --</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Started Tarantool Database Server</span>
</pre></div>
</div>
</div>
<div class="section" id="attaching-to-instances">
<h4>6.8.1.4. Подсоединение к экземплярам<a class="headerlink" href="#attaching-to-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Вы можете подсоединиться к запущенному экземпляру Tarantool-сервера и выполнить некий Lua-скрипт с помощью утилиты <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; 1 + 1</span>
<span class="go">---</span>
<span class="go">- 2</span>
<span class="go">...</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-logs">
<h4>6.8.1.5. Проверка журнала<a class="headerlink" href="#checking-logs" title="Ссылка на этот заголовок">¶</a></h4>
<p>Tarantool ведет записи о важных событиях в файле <code class="file docutils literal"><span class="pre">/var/log/tarantool/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.log</span></code>.</p>
<p>Давайте запишем что-нибудь в файл журнала:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;log&#39;).info(&quot;Hello for README.systemd readers&quot;)</span>
<span class="go">---</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Затем проверим содержимое журнала:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tail /var/log/tarantool/example.log
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: started</span>
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: bound to 0.0.0.0:3301</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/tarantoolctl I&gt; ready to accept requests</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/example I&gt; Run console at /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/101/example I&gt; tcp_server: remove dead UNIX socket: /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/104/console/unix/:/var/run/tarant I&gt; started</span>
<span class="go">2016-01-21 21:09:45.985 [5914] main C&gt; entering the event loop</span>
<span class="go">2016-01-21 21:14:43.320 [5914] main/105/console/unix/: I&gt; client unix/: connected</span>
<span class="go">2016-01-21 21:15:07.115 [5914] main/105/console/unix/: I&gt; Hello for README.systemd readers</span>
<span class="go">2016-01-21 21:15:09.250 [5914] main/105/console/unix/: I&gt; client unix/: disconnected</span>
</pre></div>
</div>
<p>Для ротации журнала нужно установить программу <strong class="program">logrotate</strong>. Настройки для ротации можно задать в файле <code class="file docutils literal"><span class="pre">/etc/logrotate.d/tarantool</span></code>.</p>
</div>
<div class="section" id="stopping-instances">
<h4>6.8.1.6. Остановка экземпляров<a class="headerlink" href="#stopping-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для просмотра информации о запущенном экземпляре <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl stop tarantool@example
</pre></div>
</div>
</div>
</div>
<div class="section" id="daemon-supervision">
<h3>6.8.2. Контроль за фоновыми программами<a class="headerlink" href="#daemon-supervision" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если какой-либо экземпляр Tarantool-сервера выходит из строя, <strong class="program">systemd</strong> автоматически перезапускает его.</p>
<p>Давайте попробуем вывести из строя один экземпляр:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5885 (tarantool)</span>
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; os.exit(-1)</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p>А теперь убедимся, что <strong class="program">systemd</strong> перезапустила его:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5914 (tarantool)</span>
</pre></div>
</div>
<p>И под конец проверим содержимое журнала загрузки:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 8
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:09:45 MSK. --</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Unit entered failed state.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Failed with result &#39;exit-code&#39;.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Service hold-off time over, scheduling restart.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Started Tarantool Database Server.</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-the-service-file">
<h3>6.8.3. Правка настроек сервисного файла<a class="headerlink" href="#customizing-the-service-file" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пожалуйста, не редактируйте файл <code class="file docutils literal"><span class="pre">tarantool&#64;.service</span></code> по месту, поскольку все ваши изменения будут перезаписаны при последующих обновлениях Tarantool'а. Мы рекомендуем скопировать этот файл в <code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> и править настройки уже в копии. Либо вы можете создать поддиректорию с именем <code class="file docutils literal"><span class="pre">unit.d/</span></code> в директории <code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> и положить туда drop-in файл с именем <code class="file docutils literal"><span class="pre">name.conf</span></code>, в котором будут указаны только те настройки, которые нужно поменять. См. подробности в <code class="docutils literal"><span class="pre">systemd.unit(5)</span></code>.</p>
</div>
<div class="section" id="debugging">
<h3>6.8.4. Отладка<a class="headerlink" href="#debugging" title="Ссылка на этот заголовок">¶</a></h3>
<p>При аварийном завершении Tarantool-сервера, <strong class="program">coredumpctl</strong> автоматически сохраняет дампы памяти (core dumps) и трассировку стека (stack traces). Вот как работает этот механизм:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># !!! ВНИМАНИЕ: никогда не делайте этого</span>
<span class="gp">  #</span> в условиях промышленной эксплуатации !!!
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;ffi&#39;).cast(&#39;char *&#39;, 0)[0] = 48</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p>Введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">list</span> <span class="pre">/usr/bin/tarantool</span></code>, чтобы получить отчет о последних аварийных завершениях Tarantool-демона:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl list /usr/bin/tarantool
<span class="go">MTIME                            PID   UID   GID SIG PRESENT EXE</span>
<span class="go">Sat 2016-01-23 15:21:24 MSK   20681  1000  1000   6   /usr/bin/tarantool</span>
<span class="go">Sat 2016-01-23 15:51:56 MSK   21035   995   992   6   /usr/bin/tarantool</span>
</pre></div>
</div>
<p>Чтобы получить трассировку стека и прочую полезную информацию, введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl info 21035
<span class="go">          PID: 21035 (tarantool)</span>
<span class="go">          UID: 995 (tarantool)</span>
<span class="go">          GID: 992 (tarantool)</span>
<span class="go">       Signal: 6 (ABRT)</span>
<span class="go">    Timestamp: Sat 2016-01-23 15:51:42 MSK (4h 36min ago)</span>
<span class="go"> Command Line: tarantool example.lua &lt;running&gt;</span>
<span class="go">   Executable: /usr/bin/tarantool</span>
<span class="go">Control Group: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">         Unit: tarantool@example.service</span>
<span class="go">        Slice: system-tarantool.slice</span>
<span class="go">      Boot ID: 7c686e2ef4dc4e3ea59122757e3067e2</span>
<span class="go">   Machine ID: a4a878729c654c7093dc6693f6a8e5ee</span>
<span class="go">     Hostname: localhost.localdomain</span>
<span class="go">      Message: Process 21035 (tarantool) of user 995 dumped core.</span>

<span class="go">               Stack trace of thread 21035:</span>
<span class="gp">               #</span><span class="m">0</span>  0x00007f84993aa618 raise <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">1</span>  0x00007f84993ac21a abort <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">2</span>  0x0000560d0a9e9233 _ZL12sig_fatal_cbi <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">3</span>  0x00007f849a211220 __restore_rt <span class="o">(</span>libpthread.so.0<span class="o">)</span>
<span class="gp">               #</span><span class="m">4</span>  0x0000560d0aaa5d9d lj_cconv_ct_ct <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">5</span>  0x0000560d0aaa687f lj_cconv_ct_tv <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">6</span>  0x0000560d0aaabe33 lj_cf_ffi_meta___newindex <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">7</span>  0x0000560d0aaae2f7 lj_BC_FUNCC <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">8</span>  0x0000560d0aa9aabd lua_pcall <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">9</span>  0x0000560d0aa71400 lbox_call <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">10</span> 0x0000560d0aa6ce36 lua_fiber_run_f <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">11</span> 0x0000560d0a9e8d0c _ZL16fiber_cxx_invokePFiP13__va_list_tagES0_ <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">12</span> 0x0000560d0aa7b255 fiber_loop <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">13</span> 0x0000560d0ab38ed1 coro_init <span class="o">(</span>tarantool<span class="o">)</span>
<span class="go">               ...</span>
</pre></div>
</div>
<p>Теперь введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">-o</span> <span class="pre">filename.core</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code>, чтобы сохранить дамп памяти в отдельный файл.</p>
<p>Далее с помощью команды <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">gdb</span> <span class="pre">&lt;pid&gt;</span></code> запустим отладчик <strong class="program">gdb</strong> и подадим сохраненный дамп памяти ему на вход.</p>
<p>Мы очень рекомендуем установить пакет <code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code>, чтобы сделать отладку средствами <strong class="program">gdb</strong> более эффективной. Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> dnf debuginfo-install tarantool
</pre></div>
</div>
<p>С помощью <strong class="program">gdb</strong> вы можете узнать, какие еще <code class="docutils literal"><span class="pre">debuginfo</span></code>-пакеты нужно установить:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># gdb -p &lt;pid&gt;</span>
<span class="go">...</span>
<span class="go">Missing separate debuginfos, use: dnf debuginfo-install</span>
<span class="go">glibc-2.22.90-26.fc24.x86_64 krb5-libs-1.14-12.fc24.x86_64</span>
<span class="go">libgcc-5.3.1-3.fc24.x86_64 libgomp-5.3.1-3.fc24.x86_64</span>
<span class="go">libselinux-2.4-6.fc24.x86_64 libstdc++-5.3.1-3.fc24.x86_64</span>
<span class="go">libyaml-0.1.6-7.fc23.x86_64 ncurses-libs-6.0-1.20150810.fc24.x86_64</span>
<span class="go">openssl-libs-1.0.2e-3.fc24.x86_64</span>
</pre></div>
</div>
<p>В трассировке стека используются символические имена, даже если у вас не установлен пакет <code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code>.</p>
<p>Дополнительно см. документацию по вашей Linux-системе.</p>
</div>
<div class="section" id="precautions">
<h3>6.8.5. Особые указания<a class="headerlink" href="#precautions" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li><p class="first">Пожалуйста, не используйте <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">{start,stop,restart}</span></code> для управления экземплярами, которые были запущены с помощью <strong class="program">systemd</strong>. Но вы можете использовать <strong class="program">tarantoolctl</strong> для запуска/остановки экземпляров в ваших локальных директориях (например, <code class="file docutils literal"><span class="pre">$</span><em><span class="pre">HOME</span></em></code>), что не требует пользовательских прав уровня <code class="docutils literal"><span class="pre">ROOT</span></code>.</p>
</li>
<li><p class="first">Утилита <strong class="program">tarantoolctl</strong> уже настроена так, чтобы корректно работать с <strong class="program">systemd</strong>. Пожалуйста, не меняйте общесистемные настройки для <strong class="program">tarantoolctl</strong>, такие как пути, настройки прав для директорий и имена пользователей, т.к. это может привести к неожиданным проблемам.</p>
</li>
<li><p class="first">Поддержкой скриптов для <strong class="program">systemd</strong> занимается команда разработки Tarantool'а (<a class="reference external" href="http://tarantool.org">http://tarantool.org</a>). Если у вас возникли проблемы при работе Tarantool'а с <strong class="program">systemd</strong>, то мы просим сообщать об этом нашей команде (<a class="reference external" href="https://github.com/tarantool/tarantool/issues/">https://github.com/tarantool/tarantool/issues/</a>), а не разработчикам вашего Linux-дистрибутива.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="updating-tarantool-in-production">
<h2>6.9. Обновление Tarantool'а в условиях эксплуатации<a class="headerlink" href="#updating-tarantool-in-production" title="Ссылка на этот заголовок">¶</a></h2>
<p>Во-первых, вынесите всю бизнес-логику своего приложения в отдельный Tarantool-модуль на языке Lua так, чтобы все нужные функции были доступны для вызова извне (CALL).</p>
<p>Вот пример такого модуля, файл <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="k">function</span> <span class="nf">start</span><span class="p">()</span>
<span class="c1">-- Первоначальная версия</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.1.0&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">somedata&quot;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">primary&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">end</span>

<span class="c1">-- Код для миграции с 1.0 на 1.1</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.1&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">end</span>

<span class="c1">-- Код для миграции с 1.1 на 1.2</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.2&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">space</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">insert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">end</span>

<span class="c1">-- Если нужно, запустить файберы в фоновом режиме</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">stop</span><span class="p">()</span>
<span class="c1">-- Остановить все фоновые файберы и освободить ресурсы</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">api_for_call</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span>
<span class="c1">-- Сделать что-то полезное</span>
<span class="k">end</span>

<span class="k">return</span> <span class="p">{</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">;</span>
<span class="n">api_for_call</span> <span class="o">=</span> <span class="n">api_for_call</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Поддержка этого файла лежит на стороне разработчиков приложения. А команда разработки Tarantool'а со своей стороны предлагает шаблоны, для того чтобы вы могли <a class="reference external" href="https://github.com/tarantool/modulekit">создать у себя deb/rpm-сборку</a>, а также утилиты для быстрого <a class="reference external" href="https://github.com/tarantool/build">создания сборок под разные платформы</a>. Если понадобится, вы можете разбить приложения на отдельные файлы и/или модули.</p>
<p>Во вторых, положите скрипт инициализации в директорию <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available</span></code>.</p>
<p>Вот пример такого скрипта, файл <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/myappcfg.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>

<span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
<span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">myapp</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
<span class="c1">-- &quot;Горячая&quot; загрузка кода с помощью tarantoolctl или dofile()</span>

<span class="c1">-- Выгрузка старого приложения</span>
<span class="n">myapp</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
<span class="c1">-- Очистка кеша от загруженных модулей и зависимостей</span>
<span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">somedep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span> <span class="c1">-- dependency of &#39;myapp&#39;</span>
<span class="k">end</span>

<span class="c1">-- Загрузка новой версии приложения и всех зависимостей</span>
<span class="n">myapp</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">({</span><span class="n">some</span> <span class="n">app</span> <span class="n">options</span> <span class="n">controlled</span> <span class="n">by</span> <span class="n">sysadmins</span><span class="p">})</span>
</pre></div>
</div>
<p>Более детальный пример (со всеми настройками) содержится в файле <code class="file docutils literal"><span class="pre">example.lua</span></code>, который входит в состав дистрибутива Tarantool'а.</p>
<p>Этот скрипт инициализации по сути является конфигурационным файлом. Его поддержкой должны заниматься системные администраторы, в то время как разработчики только предоставляют им шаблон.</p>
<p>Теперь обновите файл с вашим приложением в директории <code class="file docutils literal"><span class="pre">/usr/share/tarantool</span></code>. Замените старую версию файла (например, <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>) и вручную загрузите скрипт инициализации <code class="file docutils literal"><span class="pre">myappcfg.lua</span></code> с помощью утилиты <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl <span class="nb">eval</span> /etc/tarantool/instance.enabled/myappcfg.lua
</pre></div>
</div>
<p>После этого вам нужно вручную очистить кеш модулей <code class="docutils literal"><span class="pre">package.loaded</span></code>.</p>
<p>Чтобы создать deb/rpm-сборку, вы можете добавить инструкцию <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">eval</span></code> прямо в спецификацию Tarantool'а в файле <code class="file docutils literal"><span class="pre">RPM.spec</span></code> и в директории <code class="file docutils literal"><span class="pre">/debian</span></code>.</p>
<p>В итоге клиенты делают вызов (CALL) функции <code class="docutils literal"><span class="pre">myapp.api_for_call</span></code> и других функций из API.</p>
<p>Если вы используете <code class="docutils literal"><span class="pre">tarantool-http</span></code>, то запускать бинарный протокол не нужно.</p>
</div>
<div class="section" id="backups">
<h2>6.10. Резервное копирование<a class="headerlink" href="#backups" title="Ссылка на этот заголовок">¶</a></h2>
<p>При выборе конкретной процедуры для резервного копирования базы данных нужно учитывать следующие требования: насколько актуальной должна быть копия, можно ли временно отключать других пользователей, а также нужна ли оптимизация размера копии (чтобы копия занимала меньше места на диске) или скорости самой процедуры (чтобы процедура занимала меньше времени). Выбирать можно из нескольких вариантов в диапазоне от &quot;простого и холодного&quot; до &quot;трудного и горячего&quot;.</p>
<p><strong>&quot;Холодное&quot; резервирование</strong></p>
<p>Суть процедуры: последний созданный Tarantool'ом файл-снимок является резервной копией всей базы; а WAL-файлы, созданные следом, являются инкрементными копиями. Поэтому вся процедура резервирования сводится к копированию последнего файла-снимка и последующих WAL-файлов.</p>
<ol class="arabic simple">
<li><p class="first">Временно запретите всем пользователям делать записи в базе. Для этого можно остановить Tarantool-сервер, либо ввести запрос <code class="docutils literal"><span class="pre">box.cfg{read_only=true}</span></code> и убедиться, что все обращения на запись завершились (для этого можно использовать <strong class="program">fsync</strong>).</p>
</li>
<li><p class="first">Если вы хотите создать резеврную копию для всей базы целиком, введите запрос <code class="samp docutils literal"><span class="pre">box.snapshot()</span></code>.</p>
</li>
<li><p class="first">С помощью <strong class="program">tar</strong> создайте сжатую (насколько это можно) копию последнего <code class="file docutils literal"><span class="pre">.snap</span></code>-файла и последующих <code class="file docutils literal"><span class="pre">.xlog</span></code>-файлов из директорий <a class="reference internal" href="configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> и <a class="reference internal" href="configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a>.</p>
</li>
<li><p class="first">Если того требуют правила безопасности, зашифруйте получившийся <code class="file docutils literal"><span class="pre">tar</span></code>-файл.</p>
</li>
<li><p class="first">Скопируйте <code class="file docutils literal"><span class="pre">tar</span></code>-файл в надежное место.</p>
</li>
</ol>
<p>... В дальнейшем вы сможете восстановить базу данных, просто взяв этот <code class="file docutils literal"><span class="pre">tar</span></code>-файл и разархивировав его содержимое в директории <code class="docutils literal"><span class="pre">snap_dir</span></code> и <code class="docutils literal"><span class="pre">wal_dir</span></code>.</p>
<p><strong>Постоянное удаленное резервирование</strong></p>
<p>Суть процедуры: для резервирования (а также для балансирования нагрузки) можно использовать <a class="reference internal" href="replication/index.html#index-box-replication"><span class="std std-ref">репликацию</span></a>. Процедура резервирования в рамках репликационного кластера сводится к тому, чтобы держать все реплики в актуальном состоянии и периодически делать с них &quot;холодные&quot; копии. Поскольку во время снятия копии с какой-либо одной реплики все остальные реплики продолжают синхронизироваться с главным сервером, то эта процедура несколько отличается от описанной выше процедуры &quot;холодного&quot; резервирования. Регулярное резервирование в кластере можно настроить с помощью планировщика <strong class="program">cron</strong> или Tarantool-файбера.</p>
<p><strong>&quot;Горячее&quot; резервирование</strong></p>
<p>Суть процедуры: по ходу работы системы нужно сохранять записи об изменениях, сделанных со времени последнего &quot;холодного&quot; резервирования.</p>
<p>Для этого вам понадобится специальная утилита для копирования частей файлов (например, <a class="reference external" href="https://en.wikipedia.org/wiki/rsync">rsync</a>), которая позволит удаленно и на постоянной основе копировать только изменившиеся части файлов-снимков и WAL-файлов, а не все эти файлы целиком.</p>
<p>Вы можете взять и обычную утилиту (для копирования файлов целиком), но тогда вам придется создавать файлы-снимки и WAL-файлы на каждое изменение, чтобы нужно было копировать только новые файлы.</p>
<p>Примечание про движок: при организации резервирования для баз данных на движке vinyl понадобятся дополнительные действия.</p>
</div>
<div class="section" id="upgrades">
<h2>6.11. Обновление Tarantool'а<a class="headerlink" href="#upgrades" title="Ссылка на этот заголовок">¶</a></h2>
<p>Эта информация полезна в том случае, если у вас есть база данных, работающая на какой-либо старой версии Tarantool'а, а теперь вы установили Tarantool новой версии. В этом случае выполните запрос <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code>.</p>
<p>Например, вот что происходит, если выполнить запрос <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code> для базы, созданной в начале 2015 года (для примера показана лишь малая часть выводимых сообщений):</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">upgrade</span><span class="p">()</span>
<span class="go">alter index primary on _space set options to {&quot;unique&quot;:true}, parts to [[0,&quot;unsigned&quot;]]</span>
<span class="go">alter space _schema set options to {}</span>
<span class="go">create view _vindex...</span>
<span class="go">grant read access to &#39;public&#39; role for _vindex view</span>
<span class="go">set schema version to 1.7.0</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
<div data-disqus-identifier="Server administration" data-disqus-shortname="tarantooldb" id="disqus_thread"></div></div>
</div>


  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="configuration/index.html"
           class="b-prev b-ellipsis"
           title="5. Справочник по конфигурированию">5. Справочник по конфигурированию</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../_sources/book/administration.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="connectors/index.html"
           class="b-next b-ellipsis"
           title="7. Коннекторы">7. Коннекторы</a>
      </div>
    
    </div>
  
</div>
      </div>
    </div>
  
  <script>
  </script>

      </div>
    </div>

    <!-- FOOTER > -->
    <footer class="b-footer">
      <div class="b-footer-wrapper">
        <nav class="b-footer_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          <div class="b-footer-other">
            <a href="http://stable.tarantool.org">1.5 web site and downloads</a>
          </div>
        </nav>
      </div>
    </footer>
  <!-- < FOOTER -->
  </body>
</html>

