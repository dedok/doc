





<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>5. Администрирование серверной части</title>
    <link rel="icon" type="image/png" sizes="192x192"
          href="/theme/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32"
          href="/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96"
          href="/theme/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16"
          href="/theme/favicon/favicon-16x16.png">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.2',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          // Replace PAGE_URL with your page's canonical URL variable
          // this.page.url = PAGE_URL;
          this.page.identifier = "book/administration";
          this.language = "ru"
      };
    </script>
    <script id="dsq-count-scr" src="https://tarantooldb.disqus.com/count.js" async/></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/stacktable.min.js"></script>
    <script type="text/javascript" src="../_static/headers.js"></script>
    <script type="text/javascript" src="/js/menu.js"></script>
    <script type="text/javascript" src="/js/mobile_menu.js"></script>
    <link rel="stylesheet" href="/theme/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="../_static/sphinx_design.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design b-doc-book/administration">
  
    <div class="b-scrollview">
        <div class="b-wrapper">
        <!-- HEADER > -->
        
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search" action="../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

        </nav>
      </div>
      
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      </nav>
    </div>
  </header>

        <!-- < HEADER -->

        <div class="b-content b-clearbox">
            
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
    <div class="b-block-wrapper">
      <h2
      
        class="b-section-title b-ellipsis toggle-navigation"
      
        title="5. Администрирование серверной части">
          5. Администрирование серверной части
      </h2>
  <div class="b-doc-language_selector">
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../book/administration.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>
  </div>
</div>
  </section>
  
    <div class="b-cols_content b-clearbox">
      <div class="b-cols_content_left">
        <div class="b-menu-toc">
          
<form id="searchbox" role="search" class="search b-search" action="../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">Что нового?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whats_new.html#what-s-new-in-tarantool-1-7">Что нового в Tarantool 1.7?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Общие сведения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#an-application-server-together-with-a-database-manager">Сервер приложений + СУБД</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#database-features">Возможности СУБД</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Практикум</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/lua_tutorials.html">1. Практические задания на Lua</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#insert-one-million-tuples-with-a-lua-stored-procedure">1.1. Вставка 1 млн кортежей с помощью хранимой процедуры на языке Lua</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#configure">1.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#delimiter">1.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-returns-a-string">1.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-calls-another-function-and-sets-a-variable">1.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-one-letter-random-string">1.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-ten-letter-random-string">1.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#make-a-tuple-out-of-a-number-and-a-string">1.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-tuple-into-the-database">1.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-million-tuples-into-the-database">1.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#sum-a-json-field-for-all-tuples">1.2. Подсчет суммы по JSON-полям во всех кортежах</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#indexed-pattern-search">1.3. Индексированный поиск по шаблонам</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/c_tutorial.html">2. Практическое задание на C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/c_tutorial.html#c-stored-procedures">2.1. Хранимые процедуры на языке C</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Руководство пользователя</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Предисловие</a><ul>
<li class="toctree-l3"><a class="reference internal" href="intro.html#how-to-read-the-documentation">1.1. Как пользоваться документацией</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#getting-in-touch-with-the-tarantool-community">1.2. Как связаться с сообществом разработчиков Tarantool&#8217;а</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide_getting_started.html">2. Начало работы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Скачивание и установка бинарного пакета</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Первичный запуск Tarantool&#8217;а и создание базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#connecting-remotely">2.3. Установка удаленного соединения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="box/index.html">3. Функционал СУБД</a><ul>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#data-model">3.1. Модель данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#space">3.1.1. Пространство</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#tuple-set">3.1.2. Набор кортежей</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#index">3.1.3. Индекс</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#data-types">3.1.4. Типы данных</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#operations">3.1.5. Операции</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#persistence">3.1.6. Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#data-manipulation">3.1.7. Манипулирование данными</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#index-operations">3.1.8. Операции с индексами</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#transaction-control">3.2. Контроль транзакций</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#cooperative-multitasking-environment">3.2.1. Среда взаимной многозадачности</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#example">3.2.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#implicit-yields">3.2.2. Implicit yields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#access-control">3.3. Ограничение доступа</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#passwords">3.3.1. Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#users-and-the-user-space">3.3.2. Users and the _user space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#privileges-and-the-priv-space">3.3.3. Privileges and the _priv space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#functions-and-the-func-space">3.3.4. Functions and the _func space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#box-session-and-security">3.3.5. box.session and security</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#roles">3.3.6. Roles</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#example-showing-a-role-within-a-role">3.3.6.1. Example showing a role within a role</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#triggers">3.4. Триггеры</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#connection-triggers">3.4.1. Connection triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#id3">3.4.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#authentication-triggers">3.4.2. Authentication triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#lua-module.box.space">3.4.3. Replace triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#id4">3.4.3.1. Пример</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#another-example">3.4.3.2. Another example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#getting-a-list-of-triggers">3.4.4. Getting a list of triggers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#limitations">3.5. Ограничения</a></li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#vinyl-storage-engine">3.6. Дисковый движок vinyl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#differences-between-memtx-and-vinyl-storage-engines">3.6.1. Различия между движками memtx и vinyl</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#vinyl-features">3.6.2. Vinyl features</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#under-the-hood">3.6.3. А что там &#8220;под капотом&#8221;?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-first-200-000-keys">3.6.3.1. Inserting the first 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-next-300-000-keys">3.6.3.2. Inserting the next 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-next-200-000-keys">3.6.3.3. Inserting the next 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-last-300-000-keys">3.6.3.4. Inserting the last 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#reading-million-keys">3.6.3.5. Reading million keys</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="app_server.html">4. Сервер приложений</a><ul>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#about-modules-rocks">4.1. Про модули/rocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#installing-an-existing-module">4.2. Установка существующего модуля</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-new-lua-module-locally">4.3. Создание нового модуля на языке Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-new-c-c-module-locally">4.4. Создание нового модуля на языке C/C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-mixed-lua-c-module-locally">4.5. Создание нового модуля на смеси языков Lua/C</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#tips-for-special-situations">4.6. Примечания для особых случаев</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#cookbook-recipes">4.7. Книга рецептов</a><ul>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#hello-world-lua">4.7.1. hello_world.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#console-start-lua">4.7.2. console_start.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fio-read-lua">4.7.3. fio_read.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fio-write-lua">4.7.4. fio_write.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-printf-lua">4.7.5. ffi_printf.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-gettimeofday-lua">4.7.6. ffi_gettimeofday.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-zlib-lua">4.7.7. ffi_zlib.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-meta-lua">4.7.8. ffi_meta.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#print-arrays-lua">4.7.9. print_arrays.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-lua">4.7.10. count_array.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-with-nils-lua">4.7.11. count_array_with_nils.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-with-nulls-lua">4.7.12. count_array_with_nulls.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-map-lua">4.7.13. count_map.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#swap-lua">4.7.14. swap.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#uri-lua">4.7.15. uri.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#class-lua">4.7.16. class.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#garbage-lua">4.7.17. garbage.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fiber-producer-and-consumer-lua">4.7.18. fiber_producer_and_consumer.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-tcpconnect-lua">4.7.19. socket_tcpconnect.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-tcp-echo-lua">4.7.20. socket_tcp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#getaddrinfo-lua">4.7.21. getaddrinfo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-udp-echo-lua">4.7.22. socket_udp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-get-lua">4.7.23. http_get.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-send-lua">4.7.24. http_send.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-server-lua">4.7.25. http_server.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-generate-html-lua">4.7.26. http_generate_html.lua</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5. Администрирование серверной части</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-tarantool-as-a-client">5.1. Использование tarantool в качестве клиента</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#conventions-used-in-this-section">5.1.1. Условные обозначения, используемые в этом разделе</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-when-starting-client-from-the-command-line">5.1.2. Параметры запуска клиента из командной строки</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tokens-requests-and-special-key-combinations">5.1.3. Токены, запросы и специальные комбинации клавиш</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requests">5.1.4. Запросы</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#utility-tarantoolctl">5.2. Утилита tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-for-tarantoolctl">5.2.1. Конфигурирование tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commands-for-tarantoolctl">5.2.2. Команды для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#typical-code-snippets-for-tarantoolctl">5.2.3. Примеры кода для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-detailed-example-for-tarantoolctl">5.2.4. Подробный пример для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#an-example-for-tarantoolctl-connect">5.2.5. An example for tarantoolctl connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#administrative-ports">5.3. Служебные порты</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administrative-requests">5.4. Служебные запросы</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-introspection">5.5. Просмотр состояния сервера</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lua-module.box.cfg">5.5.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#lua-module.box.info">5.5.2. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#lua-module.box.slab">5.5.3. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#submodule-box-stat">5.5.4. Submodule <cite>box.stat</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#replication">5.6. Репликация</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#replication-architecture">5.6.1. Архитектура механизма репликации</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-a-master">5.6.2. Setting up a master</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-a-replica">5.6.3. Настройка сервера-реплики</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recovering-from-a-degraded-state">5.6.4. Восстановление после сбоя</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-startup-of-a-new-simple-two-server-cluster">5.6.5. Quick startup of a new simple two-server cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-a-replica-s-actions">5.6.6. Мониторинг действий реплики</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preventing-duplicate-actions">5.6.7. Предотвращение дублирующихся действий</a></li>
<li class="toctree-l4"><a class="reference internal" href="#master-master-replication">5.6.8. Репликация по схеме master-master</a></li>
<li class="toctree-l4"><a class="reference internal" href="#all-the-what-if-questions">5.6.9. Ответы на вопросы &#8220;Что если?&#8221;</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hands-on-replication-tutorial">5.6.10. Практическое руководство по репликации</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#backups">5.7. Резервное копирование</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cold-backup">5.7.1. Cold backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#continuous-remote-backup">5.7.2. Continuous remote backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hot-backup">5.7.3. Hot backup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updates-upgrades">5.8. Обновление сервера и базы данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#updating-tarantool-in-production">5.8.1. Обновление Tarantool&#8217;а в условиях эксплуатации</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-a-tarantool-database">5.8.2. Upgrading a Tarantool database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#server-signal-handling">5.9. Обработка сигналов от сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-title">5.10. Название процесса</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-specific-administration-notes">5.11. Заметки по администрированию для разных платформ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debian-gnu-linux-and-ubuntu">5.11.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fedora-rhel-centos">5.11.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freebsd">5.11.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-os-x">5.11.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#notes-for-systemd-users">5.12. Заметки для пользователей systemd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#instance-management">5.12.1. Управление экземплярами</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#creating-instances">5.12.1.1. Создание экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="#starting-instances">5.12.1.2. Запуск экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="#monitoring-instances">5.12.1.3. Мониторинг экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="#attaching-to-instances">5.12.1.4. Подсоединение к экземплярам</a></li>
<li class="toctree-l5"><a class="reference internal" href="#checking-logs">5.12.1.5. Проверка журнала</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stopping-instances">5.12.1.6. Остановка экземпляров</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#daemon-supervision">5.12.2. Контроль за фоновыми программами</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-the-service-file">5.12.3. Правка настроек сервисного файла</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">5.12.4. Отладка</a></li>
<li class="toctree-l4"><a class="reference internal" href="#precautions">5.12.5. Особые указания</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">5.12.6. Ограничения</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sysvinit-systemd-conversion">5.12.7. sysvinit -&gt; systemd conversion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="connectors/index.html">6. Коннекторы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#protocol">6.1. Протокол</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#packet-example">6.2. Пример пакета данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#setting-up-the-server-for-connector-examples">6.3. Настройка окружения для примеров работы с коннекторами</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#java">6.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#go">6.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#r">6.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#perl">6.7. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#php">6.8. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#python">6.9. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#c">6.10. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="connectors/index.html#example-1">6.10.1. Пример 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="connectors/index.html#example-2">6.10.2. Пример 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#interpreting-function-return-values">6.11. Интерпретация возвращаемых значений</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">7. Вопросы и ответы</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Справочники</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_lua/index.html">1. Справочник по встроенной библиотеке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box.html">1.1. Module <cite>box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/box_schema.html">1.1.1. Вложенный модуль <cite>box.schema</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="box/box_space.html">1.1.2. Вложенный модуль <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_space.html#example-use-box-space-functions-to-read-space-tuples">1.1.2.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">1.1.2.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_index.html">1.1.3. Вложенный модуль <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#example-showing-use-of-the-box-functions">1.1.3.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#example-showing-a-user-defined-iterator">1.1.3.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">1.1.3.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_session.html">1.1.4. Вложенный модуль <cite>box.session</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_session.html#example">1.1.4.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_tuple.html">1.1.5. Вложенный модуль <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_tuple.html#example">1.1.5.1. Пример</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/console.html">1.3. Module <cite>console</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/crypto.html">1.4. Module <cite>crypto</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#incremental-methods-in-the-crypto-module">1.4.1. Incremental methods in the crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">1.4.2. Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/csv.html">1.5. Module <cite>csv</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/digest.html">1.6. Module <cite>digest</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#incremental-methods-in-the-digest-module">1.6.1. Incremental methods in the digest module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#example">1.6.2. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_error.html">1.7. Submodule <cite>box.error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber.html">1.8. Module <cite>fiber</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber.html#example-of-fiber-use">1.8.1. Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html">1.9. Submodule <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#example">1.9.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_cond.html">1.10. Submodule <cite>fiber-cond</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_cond.html#example">1.10.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fio.html">1.11. Module <cite>fio</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-pathname-manipulations">1.11.1. Common pathname manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-file-manipulations">1.11.2. Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fun.html">1.12. Module <cite>fun</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/json.html">1.13. Module <cite>json</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/json.html#configuration-settings">1.13.1. Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/log.html">1.14. Module <cite>log</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/log.html#example">1.14.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/msgpack.html">1.15. Module <cite>msgpack</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/msgpack.html#example">1.15.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/net_box.html">1.16. Module <cite>net.box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/net_box.html#example-showing-use-of-most-of-the-net-box-methods">1.16.1. Example showing use of most of the net.box methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_once.html">1.17. Function <cite>box.once</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/pickle.html">1.18. Module <cite>pickle</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/socket.html">1.19. Module <cite>socket</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/socket.html#example">1.19.1. Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">1.19.1.1. Use of a TCP socket over the Internet</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-udp-socket-on-localhost">1.19.1.2. Use of a UDP socket on localhost</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">1.19.1.3. Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/strict.html">1.20. Module <cite>strict</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tap.html">1.21. Module <cite>tap</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/tap.html#example">1.21.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tarantool.html">1.22. Module <cite>tarantool</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/uuid.html">1.23. Module <cite>uuid</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/uuid.html#example">1.23.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/yaml.html">1.24. Module <cite>yaml</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/yaml.html#example">1.24.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/other.html">1.25. Miscellaneous</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errcodes.html">1.26. Коды ошибок от базы данных</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_rock/index.html">2. Справочник по сторонним библиотекам</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/dbms.html">2.1. Модули SQL DBMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#mysql-example">2.1.1. MySQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#installation">2.1.1.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-luarocks">2.1.1.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-github">2.1.1.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#connecting">2.1.1.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#how-to-ping">2.1.1.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#executing-a-statement">2.1.1.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#closing-connection">2.1.1.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#example">2.1.1.6. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#postgresql-example">2.1.2. PostgreSQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id1">2.1.2.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id2">2.1.2.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id3">2.1.2.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id4">2.1.2.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id5">2.1.2.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id6">2.1.2.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id7">2.1.2.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id8">2.1.2.6. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/expirationd.html">2.2. Module <cite>expirationd</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/shard.html">2.3. Module <cite>shard</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-one-shard">2.3.1. Example: shard.init syntax for one shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-three-shards">2.3.2. Example: shard.init syntax for three shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-minimal-configuration">2.3.3. Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-scaling-out">2.3.4. Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/tdb.html">2.4. Module <cite>tdb</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#debugger-commands">2.4.1. Debugger Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#example-session">2.4.2. Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration/index.html">3. Справочник по настройке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#command-options">3.1. Опции комнандной строки</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#uri">3.2. Универсальный код ресурса (URI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#initialization-file">3.3. Файл инициализации</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#configuration-parameters">3.4. Параметры конфигурации</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#basic-parameters">3.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#configuring-the-storage">3.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#snapshot-daemon">3.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#binary-logging-and-snapshots">3.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#replication">3.4.5. Replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#networking">3.4.6. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#logging">3.4.7. Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Руководство участника проекта</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/reference_capi/index.html">1. Справочник по C API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/box.html">1.1. Module <cite>box</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/coio.html">1.3. Module <cite>coio</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/error.html">1.4. Module <cite>error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/fiber.html">1.5. Module <cite>fiber</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/box_index.html">1.6. Module <cite>index</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/latch.html">1.7. Module <cite>latch</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/utils.html">1.8. Module <cite>lua/utils</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/say.html">1.9. Module <cite>say</cite> (logging)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/schema.html">1.10. Module <cite>schema</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/trivia.html">1.11. Module <cite>trivia/config</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/tuple.html">1.12. Module <cite>tuple</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/txn.html">1.13. Module <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/internals_index.html">2. Детали реализации</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#tarantool-s-binary-protocol">2.1. Бинарный протокол в Tarantool&#8217;е</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#notation-in-diagrams">2.1.1. Notation in diagrams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#greeting-packet">2.1.2. Пакет-приветствие</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#unified-packet-structure">2.1.3. Unified packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#authentication">2.1.4. Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#requests">2.1.5. Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#response-packet-structure">2.1.6. Response packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#replication-packet-structure">2.1.7. Replication packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#xlog-snap">2.1.8. XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#data-persistence-and-the-wal-file-format">2.2. Персистентность данных и формат WAL-файла</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#the-snapshot-file-format">2.3. Формат файла-снимка</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#the-recovery-process">2.4. Процесс восстановления после сбоя</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#server-startup-with-replication">2.5. Запуск сервера в режиме репликации</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/build_contribute_index.html">3. Сборка и участие в проекте</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/building_from_source.html">3.1. Сборка из исходных файлов</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/building_documentation.html">3.2. Сборка документации</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/release_management.html">3.3. Работа с релизами</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/release_management.html#how-to-make-a-minor-release">3.3.1. How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/guidelines_index.html">4. Соглашения по разработке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/developer_guidelines.html">4.1. Соглашения по разработке</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/developer_guidelines.html#how-to-work-on-a-bug">4.1.1. How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/documentation_guidelines.html">4.2. Соглашения по документации</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#markup-issues">4.2.1. Markup issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#wrapping-text">4.2.1.1. Wrapping text</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#formatting-code-snippets">4.2.1.2. Formatting code snippets</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#using-separated-links">4.2.1.3. Using separated links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#creating-labels-for-local-links">4.2.1.4. Creating labels for local links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#making-comments">4.2.1.5. Making comments</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#language-and-style-issues">4.2.2. Language and style issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#us-vs-british-spelling">4.2.2.1. US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#examples-and-templates">4.2.3. Examples and templates</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#module-and-function">4.2.3.1. Module and function</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#module-class-and-method">4.2.3.2. Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/c_style_guide.html">4.3. Соглашения по разработке на языке C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/c_style_guide.html#general-guidelines">4.3.1. General guidelines</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#commenting-style">4.3.1.1. Commenting style</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#header-files">4.3.1.2. Header files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#allocating-memory">4.3.1.3. Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#other">4.3.1.4. Other</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/c_style_guide.html#linux-kernel-coding-style">4.3.2. Linux kernel coding style</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-1-indentation">4.3.2.1. Chapter 1: Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-2-breaking-long-lines-and-strings">4.3.2.2. Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-3-placing-braces-and-spaces">4.3.2.3. Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-3-1-spaces">4.3.2.4. Chapter 3.1:  Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-4-naming">4.3.2.5. Chapter 4: Naming</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-5-typedefs">4.3.2.6. Chapter 5: Typedefs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-6-functions">4.3.2.7. Chapter 6: Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-7-centralized-exiting-of-functions">4.3.2.8. Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-8-commenting">4.3.2.9. Chapter 8: Commenting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-9-you-ve-made-a-mess-of-it">4.3.2.10. Chapter 9: You&#8217;ve made a mess of it</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-10-kconfig-configuration-files">4.3.2.11. Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-11-data-structures">4.3.2.12. Chapter 11: Data structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-12-macros-enums-and-rtl">4.3.2.13. Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-13-printing-kernel-messages">4.3.2.14. Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-14-allocating-memory">4.3.2.15. Chapter 14: Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-15-the-inline-disease">4.3.2.16. Chapter 15: The inline disease</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-16-function-return-values-and-names">4.3.2.17. Chapter 16: Function return values and names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-17-don-t-re-invent-the-kernel-macros">4.3.2.18. Chapter 17:  Don&#8217;t re-invent the kernel macros</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-18-editor-modelines-and-other-cruft">4.3.2.19. Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#appendix-i-references">4.3.2.20. Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/python_style_guide.html">4.4. Соглашения по разработке на языке Python</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#introduction">4.4.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">4.4.2. A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#code-lay-out">4.4.3. Code lay-out</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#indentation">4.4.3.1. Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#tabs-or-spaces">4.4.3.2. Tabs or Spaces?</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#maximum-line-length">4.4.3.3. Maximum Line Length</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#blank-lines">4.4.3.4. Blank Lines</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#encodings-pep-263">4.4.3.5. Encodings (PEP 263)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#imports">4.4.3.6. Imports</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#whitespace-in-expressions-and-statements">4.4.4. Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#pet-peeves">4.4.4.1. Pet Peeves</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#other-recommendations">4.4.4.2. Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#comments">4.4.5. Comments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#block-comments">4.4.5.1. Block Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#inline-comments">4.4.5.2. Inline Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#documentation-strings">4.4.5.3. Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#version-bookkeeping">4.4.6. Version Bookkeeping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#naming-conventions">4.4.7. Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#descriptive-naming-styles">4.4.7.1. Descriptive: Naming Styles</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#prescriptive-naming-conventions">4.4.7.2. Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#names-to-avoid">4.4.7.2.1. Names to Avoid</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#package-and-module-names">4.4.7.2.2. Package and Module Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#class-names">4.4.7.2.3. Class Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#exception-names">4.4.7.2.4. Exception Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#global-variable-names">4.4.7.2.5. Global Variable Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#function-names">4.4.7.2.6. Function Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#function-and-method-arguments">4.4.7.2.7. Function and method arguments</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#method-names-and-instance-variables">4.4.7.2.8. Method Names and Instance Variables</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#constants">4.4.7.2.9. Constants</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#designing-for-inheritance">4.4.7.2.10. Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#references">4.4.8. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#copyright">4.4.9. Copyright</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="b-cols_content_right">
        <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="index.html"
             class="b-path-list-item-url b-ellipsis">
            Руководство пользователя
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="5. Администрирование серверной части" class="b-path_current b-ellipsis">
          5. Администрирование серверной части
        </div>
      </li>
      
    </ul>
  </div>

  <div class="section" id="server-administration">
<span id="server-admin"></span><h1>5. Администрирование серверной части<a class="headerlink" href="#server-administration" title="Ссылка на этот заголовок">¶</a></h1>
<p>Типичные задачи администрирования серверной части включают в себя запуск и остановку сервера, перезагрузку настроек, создание снимков, ротацию логов.</p>
<div class="section" id="using-tarantool-as-a-client">
<span id="administration-using-tarantool-as-a-client"></span><h2>5.1. Использование tarantool в качестве клиента<a class="headerlink" href="#using-tarantool-as-a-client" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если <strong class="program">tarantool</strong> запущен без <a class="reference internal" href="../reference/configuration/index.html#index-init-label"><span class="std std-ref">файла инициализации</span></a>, или же в файле инициализации указана функция <a class="reference internal" href="../reference/reference_lua/console.html#console-start"><span class="std std-ref">console.start()</span></a>, то <strong class="program">tarantool</strong> стартует в интерактивном режиме: он выводит приглашение командной строки (&#8220;<code class="docutils literal"><span class="pre">tarantool&gt;</span></code>&#8221;), и запросы можно вводить прямо в консоли. В таком режиме <strong class="program">tarantool</strong> можно использовать в качестве клиента для удаленного сервера.</p>
<p>В этом разделе описаны синтаксические правила для ввода запросов в консоли Tarantool&#8217;а, с примечаниями и примерами. Другие клиентские программы могут иметь схожие параметры и синтаксис запросов. Некоторые сведения из этого раздела дублируются в главе <a class="reference internal" href="../reference/configuration/index.html#index-book-cfg"><span class="std std-ref">Справочник по конфигурированию</span></a>.</p>
<div class="section" id="conventions-used-in-this-section">
<h3>5.1.1. Условные обозначения, используемые в этом разделе<a class="headerlink" href="#conventions-used-in-this-section" title="Ссылка на этот заголовок">¶</a></h3>
<p>Токены — это последовательности символов, которые рассматриваются как синтаксические единицы в рамках запроса. Квадратные скобки [ и ] используются для обозначения необязательных токенов. Три точки в строке ... означают, что предыдущие токены могут повторяться. Вертикальная черта | означает, что предыдущие и последующие токены являются взаимоисключающими альтернативами.</p>
</div>
<div class="section" id="options-when-starting-client-from-the-command-line">
<h3>5.1.2. Параметры запуска клиента из командной строки<a class="headerlink" href="#options-when-starting-client-from-the-command-line" title="Ссылка на этот заголовок">¶</a></h3>
<p>Общий вид:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span>$ tarantool
ИЛИ
$ tarantool опции
ИЛИ
$ tarantool файл-инициализации-на-lua [ аргументы ]
</pre></div>
</div>
<p><em>файл-инициализации-на-lua</em> — это любой скрипт, содержащий логику инициализации. Код из этого файла выполняется при запуске Tarantool&#8217;а.  Например: <code class="samp docutils literal"><span class="pre">init.lua</span></code>. <br /> Примечания: При использовании скрипта, Tarantool не выводит приглашение командной строки. Скрипт должен содержать конфигурационные настройки, в т.ч. <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...listen=...</span></em></code> или <code class="samp docutils literal"><span class="pre">box.listen(...)</span></code>, чтобы внешние программы могли установить соединение с Tarantool-сервером на одном из указанных портов.</p>
<p><em>Опция</em> — это одно из следующих значений (указаны в алфавитном порядке, по полному имени опции):</p>
<dl class="option">
<dt id="cmdoption-tarantool-?">
<span id="cmdoption-tarantool-h"></span><span id="cmdoption-tarantool--help"></span><code class="descname">-?</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">-h</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--help</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-?" title="Ссылка на это определение">¶</a></dt>
<dd><p>Tarantool-клиент выводит краткую справку, включая список всех параметров. Например: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--help</span></code>. Вывод останавливается после показа справки.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantool-V">
<span id="cmdoption-tarantool--version"></span><code class="descname">-V</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--version</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-V" title="Ссылка на это определение">¶</a></dt>
<dd><p>Tarantool-клиент выводит свой номер версии. Например: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--version</span></code>. Вывод останавливается после показа номера версии.</p>
</dd></dl>

</div>
<div class="section" id="tokens-requests-and-special-key-combinations">
<h3>5.1.3. Токены, запросы и специальные комбинации клавиш<a class="headerlink" href="#tokens-requests-and-special-key-combinations" title="Ссылка на этот заголовок">¶</a></h3>
<p>Идентификатором процедуры может быть любая последовательность букв, цифр и/или подчеркиваний, которая отвечает правилам именования идентификаторов в Lua. Термин &#8220;идентификаторы процедур&#8221; также применяют к именам функций. <br /> Примечание: в случае с именами функций регистр имеет значение, поэтому <code class="docutils literal"><span class="pre">insert</span></code> и <code class="docutils literal"><span class="pre">Insert</span></code> — это не одно и то же.</p>
<p>Строковым литералом может быть любая последовательность из нуля и более символов, которая заключена в <em>одинарные кавычки</em>. <em>Двойные кавычки</em> также допустимы, но предпочтительным вариантом являются одинарные кавычки. А <em>двойные квадратные скобки</em> нужны для многострочных литералов (см. <a class="reference external" href="http://www.lua.org/pil/2.4.html">документацию по языку Lua</a>). <br /> Например: &#8216;Hello, world&#8217;, &#8216;A&#8217;, [[A\B!]].</p>
<p>Числовым литералом может быть любая последовательность символов, состоящая из одной и более цифр с необязательным знаком + или - в начале. В состав больших числовых литералов, а также числовых литералов с плавающей точкой может входить десятичный разделитель (запятая или точка), символы для экспоненциального представления и суффиксы. <br /> Например: 500, -500, 5e2, 500.1, 5LL, 5ULL.</p>
<p>Однобайтовым символом может быть запятая, открывающая или закрывающая круглая скобка, а также арифметический оператор. <br /> Например: * , ( ).</p>
<p>Токены должны разделяться одним или бОльшим количеством пробелов. Исключением являются однобайтовые токены и строковые литералы — вокруг них пробелы не нужны.</p>
</div>
<div class="section" id="requests">
<span id="administration-setting-delimiter"></span><h3>5.1.4. Запросы<a class="headerlink" href="#requests" title="Ссылка на этот заголовок">¶</a></h3>
<p>Запросы вводятся после приглашения командной строки, когда Tarantool работает в интерактивном режиме. (Приглашение — это слово tarantool и знак &#8220;больше&#8221;, вот так: <code class="samp docutils literal"><span class="pre">tarantool&gt;</span></code>). Маркером конца запроса по умолчанию является перевод строки.</p>
<p>Для ввода многострочных запросов можно задать другой маркер конца запроса. Для этого введите команду следующего вида: <code class="samp docutils literal"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">require('console');</span> <span class="pre">console.delimiter(</span><em><span class="pre">новый-маркер</span></em><span class="pre">)</span></code>. В качестве нового маркера укажите строковый литерал в одинарных кавычках. После этого вам нужно будет вводить указанный маркер в конце каждого запроса, потому что Tarantool перестанет интерпретировать перевод строки как конец запроса. Чтобы вернуться к обычному режиму, введите: <code class="samp docutils literal"><span class="pre">console.delimiter('')</span><em><span class="pre">string-literal</span></em></code>. Как правило, задавать свой маркер нет необходимости, поскольку Tarantool сам распознает, что запрос введен не полностью (скажем, когда Tarantool не встречает слова <code class="samp docutils literal"><span class="pre">end</span></code> в объявлении функции). Например:</p>
<div class="highlight-lua_tarantool"><div class="highlight"><pre><span></span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">);</span> <span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">!&#39;</span><span class="p">)</span>
<span class="k">function</span> <span class="nf">f</span> <span class="p">()</span>
  <span class="n">statement_1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">a&#39;</span>
  <span class="n">statement_2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">b&#39;</span>
<span class="k">end</span><span class="p">!</span>
<span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">)!</span>
</pre></div>
</div>
<p>См. также <a class="reference internal" href="../dev_guide/internals_index.html#box-protocol-iproto-protocol"><span class="std std-ref">описание формата клиентских запросов</span></a> в виде аннотированных BNF-диаграмм (Backus-Naur Form).</p>
<p>Работая в  <em>интерактивном</em> режиме, Tarantool-сервер принимает введенные запросы и выводит результаты. Запросы, как правило, вводит пользователь. Вот пример интерактивной пользовательской сессии:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool
<span class="go">[ здесь tarantool выводит приветствие и номер версии ]</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">[ здесь tarantool выводит свои текущие настройки ]</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="go">[ здесь tarantool может вывести сообщение о том,</span>
<span class="go">  что идет обработка запроса ]</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">hash&#39;</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">unsigned&#39;</span><span class="p">}})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">My first tuple&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">2014-04-30 10:28:00.886 [20436] main/101/spawner I&gt; Exiting: master shutdown</span>
<span class="go">$</span>
</pre></div>
</div>
<p>Пояснения к приведенному выше примеру:</p>
<ul class="simple">
<li><p class="first">На многие запросы Tarantool возвращает типизированные объекты. В ответ на запрос <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code> Tarantool выведет результат на экран. Если в запросе задано, что его результат должен быть записан в некоторую переменную, например <code class="samp docutils literal"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code>, то в таком случае вывода результата на экран не происходит.</p>
</li>
<li><p class="first">Вывод объекта в Tarantool&#8217;е всегда начинается со строки &#8220;<code class="docutils literal"><span class="pre">---</span></code>&#8221; и заканчивается строкой &#8220;<code class="docutils literal"><span class="pre">...</span></code>&#8221;.</p>
</li>
<li><p class="first">По запросу на вставку данных возвращается объект типа кортеж (tuple), и в этом случае перед выводом будет стоять одиночное тире (&#8216;<code class="docutils literal"><span class="pre">-</span></code>&#8216;). А по запросу на выборку данных возвращается объект типа таблица кортежей (table of tuples), и в этом случае перед выводом будут стоять два тире (&#8216;<code class="docutils literal"><span class="pre">-</span> <span class="pre">-</span></code>&#8216;).</p>
</li>
</ul>
</div>
</div>
<div class="section" id="utility-tarantoolctl">
<span id="administration-tarantoolctl"></span><h2>5.2. Утилита tarantoolctl<a class="headerlink" href="#utility-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h2>
<p>With <strong class="program">tarantoolctl</strong>, you can say: &#8220;start an instance of the Tarantool
server which runs a single user-written Lua program, allocating disk resources
specifically for that program, via a standardized deployment method.&#8221;</p>
<p>If Tarantool was installed with Debian or
Red Hat installation packages, the script is
in <code class="file docutils literal"><span class="pre">/usr/bin/tarantoolctl</span></code> or <code class="file docutils literal"><span class="pre">/usr/local/bin/tarantoolctl</span></code>.
The script handles such things as:
starting, stopping, rotating logs, logging in to the application&#8217;s console,
and checking status.</p>
<p>Also, you can use <strong class="program">tarantoolctl</strong>
<a class="reference internal" href="#administration-tarantoolctl-connect"><span class="std std-ref">as a client</span></a> to connect to another
instance of Tarantool server and pass requests.</p>
<div class="section" id="configuration-for-tarantoolctl">
<h3>5.2.1. Конфигурирование tarantoolctl<a class="headerlink" href="#configuration-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Скрипт <strong class="program">tarantoolctl</strong> сначала проверяет наличие файла конфигурации в текущей директории (<code class="file docutils literal"><span class="pre">$PWD/.tarantoolctl</span></code>). Если не находит, то проверяет домашнюю директорию текущего пользователя (<code class="file docutils literal"><span class="pre">$HOME/.config/tarantool/tarantool</span></code>). Если опять не находит, то проверяет директорию, указанную в переменной SYSCONFDIR (обычно это <code class="file docutils literal"><span class="pre">/etc/sysconfig/tarantool</span></code>, но на разных платформах этот путь может различаться). Большинство параметров <strong class="program">tarantoolctl</strong> аналогичны тем, что задаются в запросе <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...</span></em></code>; однако <strong class="program">tarantoolctl</strong> меняет значение некоторых параметров, дописывая к ним имя приложения. Далее приводится копия файла <code class="file docutils literal"><span class="pre">usr/local/etc/default/tarantool</span></code>, где для всех параметров указаны их значения по умолчанию:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/run/tarantool&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span>    <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">logger</span>     <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/log/tarantool&quot;</span><span class="p">,</span>
    <span class="n">username</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/etc/tarantool/instances.enabled&quot;</span>
</pre></div>
</div>
<p>Комментарии к параметрам в приведенном выше скрипте:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">pid_file</span></code></dt>
<dd><p class="first last">Директория, где хранятся pid-файл и socket-файл. Скрипт <strong class="program">tarantoolctl</strong> добавляет &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">wal_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся <code class="file docutils literal"><span class="pre">*.xlog</span></code>-файлы. Скрипт <strong class="program">tarantoolctl</strong> добавляет &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">snap_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся <code class="file docutils literal"><span class="pre">*.snap</span></code>-файлы. Скрипт <strong class="program">tarantoolctl</strong> добавляет &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">vinyl_dir</span></code></dt>
<dd><p class="first last">Директория, где хранятся файлы движка vinyl. Скрипт <strong class="program">tarantoolctl</strong> добавляет &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">logger</span></code></dt>
<dd><p class="first last">Директория, где хранятся файлы журнала с сообщениями от Tarantool-приложений. Скрипт <strong class="program">tarantoolctl</strong> добавляет &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; к имени директории.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">username</span></code></dt>
<dd><p class="first last">Имя пользователя, из-под которого запущен Tarantool-сервер. Это имя пользователя в операционной системе, а не в Tarantool-клиенте.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">instance_dir</span></code></dt>
<dd><p class="first last">Имя директории, где хранятся исходные файлы всех Tarantool-приложений для данного хоста. Пользователю, который пишет приложение для <strong class="program">tarantoolctl</strong>, нужно положить исходный код своего приложения в эту директорию или настроить симлинк. Далее для примеров в этом разделе мы используем Tarantool-приложение с именем <code class="docutils literal"><span class="pre">my_app</span></code>, и его исходный код должен лежать в файле <code class="samp docutils literal"><em><span class="pre">instance_dir</span></em><span class="pre">/my_app.lua</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="commands-for-tarantoolctl">
<h3>5.2.2. Команды для tarantoolctl<a class="headerlink" href="#commands-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Команды для <strong class="program">tarantoolctl</strong> имеют вид <code class="samp docutils literal"><span class="pre">tarantoolctl</span> <em><span class="pre">операция</span></em> <em><span class="pre">имя_приложения</span></em></code>. В качестве <em>операции</em> можно указать одно из следующих значений: start, stop, enter, logrotate, status, eval.</p>
<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-start">
<code class="descname">start</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-start" title="Ссылка на это определение">¶</a></dt>
<dd><p>Запустить приложение с именем <em>&lt;application&gt;</em></p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-stop">
<code class="descname">stop</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-stop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Остановить приложение</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-enter">
<code class="descname">enter</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-enter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Вывести консоль для управления приложением</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-logrotate">
<code class="descname">logrotate</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-logrotate" title="Ссылка на это определение">¶</a></dt>
<dd><p>Произвести ротацию журналов указанного приложения (создать новые, удалить старые)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-status">
<code class="descname">status</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-status" title="Ссылка на это определение">¶</a></dt>
<dd><p>Проверить статус приложения</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-eval">
<code class="descname">eval</code><code class="descclassname"> &lt;application&gt; &lt;scriptname&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-eval" title="Ссылка на это определение">¶</a></dt>
<dd><p>Выполнить код из файла <em>&lt;scriptname&gt;</em> от имени запущенного экземпляра приложения <em>&lt;application&gt;</em></p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-connect">
<code class="descname">connect</code><code class="descclassname"> &lt;URI&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-connect" title="Ссылка на это определение">¶</a></dt>
<dd><p>Connect to a Tarantool server running at the specified <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a></p>
</dd></dl>

</div>
<div class="section" id="typical-code-snippets-for-tarantoolctl">
<h3>5.2.3. Примеры кода для tarantoolctl<a class="headerlink" href="#typical-code-snippets-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Проверить, запущено ли приложение <code class="docutils literal"><span class="pre">my_app</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">if</span> tarantoolctl status my_app<span class="p">;</span> <span class="k">then</span>
...
<span class="k">fi</span>
</pre></div>
</div>
<p>Выполнить инструкции из файла <code class="file docutils literal"><span class="pre">init.d</span></code> во время запуска приложения:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span>каждый файл в директории instance_dir<span class="o">)</span>:
    tarantoolctl start <span class="sb">`</span>basename $ file .lua<span class="sb">`</span>
</pre></div>
</div>
<p>Указать файл конфигурации для ротации журнала, например:</p>
<pre class="highlight literal-block">
/path/to/tarantool/*.log {
    daily
    size 512k
    missingok
    rotate 10
    compress
    delaycompress
    create 0640 tarantool adm
    postrotate
        /path/to/tarantoolctl logrotate <cite>basename $ 1 .log</cite>
    endscript
}
</pre>
</div>
<div class="section" id="a-detailed-example-for-tarantoolctl">
<h3>5.2.4. Подробный пример для tarantoolctl<a class="headerlink" href="#a-detailed-example-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>The example&#8217;s objective is to make a temporary directory where
<strong class="program">tarantoolctl</strong> can start a long-running application and monitor it.</p>
<p>Итак, наши исходные условия: нам известен пароль root-пользователя; компьютер используется только для тестирования; Tarantool-сервер настроен и готов к запуску, но пока еще не запущен ;программа <strong class="program">tarantoolctl</strong> установлена в пользовательском окружении; пока не существует директории с именем <code class="file docutils literal"><span class="pre">tarantool_test</span></code>.</p>
<p>Создадим директорию с именем <code class="file docutils literal"><span class="pre">/tarantool_test</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo mkdir /tarantool_test
</pre></div>
</div>
<p>Отредактируем файл <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code>. Для этого нам сначала может понадобиться выполнить команду <code class="samp docutils literal"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/usr/local/etc/default</span></code>. Указанный файл будет содержать следующие настройки:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/my_app.pid&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/log&quot;</span><span class="p">,</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span>
</pre></div>
</div>
<p>Создадим файл <code class="file docutils literal"><span class="pre">/tarantool_test/my_app.lua</span></code> для приложения <code class="docutils literal"><span class="pre">my_app</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">passwd</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Gx5!&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">guest&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">read,write,execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">universe&#39;</span><span class="p">)</span>
<span class="n">fiber</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">fiber&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,{})</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">do</span>
    <span class="n">fiber</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">insert &#39;</span> <span class="o">..</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">my_app tuple&#39;</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>С помощью <strong class="program">tarantoolctl</strong> запустим наше приложение...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> sudo tarantoolctl start my_app
</pre></div>
</div>
<p>... и получим сообщения о том, что экземпляр нашего приложения запущен. Затем скажем:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /tarantool_test/my_app
</pre></div>
</div>
<p>... и увидим <code class="file docutils literal"><span class="pre">.snap</span></code>-файл и <code class="file docutils literal"><span class="pre">.xlog</span></code>-файл. Затем скажем:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo less /tarantool_test/log/my_app.log
</pre></div>
</div>
<p>... и увидим содержимое файла журнала для приложения <code class="docutils literal"><span class="pre">my_app</span></code>, в т.ч. сообщения об ошибках, если они были. Затем скажем:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> <span class="c1"># допустим, что &#39;tarantool&#39; запускает Tarantool-сервер</span>
<span class="gp">$</span> sudo tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{}</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">localhost:3301&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>... и увидим те несколько кортежей, которые создало приложение <code class="docutils literal"><span class="pre">my_app</span></code>.</p>
<p>Всё. Теперь остановим приложение <code class="docutils literal"><span class="pre">my_app</span></code>. Единственный корректный способ — это использовать <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo tarantoolctl stop my_app
</pre></div>
</div>
<p>Почистим систему после тестирования. Приведем содержимое файла <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code> к исходному виду и удалим нашу тестовую директорию:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /
<span class="gp">$</span> sudo rm -R tarantool_test
</pre></div>
</div>
</div>
<div class="section" id="an-example-for-tarantoolctl-connect">
<span id="administration-tarantoolctl-connect"></span><h3>5.2.5. An example for tarantoolctl connect<a class="headerlink" href="#an-example-for-tarantoolctl-connect" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl connect username:password@127.0.0.1:3306
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">There are alternatives to <strong class="program">tarantoolctl connect</strong> &#8211; you can use
the <a class="reference internal" href="../reference/reference_lua/console.html#console-module"><span class="std std-ref">console module</span></a> or the
<a class="reference internal" href="../reference/reference_lua/net_box.html#net-box-module"><span class="std std-ref">net.box module</span></a> from a Tarantool server.
Also, you can write your client programs with any of the
Connectors. However, most of the examples in this manual illustrate
usage with either <strong class="program">tarantoolctl connect</strong> or with
<a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">using the Tarantool server as a client</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="administrative-ports">
<span id="administration-admin-ports"></span><h2>5.3. Служебные порты<a class="headerlink" href="#administrative-ports" title="Ссылка на этот заголовок">¶</a></h2>
<p>Термины &#8220;порт для администрирования&#8221;, &#8220;консоль для администрирования&#8221;, &#8220;текстовый протокол&#8221; относятся к установке соединения с помощью <a class="reference internal" href="../reference/reference_lua/console.html#console-listen"><span class="std std-ref">console.listen(...)</span></a> для ввода запросов от администраторов.</p>
<p>Термины &#8220;бинарный порт&#8221;, &#8220;бинарный протокол&#8221;, &#8220;первичный порт&#8221; относятся к другому виду соединения — тому, что устанавливается с помощью параметра <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-listen"><span class="std std-ref">box.cfg{listen=...}</span></a> и предназначено для ввода запросов от любых пользователей.</p>
<p>Для обычных соединений с Tarantool-сервером должен использоваться бинарный протокол. А порты для администрирования нужны для особых случаев, когда повышены требования к безопасности.</p>
<p>При установке соединение через порт для администрирования:</p>
<ul class="simple">
<li><p class="first">Пароль не требуется</p>
</li>
<li><p class="first">Пользователь автоматически получает привилегии администратора.</p>
</li>
</ul>
<p>Поэтому порты для администрирования следует настраивать очень осторожно. Если это TCP-порт, то он должен быть открыть только для определенного IP-адреса. В идеале мы рекомендуем вовсе не использовать TCP-порты. Вместо них лучше настроить доменный Unix-сокет, который требует настройки прав доступа к серверной машине. Тогда типичная настройка порта для администрирования будет выглядеть следующим образом:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">console.listen(&#39;/var/lib/tarantool/socket_name.sock&#39;)</span>
</pre></div>
</div>
<p>а типичный <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> для соединения будет таким:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>admin:any_string@/var/lib/tarantool/socket_name.sock
</pre></div>
</div>
<p>Это в том случае, если у сервера (listener&#8217;а) есть привилегии на запись в файл <code class="file docutils literal"><span class="pre">/var/lib/tarantool</span></code>, а на стороне клиента (connector&#8217;а) есть привилегии на чтение из того же файла. Аналогично можно установить соединение и задать настройки с помощью <a class="reference internal" href="#administration-tarantoolctl"><span class="std std-ref">tarantoolctl</span></a>.</p>
<p>Если не задан пароль администратора, который можно сообщить пользователям, а порты для администрирования настроены с ограничением доступа по IP либо через сокеты, то запросы, требующие привилегий администратора, можно делать только локально, где вопросы безопасности и мониторинга регулируются с помощью средств Unix-системы.</p>
<p>В целях дополнительной безопасности некоторые запросы на портах для администрирования запрещены. Например, <a class="reference internal" href="../reference/reference_lua/net_box.html#net-box-eval"><span class="std std-ref">conn:eval</span></a> вернет сообщение об ошибке <code class="docutils literal"><span class="pre">-</span> <span class="pre">error:</span> <span class="pre">console</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">support</span> <span class="pre">this</span> <span class="pre">request</span> <span class="pre">type</span></code>, поскольку запрос <code class="docutils literal"><span class="pre">conn:eval</span></code> должен осуществляться в рамках бинарного протокола.</p>
<p>Если вопросы безопасности на портах для администрирования неактуальны, то стать пользователем с правами администратора можно, <a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">используя Tarantool-сервер в качестве клиента</span></a> или указав администраторский пароль при установке соединения по бинарному протоколу.</p>
<p>Выяснить, является ли некий TCP-порт портом для администрирования, можно с помощью <strong class="program">telnet</strong>. Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> telnet <span class="m">0</span> 3303
<span class="go">Trying 0.0.0.0...</span>
<span class="go">Connected to 0.</span>
<span class="go">Escape character is &#39;^]&#39;.</span>
<span class="go">Tarantool 1.7.2-70-gbc479ad (Lua console)</span>
<span class="go">type &#39;help&#39; for interactive help</span>
</pre></div>
</div>
<p>В этом примере в ответе от сервера нет слова &#8220;binary&#8221; и есть слова &#8220;Lua console&#8221;. Это значит, что мы установили соединение на порту для администрирования и можем вводить администраторские запросы на этом терминале.</p>
</div>
<div class="section" id="administrative-requests">
<h2>5.4. Служебные запросы<a class="headerlink" href="#administrative-requests" title="Ссылка на этот заголовок">¶</a></h2>
<p>To learn which functions are considered to be administrative, type <code class="docutils literal"><span class="pre">help()</span></code>.
A reference description also follows below:</p>
<span class="target" id="admin-snapshot"></span><dl class="function">
<dt id="lua-функция.box.snapshot">
<em class="property"> </em><code class="descclassname">box.</code><code class="descname">snapshot</code><big>(</big><big>)</big><a class="headerlink" href="#lua-функция.box.snapshot" title="Ссылка на это определение">¶</a></dt>
<dd><p>Take a snapshot of all data and store it in <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a><code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">&lt;latest-lsn&gt;</span></em><span class="pre">.snap</span></code>.
To take a snapshot, Tarantool first enters the delayed garbage collection
mode for all data. In this mode, tuples which were allocated before the
snapshot has started are not freed until the snapshot has finished. To
preserve consistency of the primary key, used to iterate over tuples, a
copy-on-write technique is employed. If the master process changes part
of a primary key, the corresponding process page is split, and the snapshot
process obtains an old copy of the page.
In effect, the snapshot process uses multi-version concurrency control
in order to avoid copying changes which are superseded while it is running.</p>
<p>Since a snapshot is written
sequentially, one can expect a very high write performance (averaging to
80MB/second on modern disks), which means an average database instance gets
saved in a matter of minutes. Note: as long as there are any changes to
the parent index memory through concurrent updates, there are going to be
page splits, and therefore one needs to have some extra free memory to run
this command. 10% of <a class="reference internal" href="../reference/configuration/index.html#cfg-storage-slab-alloc-arena"><span class="std std-ref">slab_alloc_arena</span></a> is, on average, sufficient.
This statement waits until a snapshot is taken and returns operation result.</p>
<p>Change Notice: prior to Tarantool version 1.6.6, the snapshot process caused
a fork, which could cause occasional latency spikes. Starting with
Tarantool version 1.6.6, the snapshot process creates a consistent
read view and writes this view to the snapshot file from a separate thread.</p>
<p>Although box.snapshot() does not cause a fork, there is a separate fiber
which may produce snapshots at regular intervals &#8211; see the discussion of
the <a class="reference internal" href="../reference/configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">snapshot daemon</span></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">version</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1.7.0-1216-g73f7154</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ok</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">error</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">can&#39;t save snapshot, errno 17 (File exists)</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>Taking a snapshot does not cause the server to start a new write-ahead log.
Once a snapshot is taken, old WALs can be deleted as long as all replicas
are up to date. But the WAL which was current at the time <code class="docutils literal"><span class="pre">box.snapshot()</span></code>
started must be kept for recovery, since it still contains log records
written after the start of <code class="docutils literal"><span class="pre">box.snapshot()</span></code>.</p>
<p>An alternative way to save a snapshot is to send the server SIGUSR1 UNIX
signal. While this approach could be handy, it is not recommended for use
in automation: a signal provides no way to find out whether the snapshot
was taken successfully or not.</p>
</dd></dl>

<dl class="function">
<dt id="lua-функция.coredump">
<em class="property"> </em><code class="descname">coredump</code><big>(</big><big>)</big><a class="headerlink" href="#lua-функция.coredump" title="Ссылка на это определение">¶</a></dt>
<dd><p>Fork and dump a core. Since Tarantool stores all tuples in memory, it can
take some time. Mainly useful for debugging.</p>
</dd></dl>

</div>
<div class="section" id="server-introspection">
<h2>5.5. Просмотр состояния сервера<a class="headerlink" href="#server-introspection" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="lua-module.box.cfg">
<span id="submodule-box-cfg"></span><span id="box-introspection-box-cfg"></span><h3>5.5.1. Submodule <cite>box.cfg</cite><a class="headerlink" href="#lua-module.box.cfg" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">box.cfg</span></code> submodule is for administrators to specify all the server
configuration parameters (see &#8220;Configuration reference&#8221; for
<a class="reference internal" href="../reference/configuration/index.html#box-cfg-params"><span class="std std-ref">a complete description of all configuration parameters</span></a>).
Use <code class="docutils literal"><span class="pre">box.cfg</span></code> without braces to get read-only access to those parameters.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">snapshot_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="l l-Scalar l-Scalar-Plain">too_long_threshold</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
  <span class="l l-Scalar l-Scalar-Plain">slab_alloc_factor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1.1</span>
  <span class="l l-Scalar l-Scalar-Plain">slab_alloc_maximal</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1048576</span>
  <span class="l l-Scalar l-Scalar-Plain">background</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="l l-Scalar l-Scalar-Plain">&lt;...&gt;</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="section" id="lua-module.box.info">
<span id="submodule-box-info"></span><span id="box-introspection-box-info"></span><h3>5.5.2. Submodule <cite>box.info</cite><a class="headerlink" href="#lua-module.box.info" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">box.info</span></code> submodule provides access to information about server variables.</p>
<ul class="simple">
<li><strong>server.lsn</strong> Log Sequence Number for the latest entry in the WAL.</li>
<li><strong>server.ro</strong>  True if the server is in &#8220;read_only&#8221; mode
(same as <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-read-only"><span class="std std-ref">read_only</span></a> in box.cfg).</li>
<li><strong>server.uuid</strong> The unique identifier of this server,
as stored in the database. This value is also
in the <a class="reference internal" href="box/box_space.html#box-space-cluster"><span class="std std-ref">box.space._cluster</span></a> system space.</li>
<li><strong>server.id</strong> The number of this server within a cluster.</li>
<li><strong>version</strong> Tarantool version. This value is also shown by
<a class="reference internal" href="../reference/configuration/index.html#index-tarantool-version"><span class="std std-ref">tarantool &#8211;version</span></a>.</li>
<li><strong>status</strong> Usually this is &#8216;running&#8217;, but it can be &#8216;loading&#8217;, &#8216;orphan&#8217;, or &#8216;hot_standby&#8217;.</li>
<li><strong>vclock</strong> Same as replication.vclock.</li>
<li><strong>pid</strong> Process ID. This value is also shown by the
<a class="reference internal" href="../reference/reference_lua/tarantool.html#tarantool-build"><span class="std std-ref">tarantool</span></a> module.
This value is also shown by the Linux &#8220;ps -A&#8221; command.</li>
<li><strong>cluster.uuid</strong> UUID of the cluster. Every server in a cluster will have the same cluster.uuid value.
This value is also in the <a class="reference internal" href="box/box_space.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a> system space.</li>
<li><strong>vinyl()</strong> Returns runtime statistics for the vinyl storage engine.</li>
<li><strong>replication.lag</strong> Number of seconds that the replica is behind the master.</li>
<li><strong>replication.status</strong> Usually this is &#8216;follow&#8217;, but it can be
&#8216;off&#8217;, &#8216;stopped&#8217;, &#8216;connecting&#8217;, &#8216;auth&#8217;, or &#8216;disconnected&#8217;.</li>
<li><strong>replication.idle</strong> Number of seconds that the server has been idle.</li>
<li><strong>replication.vclock</strong> See the <a class="reference internal" href="../dev_guide/internals_index.html#internals-vector"><span class="std std-ref">discussion of &#8220;vector clock&#8221;</span></a> in the Internals section.</li>
<li><strong>replication.uuid</strong> The unique identifier of a master to which this server is connected.</li>
<li><strong>replication.uptime</strong> Number of seconds since the server started.
This value can also be retrieved with <a class="reference internal" href="../reference/reference_lua/tarantool.html#tarantool-build"><span class="std std-ref">tarantool.uptime()</span></a>.</li>
</ul>
<p>The replication fields are blank unless the server is a <a class="reference internal" href="#index-box-replication"><span class="std std-ref">replica</span></a>.
The replication fields are in an array if the server is a replica for more than one master.</p>
<dl class="function">
<dt id="lua-функция.box.info">
<em class="property"> </em><code class="descclassname">box.</code><code class="descname">info</code><big>(</big><big>)</big><a class="headerlink" href="#lua-функция.box.info" title="Ссылка на это определение">¶</a></dt>
<dd><p>Since <code class="docutils literal"><span class="pre">box.info</span></code> contents are dynamic, it&#8217;s not possible to iterate over
keys with the Lua <code class="docutils literal"><span class="pre">pairs()</span></code> function. For this purpose, <code class="docutils literal"><span class="pre">box.info()</span></code>
builds and returns a Lua table with all keys and values provided in the
submodule.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return:</th><td class="field-body">keys and values in the submodule.</td>
</tr>
<tr class="field-even field"><th class="field-name">Rtype:</th><td class="field-body">table</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">lsn</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">158</span>
    <span class="l l-Scalar l-Scalar-Plain">ro</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">uuid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">a2684219-b2b1-4334-88ab-50b0722283fd</span>
    <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1.7.2-435-g6ba8500</span>
  <span class="l l-Scalar l-Scalar-Plain">pid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">12932</span>
  <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">running</span>
  <span class="l l-Scalar l-Scalar-Plain">vclock</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">158</span>
  <span class="l l-Scalar l-Scalar-Plain">replication</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">off</span>
  <span class="l l-Scalar l-Scalar-Plain">uptime</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">908</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pid</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">12932</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">status</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">running</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">uptime</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1065</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">version</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1.7.2-435-g6ba8500</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="lua-module.box.slab">
<span id="submodule-box-slab"></span><span id="box-introspection-box-slab"></span><h3>5.5.3. Submodule <cite>box.slab</cite><a class="headerlink" href="#lua-module.box.slab" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">box.slab</span></code> submodule provides access to slab allocator statistics. The
slab allocator is the main allocator used to store tuples. This can be used
to monitor the total memory use and memory fragmentation.</p>
<p>The display of slabs is broken down by the slab size &#8211; 64-byte, 136-byte,
and so on. The example omits the slabs which are empty. The example display
is saying that: there are 16 items stored in the 64-byte slab (and 16*64=102
so bytes_used = 1024); there is 1 item stored in the 136-byte slab
(and 136*1=136 so bytes_used = 136); the arena_used value is the total of all
the bytes_used values (1024+136 = 1160); the arena_size value is the arena_used
value plus the total of all the bytes_free values (1160+4193200+4194088 = 8388448).
The arena_size and arena_used values are the amount of the % of
<a class="reference internal" href="../reference/configuration/index.html#cfg-storage-slab-alloc-arena"><span class="std std-ref">slab_alloc_arena</span></a> that is already distributed to the slab allocator.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">slab</span><span class="p">.</span><span class="n">info</span><span class="p">().</span><span class="n">arena_used</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4194304</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">slab</span><span class="p">.</span><span class="n">info</span><span class="p">().</span><span class="n">arena_size</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">104857600</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">slab</span><span class="p">.</span><span class="n">stats</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mem_free</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16248</span>
    <span class="l l-Scalar l-Scalar-Plain">mem_used</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">48</span>
    <span class="l l-Scalar l-Scalar-Plain">item_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="l l-Scalar l-Scalar-Plain">item_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">24</span>
    <span class="l l-Scalar l-Scalar-Plain">slab_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">slab_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mem_free</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15736</span>
    <span class="l l-Scalar l-Scalar-Plain">mem_used</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">560</span>
    <span class="l l-Scalar l-Scalar-Plain">item_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">14</span>
    <span class="l l-Scalar l-Scalar-Plain">item_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span>
    <span class="l l-Scalar l-Scalar-Plain">slab_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">slab_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
    <span class="l l-Scalar l-Scalar-Plain">&lt;...&gt;</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">slab</span><span class="p">.</span><span class="n">stats</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mem_free</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15736</span>
  <span class="l l-Scalar l-Scalar-Plain">mem_used</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">560</span>
  <span class="l l-Scalar l-Scalar-Plain">item_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">14</span>
  <span class="l l-Scalar l-Scalar-Plain">item_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span>
  <span class="l l-Scalar l-Scalar-Plain">slab_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">slab_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16384</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="section" id="submodule-box-stat">
<span id="box-introspection-box-stat"></span><h3>5.5.4. Submodule <cite>box.stat</cite><a class="headerlink" href="#submodule-box-stat" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">box.stat</span></code> submodule provides access to request and network statistics.
Show the average number of requests per second, and the total number of
requests since startup, broken down by request type and network events statistics.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">net</span><span class="p">)</span> <span class="c1">-- virtual tables</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">,</span> <span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">net</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">net</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[]</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DELETE</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1873949</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">123</span>
  <span class="l l-Scalar l-Scalar-Plain">SELECT</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1237723</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4099</span>
  <span class="l l-Scalar l-Scalar-Plain">INSERT</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">EVAL</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">CALL</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">REPLACE</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1239123</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7849</span>
  <span class="l l-Scalar l-Scalar-Plain">UPSERT</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">AUTH</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">ERROR</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">UPDATE</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">().</span><span class="n">DELETE</span> <span class="c1">-- a selected item of the table</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">net</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">SENT</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">EVENTS</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">LOCKS</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">RECEIVED</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">total</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">rps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="replication">
<h2>5.6. Репликация<a class="headerlink" href="#replication" title="Ссылка на этот заголовок">¶</a></h2>
<p id="index-box-replication">Механизм репликации позволяет сразу многим Tarantool-серверам работать с копиями одних и тех же баз данных. При этом все базы остаются в синхронизированном состоянии благодаря тому, что каждый сервер может сообщать другим серверам о совершенных им изменениях. Сервера, которые работают над одними и теми же базами, представляют собой &#8220;кластер&#8221;. У каждого сервера в кластере есть числовой идентификатор (server id), уникальный в рамках кластера.</p>
<p>Чтобы настроить репликацию, необходимо настроить главные сервера (master), которые первыми обрабатывают запросы на изменение данных, затем настроить сервера-реплики (replica), которые копируют к себе запросы на изменение данных с главных серверов, и прописать процедуры для восстановления после сбоя.</p>
<div class="section" id="replication-architecture">
<h3>5.6.1. Архитектура механизма репликации<a class="headerlink" href="#replication-architecture" title="Ссылка на этот заголовок">¶</a></h3>
<p>Чтобы знать о всех изменениях на стороне главного сервера, каждая реплика непрерывно опрашивает главный сервер на предмет обновлений в его WAL-файле (write ahead log) и применяет эти обновления на своей стороне. Каждая запись в WAL-файле представляет собой один запрос на изменение данных (например, INSERT, UPDATE или DELETE) и присвоенный данной записи номер (LSN = log sequence number). Номера присваиваются в порядке возрастания. По сути, репликация в Tarantool&#8217;е является построчной: все команды на изменение данных полностью детерминированы, и каждая такая команда относится только к одному кортежу.</p>
<p>Вызовы хранимых Lua-процедур фиксируются не в WAL-файле, а в журнале событий (event log). Таким образом гарантируется, что не детерминированное поведение логики на Lua не приведет к рассинхронизации реплицированных данных.</p>
</div>
<div class="section" id="setting-up-a-master">
<h3>5.6.2. Setting up a master<a class="headerlink" href="#setting-up-a-master" title="Ссылка на этот заголовок">¶</a></h3>
<p>Чтобы настроить возможность установки соединения для реплик, на стороне главного сервера требуется лишь указать значение для параметра &#8220;<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-listen"><span class="std std-ref">listen</span></a>&#8221; в init-запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. Например, <code class="docutils literal"><span class="pre">box.cfg{listen=3301}</span></code>. Когда URI для прослушивания задан, главный сервер готов принимать запросы на соединение от любого количества реплик. Каждая реплика при этом находится в некотором <a class="reference internal" href="#index-monitoring-replica-actions"><span class="std std-ref">статусе репликации</span></a>.</p>
</div>
<div class="section" id="setting-up-a-replica">
<h3>5.6.3. Настройка сервера-реплики<a class="headerlink" href="#setting-up-a-replica" title="Ссылка на этот заголовок">¶</a></h3>
<p>Каждому Tarantool-серверу необходим корректный файл со статическим снимком данных (.snap-файл). Файл-снимок создается на сервере при первом запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. Если при первом таком запросе на сервере не определен источник репликации (replication source), то сервер стартует в режиме главного сервера и создает для себя новый кластер с новым уникальными UUID. Если же источник репликации при первом <code class="docutils literal"><span class="pre">box.cfg</span></code>-запросе определен, то сервер стартует в режиме реплики, а файл-снимок и информация о кластере берутся из WAL-файлов на главном сервере. Поэтому при настройке репликации нужно указать параметр <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> в запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. При первом соединении с главным сервером сервер-реплика включается в состав кластера. В дальнейшем такая реплика общается только с главным сервером из данного кластера.</p>
<p>После установки соединения с главным сервером реплика запрашивает у него все изменения, чьи LSN-номера в WAL-файле больше номера последнего локального изменения на реплике. Поэтому WAL-файлы на главном сервере нужно хранить до тех пор, пока все реплики не применят изменения из этих WAL-файлов на своей стороне. Состояние реплики можно &#8220;обнулить&#8221;, удалив все файлы репликации (.snap-файл со снимком и .xlog-файлы с записями WAL) и запустив сервер снова. Реплика при этом возьмет все кортежи с главного сервера и придет в синхронизированное состояние. Обратите внимание, что такая процедура &#8220;обнуления&#8221; сработает, только если на главном сервере будут доступны все нужные WAL-файлы.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Параметры репликации можно менять на лету, что позволяет назначать реплику на роль главного сервера и наоборот. Для этого используется запрос <a class="reference internal" href="#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Реплика не берет настройки конфигурации с главного сервера, например настройки запуска <a class="reference internal" href="../reference/configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">фоновой программы для работы со снимками</span></a> на главном сервере. Чтобы получить те же настройки на реплике, нужно задать их явным образом.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Репликация требует настройки привилегий. Привилегии для доступа к пространствам можно задать напрямую для пользователя, под чьим именем запущен сервер-реплика. Но обычно привилегии на доступ к пространствам задаются с помощью <a class="reference internal" href="box/index.html#authentication-rep-role"><span class="std std-ref">роли</span></a>, которая затем присваивается пользователю, под чьим именем запущен сервер-реплика.</p>
</div>
</div>
<div class="section" id="recovering-from-a-degraded-state">
<h3>5.6.4. Восстановление после сбоя<a class="headerlink" href="#recovering-from-a-degraded-state" title="Ссылка на этот заголовок">¶</a></h3>
<p>&#8220;Сбой&#8221; — это ситуация, когда главный сервер становится недоступен вследствие проблем с оборудованием, сетевых неполадок или программной ошибки. У реплики нет способа автоматически обнаружить, что связь с главным сервером утеряна насовсем, поскольку причины сбоя и окружение, в котором развернута репликация, могут быть очень разными. Поэтому обнаруживать сбой должен человек.</p>
<p>However, once a master failure is detected, the recovery is simple: declare
that the replica is now the new master, by saying
<span class="ccode">box.cfg{... listen=</span><span class="ccodei">URI</span><span class="ccode">}</span>.
Then, if there are updates on the old master that were not propagated before
the old master went down, they would have to be re-applied manually.</p>
</div>
<div class="section" id="quick-startup-of-a-new-simple-two-server-cluster">
<h3>5.6.5. Quick startup of a new simple two-server cluster<a class="headerlink" href="#quick-startup-of-a-new-simple-two-server-cluster" title="Ссылка на этот заголовок">¶</a></h3>
<p>Шаг 1. Запустите первый сервер со следующими настройками:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span><span class="n">box</span><span class="o">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="o">*</span><span class="n">uri</span><span class="c1">#1*}</span>
<span class="o">--</span> <span class="n">в</span> <span class="n">этом</span> <span class="n">запросе</span> <span class="n">можно</span> <span class="n">задать</span> <span class="n">больше</span> <span class="n">ограничений</span>
<span class="n">box</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">,</span> <span class="s1">&#39;read,write,execute&#39;</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>
</pre></div>
</div>
<p>... Итак, создался новый кластер.</p>
<p>Шаг 2. На втором сервере проверьте пути, по которым будут храниться файлы репликации. Эти пути задаются в параметрах <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> (для .snap-файлов) и <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> (для .xlog-файлов). В указанных директориях должно быть пусто, чтобы не случилось конфликта с теми начальными данными, что придут с первого сервера, когда второй сервер присоединится к кластеру.</p>
<p>Step 3. Запустите второй сервер со следующими настройками:</p>
<pre class="highlight literal-block">
box.cfg{
  listen = <em>uri#2</em>,
  replication_source = <em>uri#1</em>
}
</pre>
<p>... где <code class="docutils literal"><span class="pre">uri#1</span></code> = <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a>, на котором включено прослушивание у первого сервера.</p>
<p>Вот и всё.</p>
<p>В описанной выше конфигурации первый сервер выполняет роль &#8220;главного&#8221;, а второй служит &#8220;репликой&#8221;. Далее все изменения, происходящие на стороне главного сервера, будут доступны с реплики. Простой кластер из двух серверов, где главный сервер запущен на одном компьютере, а сервер-реплика — на другом, встречается очень часто и обладает двумя важными преимуществами: FAILOVER (т.е. отказоустойчивость, поскольку в случае отключения главного сервера его место может занять сервер-реплика) и LOAD BALANCING (т.е. балансировка нагрузки, поскольку клиенты могут обращаться с SELECT-запросами как к главному серверу, так и к реплике). При необходимости в настройках реплики можно задать параметр <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-read-only"><span class="std std-ref">read_only = true</span></a>.</p>
</div>
<div class="section" id="monitoring-a-replica-s-actions">
<span id="index-monitoring-replica-actions"></span><h3>5.6.6. Мониторинг действий реплики<a class="headerlink" href="#monitoring-a-replica-s-actions" title="Ссылка на этот заголовок">¶</a></h3>
<p>In <a class="reference internal" href="#box-introspection-box-info"><span class="std std-ref">box.info</span></a> there is a <code class="docutils literal"><span class="pre">box.info.replication.status</span></code> field:
&#8220;off&#8221;, &#8220;stopped&#8221;, &#8220;connecting&#8221;, &#8220;auth&#8221;, &#8220;follow&#8221;, or &#8220;disconnected&#8221;. <br />
If a replica&#8217;s status is &#8220;follow&#8221;, then there will be more fields &#8211;
the list is in the section <a class="reference internal" href="#box-introspection-box-info"><span class="std std-ref">Submodule box.info</span></a>.</p>
<p>В <a class="reference internal" href="../reference/reference_lua/log.html#log"><span class="std std-ref">журнале</span></a> ведется запись о действиях, связанных с репликацией. Если главный сервер запущен со следующими настройками:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span><span class="n">box</span><span class="o">.</span><span class="n">cfg</span><span class="p">{</span>
  <span class="o">&lt;...&gt;</span><span class="p">,</span>
  <span class="n">logger</span> <span class="o">=</span> <span class="o">*</span><span class="n">имя_файла_для_ведения_журнала</span><span class="o">*</span><span class="p">,</span>
  <span class="o">&lt;...&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>то на каждую установку/потерю соединения реплики с главным сервером в журнале будут появляться строчки со словом &#8220;relay&#8221;.</p>
</div>
<div class="section" id="preventing-duplicate-actions">
<span id="index-preventing-duplicate-actions"></span><h3>5.6.7. Предотвращение дублирующихся действий<a class="headerlink" href="#preventing-duplicate-actions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Предположим, что реплика пытается сделать нечто, что уже было сделано на главном сервере. Например: <br /> <code class="code docutils literal"><span class="pre">box.schema.space.create('X')</span></code> <br /> Это приведет к ошибке &#8220;Space X exists&#8221; (&#8220;Пространство X уже существует&#8221;). В данном частном случае можно скорректировать инструкцию следующим образом: <br /> <code class="code docutils literal"><span class="pre">box.schema.space.create('X',</span> <span class="pre">{if_not_exists=true})</span></code> <br /> Но существует и более общее решение: использовать метод <code class="samp docutils literal"><span class="pre">box.once(</span><em><span class="pre">key</span></em><span class="pre">,</span> <em><span class="pre">function</span></em><span class="pre">)</span></code>. Если <code class="code docutils literal"><span class="pre">box.once()</span></code> был вызван ранее с тем же значением параметра <code class="samp docutils literal"><em><span class="pre">key</span></em></code>, то функция <code class="samp docutils literal"><em><span class="pre">function</span></em></code> игнорируется; в противном случае функция <code class="samp docutils literal"><em><span class="pre">function</span></em></code> будет выполнена. Поэтому действия, которые должны совершаться только один раз за время текущей сессии репликации, нужно помещать в функцию и вызывать ее с помощью метода <code class="code docutils literal"><span class="pre">box.once()</span></code>. Например:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">f</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space_creator&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="master-master-replication">
<h3>5.6.8. Репликация по схеме master-master<a class="headerlink" href="#master-master-replication" title="Ссылка на этот заголовок">¶</a></h3>
<p>В случае настройки репликации по схеме master-replica изменения на главном сервере доступны для просмотра с реплики, но не наоборот, потому как главный сервер в такой схеме указан в качестве единственного источника репликации. В случае схемы master-master (иногда ее также называет multi-master) просмотр изменений возможен в любом направлении. В простом случае (master-master с двумя серверами) на первом сервере нужно задать следующие настройки:</p>
<pre class="highlight literal-block">
box.cfg{ replication_source = <em>uri#2</em> }
</pre>
<p>Этот запрос можно выполнить в любой момент, т.к. параметр <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> можно задавать на ходу.</p>
<p>В данном примере оба сервера являются одновременно и &#8220;главными&#8221;, и &#8220;репликами&#8221;. Поэтому каждое изменение, которое случается на одном сервере, становится доступно для просмотра с другого сервера. Отказоустойчивость в такой конфигурации сохраняется, а возможности по балансировке нагрузки становятся еще шире (теперь клиенты могут обращаться к обоим серверам со всеми типами запросов — как на чтение данных, так и на изменение).</p>
<p>Если две операции над одним и тем же кортежем производятся &#8220;параллельно&#8221; (а это может потребовать много времени, поскольку репликация — это асинхронный процесс), причем одна из операций — это <code class="docutils literal"><span class="pre">delete</span></code>, а вторая — <code class="docutils literal"><span class="pre">replace</span></code>, то существует вероятность, что данные на серверах станут различаться.</p>
</div>
<div class="section" id="all-the-what-if-questions">
<h3>5.6.9. Ответы на вопросы &#8220;Что если?&#8221;<a class="headerlink" href="#all-the-what-if-questions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Вопрос: Что если в кластере вида master-master более двух серверов? <br /> Ответ: На каждом сервере нужно задать параметр <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> и указать в нем все остальные сервера. Например, для сервера #3 настройки будут следующими: <br /> <span class="ccode">box.cfg{</span> <br /> &nbsp; &nbsp; &nbsp; <span class="ccode">replication_source = {</span><span class="ccodei">uri#1, uri#2</span><span class="ccode">}</span> <br /> <span class="ccode">}</span></p>
<p>Вопрос: Что если какой-то сервер нужно убрать из кластера? <br /> Ответ: Для реплики — выполните запрос <code class="docutils literal"><span class="pre">box.cfg{}</span></code>, указав пустой источник репликации: <br /> <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code></p>
<p>Вопрос: Что если какой-то сервер вдруг выбывает из кластера? <br /> Ответ: Остальные сервера продолжают работать. Если выбывший сервер снова возвращается в кластер, то он получит информацию о всех изменениях, которые произошли на остальных серверах за время его отсутствия.</p>
<p>Вопрос: Что если два сервера совершают изменения, связанные с одним и тем же кортежем? <br /> Ответ: Применятся последние из совершенных изменений. Для примера предположим, что сервер #1 меняет некоторый кортеж, а затем сервер #2 меняет тот же кортеж. В данном случае изменения сервера #2 затрут изменения сервера #1. Чтобы отслеживать, кто был последним, в Tarantool&#8217;е используются <a class="reference external" href="https://en.wikipedia.org/wiki/Vector_clock">векторные часы</a>.</p>
<p>Вопрос: Что если оба сервера выполняют вставку одного и того же кортежа? <br /> Ответ: Если главный сервер попытается вставить кортеж, который уже был вставлен на реплике, то это будет пример серьезной ошибки. Репликация остановится, и ее придется перезапускать в ручную.</p>
<p>Вопрос: Что если главный сервер становится недоступен и пользователям приходится переключаться реплику? <br /> Ответ: Реплика получает сообщение, что связь потеряна. Теперь реплика должна начать работать независимо. Для этого ей нужно задать пустой источник репликации, выполнив на стороне реплики запрос <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code>.</p>
<p>Вопрос: Что если нужно посмотреть, к какому кластеру принадлежит данный сервер? <br /> Ответ: Идентификатором кластера является UUID, который генерируется при первом запуске главного сервера. Данный UUID хранится в системном пространстве <a class="reference internal" href="box/box_space.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a>. Чтобы посмотреть UUID кластера, введите запрос <code class="docutils literal"><span class="pre">box.space._schema:select{'cluster'}</span></code></p>
<p>Вопрос: Что если нужно посмотреть, какие сервера входят в кластер? <br /> Ответ: У каждого сервера есть универсальный идентификатор — это его UUID в поле <code class="docutils literal"><span class="pre">box.info.server.uuid</span></code>. Также у сервера есть его порядковый идентификатор в кластере — это номер в поле <code class="docutils literal"><span class="pre">box.info.server.id</span></code>. Чтобы увидеть номера всех серверов в кластере, введите запрос: <code class="docutils literal"><span class="pre">box.space._cluster:select{}</span></code>. Данный запрос возвращает таблицу со всеми кортежами вида {server.id, server.uuid} для всех серверов, что когда-либо входили в данный кластер.</p>
<p>Вопрос: Что если какой-то из файлов репликации на реплике поврежден или удален? <br /> Ответ: Нужно остановить сервер, удалить все файлы, относящиеся к базе данных (это файлы с расширениями &#8220;snap&#8221;, &#8220;xlog&#8221; и &#8221;.inprogress&#8221;), снова запустить сервер и ввести запрос <code class="docutils literal"><span class="pre">box.cfg{...replication_source=...}</span></code>, чтобы восстановить соединение с главным сервером и загрузить данные с него.</p>
<p>Вопрос: Что если при репликации возникают вопросы, связанные с безопасностью? <br /> Ответ: Чтобы предотвратить появление несанкционированных источников репликации, нужно задать пароль для каждого пользователя, у которого есть привилегии доступа к соответствующим пространствам, а также для каждого пользователя, у которого настроена <a class="reference internal" href="box/index.html#authentication-rep-role"><span class="std std-ref">репликационная роль</span></a>. Заметьте, что <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> для параметра <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> теперь нужно всегда указывать в полном виде: <br /> <code class="docutils literal"><span class="pre">replication_source='username:password&#64;host:port'</span></code></p>
<p>Q: What if advanced users want to understand better how it all works? <br />
A: See the description of server startup with replication in the
<a class="reference internal" href="../dev_guide/internals_index.html#internals-replication"><span class="std std-ref">Internals</span></a> section.</p>
</div>
<div class="section" id="hands-on-replication-tutorial">
<h3>5.6.10. Практическое руководство по репликации<a class="headerlink" href="#hands-on-replication-tutorial" title="Ссылка на этот заголовок">¶</a></h3>
<p>Ниже приводятся пошаговые инструкции, которые помогут вам получить практический опыт администрирования кластера, а именно опыт создания кластера и добавления реплики.</p>
<p>Запустите два терминала, каждый в своем окне, и расположите их рядом на экране. (Далее в примерах оба терминала показаны в виде закладок. Щелкните на заголовок закладки — &#8220;Terminal #1&#8221; или &#8220;Terminal #2&#8221;, — чтобы увидеть вывод на соответствующем терминале.)</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-1">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-1-content">
<div class="b-documentation-tab container" id="terminal-1-1">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-1-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале (Terminal #1) выполните следующие команды:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_1/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>В результате были заданы настройки нового кластера, а на экране был выведен UUID текущего сервера. Теперь вывод на экране выглядит следующим образом (за тем исключением, что UUID у вас будут другие):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-2">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-2-content">
<div class="b-documentation-tab container" id="terminal-2-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">$</span> ~/tarantool/src/tarantool: version 1.7.0-1724-g033ed69
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="go">&lt;...&gt; I&gt; creating ./00000000000000000000.xlog.inprogress&#39;</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-2-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале (Terminal #2) выполните следующие команды:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ~/tarantool_test_node_2/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>В результате были заданы настройки сервера-реплики. На экране первого терминала (Terminal #1) появились сообщения с подтверждениями, что реплика установила соединение с главным сервером и что содержимое WAL-файла было отправлено на реплику. На экране второго терминала (Terminal #2) появились сообщения о том, что репликация начинается, а также там были выведены UUID из системного пространства _cluster (один из них совпадает с UUID в первом терминале, поскольку оба сервера входят в общий кластер).</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-3">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-3-content">
<div class="b-documentation-tab container" id="terminal-3-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-3-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале (Terminal #1) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-4">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-4-content">
<div class="b-documentation-tab container" id="terminal-4-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-4-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале успешно отработали операции CREATE и INSERT. Но во втором терминале ничего не произошло.</p>
<p>Во втором терминале (Terminal #2) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-5">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-5-content">
<div class="b-documentation-tab container" id="terminal-5-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-5-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале успешно отработали операции SELECT и INSERT. Но в первом терминале ничего не произошло.</p>
<p>В первом терминале (Terminal #1) выполните следующие запросы и команды:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> os.exit<span class="o">()</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">$</span> ls -l ~/tarantool_test_node_2
</pre></div>
</div>
<p>Теперь Tarantool-сервер в первом терминале остановлен. В окне второго терминала появились сообщения об этом событии. С помощью команд <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-l</span></code> мы убедились, что на обоих серверах создались файлы-снимки с одинаковыми размерами, поскольку там содержатся одни и те же кортежи.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-6">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-6-content">
<div class="b-documentation-tab container" id="terminal-6-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-6-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале (Terminal #2) проигнорируйте сообщения об ошибках и выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом (сообщения об ошибках мы не приводим):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-7">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-7-content">
<div class="b-documentation-tab container" id="terminal-7-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-7-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 coio.cc:352 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 6, aka 127.0.0.1:58734, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Запросы SELECT и INSERT во втором терминале отработали несмотря на то, что сервер в первом терминале остановлен.</p>
<p>В первом терминале (Terminal #1) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-8">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-8-content">
<div class="b-documentation-tab container" id="terminal-8-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;Tuple inserted on Terminal #1&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-8-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Главный сервер снова установил соединение с кластером и НЕ обнаружил изменения, сделанные репликой за время его недоступности. Это и не удивительно: мы же не просили реплику выступать в качестве источника репликации.</p>
<p>В первом терминале (Terminal #1) введите:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-9">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-9-content">
<div class="b-documentation-tab container" id="terminal-9-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">[28987] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="go">[22612] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="go">[22612] main/101/interactive I&gt; set &#39;replication_source&#39; configuration</span>
<span class="go">        option to &quot;replicator:password@localhost:3302&quot;</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; connected to 1.7.0 at 127.0.0.1:3302</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; authenticated</span>
<span class="go">[22612] wal/101/main I&gt; creating `./00000000000000000008.xlog.inprogress&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; recover from `./00000000000000000008.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-9-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main recovery.cc:211 W&gt; file</span>
<span class="go">     `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
</div>
<script>
    register_replication_tab(1);
    register_replication_tab(2);
    register_replication_tab(3);
    register_replication_tab(4);
    register_replication_tab(5);
    register_replication_tab(6);
    register_replication_tab(7);
    register_replication_tab(8);
    register_replication_tab(9);
</script></div>
<p>Тут мы видим, что оба сервера снова синхронизовались и что каждый из них видит те записи, которые сделал другой.</p>
<p>Чтобы удалить все тестовые данные, выполните &#8220;<code class="docutils literal"><span class="pre">os.exit()</span></code>&#8221; на обоих терминалах, а затем на каждом из них выполните следующие команды:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> rm -R ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_2
</pre></div>
</div>
</div>
</div>
<div class="section" id="backups">
<h2>5.7. Резервное копирование<a class="headerlink" href="#backups" title="Ссылка на этот заголовок">¶</a></h2>
<p>При выборе конкретной процедуры для резервного копирования базы данных нужно учитывать следующие требования: насколько актуальной должна быть копия, можно ли временно отключать других пользователей, а также нужна ли оптимизация размера копии (чтобы копия занимала меньше места на диске) или скорости самой процедуры (чтобы процедура занимала меньше времени). Выбирать можно из нескольких вариантов в диапазоне от &#8220;простого и холодного&#8221; до &#8220;трудного и горячего&#8221;.</p>
<div class="section" id="cold-backup">
<h3>5.7.1. Cold backup<a class="headerlink" href="#cold-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>Суть процедуры: последний созданный Tarantool&#8217;ом файл-снимок является резервной копией всей базы; а WAL-файлы, созданные следом, являются инкрементными копиями. Поэтому вся процедура резервирования сводится к копированию последнего файла-снимка и последующих WAL-файлов.</p>
<ol class="arabic simple">
<li><p class="first">Временно запретите всем пользователям делать записи в базе. Для этого можно остановить Tarantool-сервер, либо ввести запрос <code class="docutils literal"><span class="pre">box.cfg{read_only=true}</span></code> и убедиться, что все обращения на запись завершились (для этого можно использовать <strong class="program">fsync</strong>).</p>
</li>
<li><p class="first">Если вы хотите создать резеврную копию для всей базы целиком, введите запрос <code class="samp docutils literal"><span class="pre">box.snapshot()</span></code>.</p>
</li>
<li><p class="first">С помощью <strong class="program">tar</strong> создайте сжатую (насколько это можно) копию последнего <code class="file docutils literal"><span class="pre">.snap</span></code>-файла и последующих <code class="file docutils literal"><span class="pre">.xlog</span></code>-файлов из директорий <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> и <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a>.</p>
</li>
<li><p class="first">Если того требуют правила безопасности, зашифруйте получившийся <code class="file docutils literal"><span class="pre">tar</span></code>-файл.</p>
</li>
<li><p class="first">Скопируйте <code class="file docutils literal"><span class="pre">tar</span></code>-файл в надежное место.</p>
</li>
</ol>
<p>... В дальнейшем вы сможете восстановить базу данных, просто взяв этот <code class="file docutils literal"><span class="pre">tar</span></code>-файл и разархивировав его содержимое в директории <code class="docutils literal"><span class="pre">snap_dir</span></code> и <code class="docutils literal"><span class="pre">wal_dir</span></code>.</p>
</div>
<div class="section" id="continuous-remote-backup">
<h3>5.7.2. Continuous remote backup<a class="headerlink" href="#continuous-remote-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>Суть процедуры: для резервирования (а также для балансирования нагрузки) можно использовать <a class="reference internal" href="#index-box-replication"><span class="std std-ref">репликацию</span></a>. Процедура резервирования в рамках репликационного кластера сводится к тому, чтобы держать все реплики в актуальном состоянии и периодически делать с них &#8220;холодные&#8221; копии. Поскольку во время снятия копии с какой-либо одной реплики все остальные реплики продолжают синхронизироваться с главным сервером, то эта процедура несколько отличается от описанной выше процедуры &#8220;холодного&#8221; резервирования. Регулярное резервирование в кластере можно настроить с помощью планировщика <strong class="program">cron</strong> или Tarantool-файбера.</p>
</div>
<div class="section" id="hot-backup">
<h3>5.7.3. Hot backup<a class="headerlink" href="#hot-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>Суть процедуры: по ходу работы системы нужно сохранять записи об изменениях, сделанных со времени последнего &#8220;холодного&#8221; резервирования.</p>
<p>Для этого вам понадобится специальная утилита для копирования частей файлов (например, <a class="reference external" href="https://en.wikipedia.org/wiki/rsync">rsync</a>), которая позволит удаленно и на постоянной основе копировать только изменившиеся части файлов-снимков и WAL-файлов, а не все эти файлы целиком.</p>
<p>Вы можете взять и обычную утилиту (для копирования файлов целиком), но тогда вам придется создавать файлы-снимки и WAL-файлы на каждое изменение, чтобы нужно было копировать только новые файлы.</p>
<p>Примечание про движок: при организации резервирования для баз данных на движке vinyl понадобятся дополнительные действия.</p>
</div>
</div>
<div class="section" id="updates-upgrades">
<h2>5.8. Обновление сервера и базы данных<a class="headerlink" href="#updates-upgrades" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="updating-tarantool-in-production">
<h3>5.8.1. Обновление Tarantool&#8217;а в условиях эксплуатации<a class="headerlink" href="#updating-tarantool-in-production" title="Ссылка на этот заголовок">¶</a></h3>
<p>Во-первых, вынесите всю бизнес-логику своего приложения в отдельный Tarantool-модуль на языке Lua так, чтобы все нужные функции были доступны для вызова извне (CALL).</p>
<p>Вот пример такого модуля, файл <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="k">function</span> <span class="nf">start</span><span class="p">()</span>
  <span class="c1">-- Initial version</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.1.0&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">somedata&quot;</span><span class="p">)</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">primary&quot;</span><span class="p">)</span>
  <span class="o">...</span>

  <span class="c1">-- migration code from 1.0 to 1.1</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.1&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="o">...</span>

  <span class="c1">-- migration code from 1.1 to 1.2</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.2&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">space</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">insert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>

<span class="c1">-- start some background fibers if you need</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">stop</span><span class="p">()</span>
  <span class="c1">-- stop all background fibers and cleanup resources</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">api_for_call</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span>
  <span class="c1">-- do some business</span>
<span class="k">end</span>

<span class="k">return</span> <span class="p">{</span>
  <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
  <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">;</span>
  <span class="n">api_for_call</span> <span class="o">=</span> <span class="n">api_for_call</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Поддержка этого файла лежит на стороне разработчиков приложения. А команда разработки Tarantool&#8217;а со своей стороны предлагает шаблоны, для того чтобы вы могли <a class="reference external" href="https://github.com/tarantool/modulekit">создать у себя deb/rpm-сборку</a>, а также утилиты для быстрого <a class="reference external" href="https://github.com/tarantool/build">создания сборок под разные платформы</a>. Если понадобится, вы можете разбить приложения на отдельные файлы и/или модули.</p>
<p>Во вторых, положите скрипт инициализации в директорию <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available</span></code>.</p>
<p>Вот пример такого скрипта, файл <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/myappcfg.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>

<span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">myapp</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
  <span class="c1">-- hot code reload using tarantoolctl or dofile()</span>

  <span class="c1">-- unload old application</span>
  <span class="n">myapp</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
  <span class="c1">-- clear cache for loaded modules and dependencies</span>
  <span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
  <span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">somedep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span> <span class="c1">-- dependency of &#39;myapp&#39;</span>
<span class="k">end</span>

<span class="c1">-- load a new version of app and all dependencies</span>
<span class="n">myapp</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">({</span><span class="n">some</span> <span class="n">app</span> <span class="n">options</span> <span class="n">controlled</span> <span class="n">by</span> <span class="n">sysadmins</span><span class="p">})</span>
</pre></div>
</div>
<p>Более детальный пример (со всеми настройками) содержится в файле <code class="file docutils literal"><span class="pre">example.lua</span></code>, который входит в состав дистрибутива Tarantool&#8217;а.</p>
<p>Этот скрипт инициализации по сути является конфигурационным файлом. Его поддержкой должны заниматься системные администраторы, в то время как разработчики только предоставляют им шаблон.</p>
<p>Теперь обновите файл с вашим приложением в директории <code class="file docutils literal"><span class="pre">/usr/share/tarantool</span></code>. Замените старую версию файла (например, <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>) и вручную загрузите скрипт инициализации <code class="file docutils literal"><span class="pre">myappcfg.lua</span></code> с помощью утилиты <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl <span class="nb">eval</span> /etc/tarantool/instance.enabled/myappcfg.lua
</pre></div>
</div>
<p>После этого вам нужно вручную очистить кеш модулей <code class="docutils literal"><span class="pre">package.loaded</span></code>.</p>
<p>Чтобы создать deb/rpm-сборку, вы можете добавить инструкцию <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">eval</span></code> прямо в спецификацию Tarantool&#8217;а в файле <code class="file docutils literal"><span class="pre">RPM.spec</span></code> и в директории <code class="file docutils literal"><span class="pre">/debian</span></code>.</p>
<p>В итоге клиенты делают вызов (CALL) функции <code class="docutils literal"><span class="pre">myapp.api_for_call</span></code> и других функций из API.</p>
<p>Если вы используете <code class="docutils literal"><span class="pre">tarantool-http</span></code>, то запускать бинарный протокол не нужно.</p>
</div>
<div class="section" id="upgrading-a-tarantool-database">
<h3>5.8.2. Upgrading a Tarantool database<a class="headerlink" href="#upgrading-a-tarantool-database" title="Ссылка на этот заголовок">¶</a></h3>
<p>Эта информация полезна в том случае, если у вас есть база данных, работающая на какой-либо старой версии Tarantool&#8217;а, а теперь вы установили Tarantool новой версии. В этом случае выполните запрос <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code>.</p>
<p>Например, вот что происходит, если выполнить запрос <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code> для базы, созданной в начале 2015 года (для примера показана лишь малая часть выводимых сообщений):</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">upgrade</span><span class="p">()</span>
<span class="go">alter index primary on _space set options to {&quot;unique&quot;:true}, parts to [[0,&quot;unsigned&quot;]]</span>
<span class="go">alter space _schema set options to {}</span>
<span class="go">create view _vindex...</span>
<span class="go">grant read access to &#39;public&#39; role for _vindex view</span>
<span class="go">set schema version to 1.7.0</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="server-signal-handling">
<h2>5.9. Обработка сигналов от сервера<a class="headerlink" href="#server-signal-handling" title="Ссылка на этот заголовок">¶</a></h2>
<p>Во время основного цикла Tarantool-сервер обрабатывает следующие сигналы:</p>
<dl class="glossary docutils">
<dt id="term-sighup">SIGHUP</dt>
<dd><p class="first last">может привести к ротации лога, см. <a class="reference internal" href="../reference/configuration/index.html#cfg-logging-logging-example"><span class="std std-ref">пример в разделе &#8220;Запись в журнал&#8221;</span></a>.</p>
</dd>
<dt id="term-sigusr1">SIGUSR1</dt>
<dd><p class="first last">может привести к сохранению снимка, см. описание функции <a class="reference internal" href="#admin-snapshot"><span class="std std-ref">box.snapshot</span></a>.</p>
</dd>
<dt id="term-sigterm">SIGTERM</dt>
<dd><p class="first last">может привести к корректному завершению работы (с предварительным сохранением всех данных).</p>
</dd>
<dt id="term-sigint">SIGINT</dt>
<dd><p class="first last">(или &#8220;прерывание с клавиатуры&#8221;) может привести к корректному завершению работы (с предварительным сохранением всех данных).</p>
</dd>
<dt id="term-sigkill">SIGKILL</dt>
<dd><p class="first last">приводит к аварийному завершению работы (с возможной потерей данных).</p>
</dd>
</dl>
<p>Действие других сигналов определяется операционной системой. Все сигналы, кроме SIGKILL, могут быть проигнорированы, особенно если Tarantool-сервер выполняет длительную процедуру, которая позволяет вернуться к главному циклу.</p>
</div>
<div class="section" id="process-title">
<span id="administration-proctitle"></span><h2>5.10. Название процесса<a class="headerlink" href="#process-title" title="Ссылка на этот заголовок">¶</a></h2>
<p>Операционные системы Linux и FreeBSD позволяют запущенному процессу менять его название (title), в котором изначально содержится имя программы (name). Tarantool использует эту возможность, чтобы упростить работу системного администратора, например посмотреть, какие службы запущены на хосте, их статус и т.д.</p>
<p>Название процесса Tarantool-сервера состоит из следующих частей:</p>
<p><code class="extsamp docutils literal"><strong><span class="pre">имя_программы</span></strong> <span class="pre">[</span><strong><span class="pre">имя_файла_инициализации</span></strong><span class="pre">]</span> <strong><span class="pre">&lt;имя_роли&gt;</span></strong> <span class="pre">[</span><strong><span class="pre">название_процесса</span></strong><span class="pre">]</span></code></p>
<ul class="simple">
<li><p class="first"><strong>имя_программы</strong> — это, как правило, &#8220;tarantool&#8221;.</p>
</li>
<li><p class="first"><strong>имя_файла_инициализации</strong> — это имя  <a class="reference internal" href="../reference/configuration/index.html#index-init-label"><span class="std std-ref">файла инициализации на Lua</span></a>, если этот файл был указан при запуске.</p>
</li>
<li><p class="first"><strong>имя_роли</strong> — это может быть один из следующих вариантов:</p>
<ul>
<li><p class="first">&#8220;running&#8221; (узел находится в режиме &#8220;готов к принятию запросов&#8221;),</p>
</li>
<li><p class="first">&#8220;loading&#8221; (узел, который загружает данные из ранее сохраненного снимка и WAL-файла),</p>
</li>
<li><p class="first">&#8220;orphan&#8221; (узел не входит в состав кластера),</p>
</li>
<li>&#8220;hot_standby&#8221;, or</li>
<li><p class="first">&#8220;dumper&#8221; + process-id (идет сохранение снимка).</p>
</li>
</ul>
</li>
<li><p class="first"><strong>название_процесса</strong> — это необязательное название Tarantool-процесса в системе, которое берется из конфигурационного параметра <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-custom-proc-title"><span class="std std-ref">custom_proc_title</span></a>, если он указан.</p>
</li>
</ul>
<p>Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ps -AF <span class="p">|</span> grep tarantool
<span class="go">1000     17337 16716  1 91362  6916   0 11:07 pts/5    00:00:13 tarantool script.lua &lt;running&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="system-specific-administration-notes">
<h2>5.11. Заметки по администрированию для разных платформ<a class="headerlink" href="#system-specific-administration-notes" title="Ссылка на этот заголовок">¶</a></h2>
<p>This section will contain information about issues or features which exist
on some platforms but not others - for example, on certain versions of a
particular Linux distribution.</p>
<div class="section" id="debian-gnu-linux-and-ubuntu">
<h3>5.11.1. Debian GNU/Linux and Ubuntu<a class="headerlink" href="#debian-gnu-linux-and-ubuntu" title="Ссылка на этот заголовок">¶</a></h3>
<p>Настройка конкретного экземпляра Tarantool-сервера:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /etc/tarantool/instances.available/*instance-name.cfg* /etc/tarantool/instances.enabled/
</pre></div>
</div>
<p>Запуск всех экземпляров:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool start
</pre></div>
</div>
<p>Остановка всех экземпляров:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool stop
</pre></div>
</div>
<p>Запуск/остановка конкретного экземпляра:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool-instance-name start/stop
</pre></div>
</div>
</div>
<div class="section" id="fedora-rhel-centos">
<h3>5.11.2. Fedora, RHEL, CentOS<a class="headerlink" href="#fedora-rhel-centos" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данных платформ нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &#8220;RHEL&#8221;, &#8220;CentOS&#8221;, &#8220;Fedora&#8221; или &#8220;Red Hat&#8221;.</p>
</div>
<div class="section" id="freebsd">
<h3>5.11.3. FreeBSD<a class="headerlink" href="#freebsd" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данной платформы нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &#8220;FreeBSD&#8221;.</p>
</div>
<div class="section" id="mac-os-x">
<h3>5.11.4. Mac OS X<a class="headerlink" href="#mac-os-x" title="Ссылка на этот заголовок">¶</a></h3>
<p>Известных воспроизводящихся дефектов для данных платформ нет. Если вы столкнулись с плавающим дефектом, посмотрите описания проблем на странице <a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a>, введя в строке поиска слово &#8220;OS X&#8221;.</p>
</div>
</div>
<div class="section" id="notes-for-systemd-users">
<h2>5.12. Заметки для пользователей systemd<a class="headerlink" href="#notes-for-systemd-users" title="Ссылка на этот заголовок">¶</a></h2>
<p>Tarantool полностью поддерживает работу с <strong class="program">systemd</strong> как со средством для управления экземплярами и контроля за фоновыми программами базы данных.</p>
<div class="section" id="instance-management">
<h3>5.12.1. Управление экземплярами<a class="headerlink" href="#instance-management" title="Ссылка на этот заголовок">¶</a></h3>
<p>В архитектуре Tarantool&#8217;а заложена возможность запуска сразу многих экземпляров Tarantool-сервера на одной машине. С помощью <code class="samp docutils literal"><span class="pre">systemctl</span> <em><span class="pre">start|stop|restart|status</span></em> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> можно управлять базами данных и Lua-приложениями.</p>
<div class="section" id="creating-instances">
<h4>5.12.1.1. Создание экземпляров<a class="headerlink" href="#creating-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Задайте все настройки в виде Lua-скрипта и поместите их в файл <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3313</span><span class="p">}</span>
<span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myappcode&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>(это пример минимально достаточной конфигурации).</p>
<p>Также вы можете посмотреть пример Lua-скрипт в файле <code class="file docutils literal"><span class="pre">example.lua</span></code>, который входит в состав дистрибутива Tarantool&#8217;а и содержит значения всех опций.</p>
</div>
<div class="section" id="starting-instances">
<h4>5.12.1.2. Запуск экземпляров<a class="headerlink" href="#starting-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для запуска экземпляра <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl start tarantool@example
<span class="gp">$</span> ps axuf<span class="p">|</span>grep exampl<span class="o">[</span>e<span class="o">]</span>
<span class="go">taranto+  5350  1.3  0.3 1448872 7736 ?        Ssl  20:05   0:28 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>(здесь и далее мы приводим примеры консольного вывода для Fedora).</p>
<p>Для автоматической загрузки экземпляра <code class="docutils literal"><span class="pre">${MYAPP}</span></code> во время запуска всей системы используйте команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>.</p>
</div>
<div class="section" id="monitoring-instances">
<h4>5.12.1.3. Мониторинг экземпляров<a class="headerlink" href="#monitoring-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для проверки информации об экземпляре <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example
<span class="go">tarantool@example.service - Tarantool Database Server</span>
<span class="go">Loaded: loaded (/etc/systemd/system/tarantool@.service; disabled; vendor preset: disabled)</span>
<span class="go">Active: active (running)</span>
<span class="go">Docs: man:tarantool(1)</span>
<span class="go">Process: 5346 ExecStart=/usr/bin/tarantoolctl start %I (code=exited, status=0/SUCCESS)</span>
<span class="go">Main PID: 5350 (tarantool)</span>
<span class="go">Tasks: 11 (limit: 512)</span>
<span class="go">CGroup: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">+ 5350 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>Для проверки журнала загрузки выполните команду <code class="samp docutils literal"><span class="pre">journalctl</span> <span class="pre">-u</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 5
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:17:47 MSK. --</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Started Tarantool Database Server</span>
</pre></div>
</div>
</div>
<div class="section" id="attaching-to-instances">
<h4>5.12.1.4. Подсоединение к экземплярам<a class="headerlink" href="#attaching-to-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Вы можете подсоединиться к запущенному экземпляру Tarantool-сервера и выполнить некий Lua-скрипт с помощью утилиты <strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; 1 + 1</span>
<span class="go">---</span>
<span class="go">- 2</span>
<span class="go">...</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-logs">
<h4>5.12.1.5. Проверка журнала<a class="headerlink" href="#checking-logs" title="Ссылка на этот заголовок">¶</a></h4>
<p>Tarantool ведет записи о важных событиях в файле <code class="file docutils literal"><span class="pre">/var/log/tarantool/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.log</span></code>.</p>
<p>Давайте запишем что-нибудь в файл журнала:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;log&#39;).info(&quot;Hello for README.systemd readers&quot;)</span>
<span class="go">---</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Затем проверим содержимое журнала:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tail /var/log/tarantool/example.log
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: started</span>
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: bound to 0.0.0.0:3301</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/tarantoolctl I&gt; ready to accept requests</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/example I&gt; Run console at /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/101/example I&gt; tcp_server: remove dead UNIX socket: /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/104/console/unix/:/var/run/tarant I&gt; started</span>
<span class="go">2016-01-21 21:09:45.985 [5914] main C&gt; entering the event loop</span>
<span class="go">2016-01-21 21:14:43.320 [5914] main/105/console/unix/: I&gt; client unix/: connected</span>
<span class="go">2016-01-21 21:15:07.115 [5914] main/105/console/unix/: I&gt; Hello for README.systemd readers</span>
<span class="go">2016-01-21 21:15:09.250 [5914] main/105/console/unix/: I&gt; client unix/: disconnected</span>
</pre></div>
</div>
<p>Для ротации журнала нужно установить программу <strong class="program">logrotate</strong>. Настройки для ротации можно задать в файле <code class="file docutils literal"><span class="pre">/etc/logrotate.d/tarantool</span></code>.</p>
</div>
<div class="section" id="stopping-instances">
<h4>5.12.1.6. Остановка экземпляров<a class="headerlink" href="#stopping-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для просмотра информации о запущенном экземпляре <code class="docutils literal"><span class="pre">${MYAPP}</span></code> выполните команду <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl stop tarantool@example
</pre></div>
</div>
</div>
</div>
<div class="section" id="daemon-supervision">
<h3>5.12.2. Контроль за фоновыми программами<a class="headerlink" href="#daemon-supervision" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если какой-либо экземпляр Tarantool-сервера выходит из строя, <strong class="program">systemd</strong> автоматически перезапускает его.</p>
<p>Давайте попробуем вывести из строя один экземпляр:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5885 (tarantool)</span>
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; os.exit(-1)</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p>А теперь убедимся, что <strong class="program">systemd</strong> перезапустила его:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5914 (tarantool)</span>
</pre></div>
</div>
<p>И под конец проверим содержимое журнала загрузки:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 8
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:09:45 MSK. --</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Unit entered failed state.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Failed with result &#39;exit-code&#39;.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Service hold-off time over, scheduling restart.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Started Tarantool Database Server.</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-the-service-file">
<h3>5.12.3. Правка настроек сервисного файла<a class="headerlink" href="#customizing-the-service-file" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пожалуйста, не редактируйте файл <code class="file docutils literal"><span class="pre">tarantool&#64;.service</span></code> по месту, поскольку все ваши изменения будут перезаписаны при последующих обновлениях Tarantool&#8217;а. Мы рекомендуем скопировать этот файл в <code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> и править настройки уже в копии. Либо вы можете создать поддиректорию с именем <code class="file docutils literal"><span class="pre">unit.d/</span></code> в директории <code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> и положить туда drop-in файл с именем <code class="file docutils literal"><span class="pre">name.conf</span></code>, в котором будут указаны только те настройки, которые нужно поменять. См. подробности в <code class="docutils literal"><span class="pre">systemd.unit(5)</span></code>.</p>
</div>
<div class="section" id="debugging">
<h3>5.12.4. Отладка<a class="headerlink" href="#debugging" title="Ссылка на этот заголовок">¶</a></h3>
<p>При аварийном завершении Tarantool-сервера, <strong class="program">coredumpctl</strong> автоматически сохраняет дампы памяти (core dumps) и трассировку стека (stack traces). Вот как работает этот механизм:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># !!! ВНИМАНИЕ: никогда не делайте этого</span>
<span class="gp">  #</span> в условиях промышленной эксплуатации !!!
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;ffi&#39;).cast(&#39;char *&#39;, 0)[0] = 48</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p>Введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">list</span> <span class="pre">/usr/bin/tarantool</span></code>, чтобы получить отчет о последних аварийных завершениях Tarantool-демона:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl list /usr/bin/tarantool
<span class="go">MTIME                            PID   UID   GID SIG PRESENT EXE</span>
<span class="go">Sat 2016-01-23 15:21:24 MSK   20681  1000  1000   6   /usr/bin/tarantool</span>
<span class="go">Sat 2016-01-23 15:51:56 MSK   21035   995   992   6   /usr/bin/tarantool</span>
</pre></div>
</div>
<p>Чтобы получить трассировку стека и прочую полезную информацию, введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl info 21035
<span class="go">          PID: 21035 (tarantool)</span>
<span class="go">          UID: 995 (tarantool)</span>
<span class="go">          GID: 992 (tarantool)</span>
<span class="go">       Signal: 6 (ABRT)</span>
<span class="go">    Timestamp: Sat 2016-01-23 15:51:42 MSK (4h 36min ago)</span>
<span class="go"> Command Line: tarantool example.lua &lt;running&gt;</span>
<span class="go">   Executable: /usr/bin/tarantool</span>
<span class="go">Control Group: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">         Unit: tarantool@example.service</span>
<span class="go">        Slice: system-tarantool.slice</span>
<span class="go">      Boot ID: 7c686e2ef4dc4e3ea59122757e3067e2</span>
<span class="go">   Machine ID: a4a878729c654c7093dc6693f6a8e5ee</span>
<span class="go">     Hostname: localhost.localdomain</span>
<span class="go">      Message: Process 21035 (tarantool) of user 995 dumped core.</span>

<span class="go">               Stack trace of thread 21035:</span>
<span class="gp">               #</span><span class="m">0</span>  0x00007f84993aa618 raise <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">1</span>  0x00007f84993ac21a abort <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">2</span>  0x0000560d0a9e9233 _ZL12sig_fatal_cbi <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">3</span>  0x00007f849a211220 __restore_rt <span class="o">(</span>libpthread.so.0<span class="o">)</span>
<span class="gp">               #</span><span class="m">4</span>  0x0000560d0aaa5d9d lj_cconv_ct_ct <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">5</span>  0x0000560d0aaa687f lj_cconv_ct_tv <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">6</span>  0x0000560d0aaabe33 lj_cf_ffi_meta___newindex <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">7</span>  0x0000560d0aaae2f7 lj_BC_FUNCC <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">8</span>  0x0000560d0aa9aabd lua_pcall <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">9</span>  0x0000560d0aa71400 lbox_call <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">10</span> 0x0000560d0aa6ce36 lua_fiber_run_f <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">11</span> 0x0000560d0a9e8d0c _ZL16fiber_cxx_invokePFiP13__va_list_tagES0_ <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">12</span> 0x0000560d0aa7b255 fiber_loop <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">13</span> 0x0000560d0ab38ed1 coro_init <span class="o">(</span>tarantool<span class="o">)</span>
<span class="go">               ...</span>
</pre></div>
</div>
<p>Теперь введем <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">-o</span> <span class="pre">filename.core</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code>, чтобы сохранить дамп памяти в отдельный файл.</p>
<p>Далее с помощью команды <code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">gdb</span> <span class="pre">&lt;pid&gt;</span></code> запустим отладчик <strong class="program">gdb</strong> и подадим сохраненный дамп памяти ему на вход.</p>
<p>Мы очень рекомендуем установить пакет <code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code>, чтобы сделать отладку средствами <strong class="program">gdb</strong> более эффективной. Например:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> dnf debuginfo-install tarantool
</pre></div>
</div>
<p>С помощью <strong class="program">gdb</strong> вы можете узнать, какие еще <code class="docutils literal"><span class="pre">debuginfo</span></code>-пакеты нужно установить:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># gdb -p &lt;pid&gt;</span>
<span class="go">...</span>
<span class="go">Missing separate debuginfos, use: dnf debuginfo-install</span>
<span class="go">glibc-2.22.90-26.fc24.x86_64 krb5-libs-1.14-12.fc24.x86_64</span>
<span class="go">libgcc-5.3.1-3.fc24.x86_64 libgomp-5.3.1-3.fc24.x86_64</span>
<span class="go">libselinux-2.4-6.fc24.x86_64 libstdc++-5.3.1-3.fc24.x86_64</span>
<span class="go">libyaml-0.1.6-7.fc23.x86_64 ncurses-libs-6.0-1.20150810.fc24.x86_64</span>
<span class="go">openssl-libs-1.0.2e-3.fc24.x86_64</span>
</pre></div>
</div>
<p>В трассировке стека используются символические имена, даже если у вас не установлен пакет <code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code>.</p>
<p>Дополнительно см. документацию по вашей Linux-системе.</p>
</div>
<div class="section" id="precautions">
<h3>5.12.5. Особые указания<a class="headerlink" href="#precautions" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li><p class="first">Пожалуйста, не используйте <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">{start,stop,restart}</span></code> для управления экземплярами, которые были запущены с помощью <strong class="program">systemd</strong>. Но вы можете использовать <strong class="program">tarantoolctl</strong> для запуска/остановки экземпляров в ваших локальных директориях (например, <code class="file docutils literal"><span class="pre">$</span><em><span class="pre">HOME</span></em></code>), что не требует пользовательских прав уровня <code class="docutils literal"><span class="pre">ROOT</span></code>.</p>
</li>
<li><p class="first">Утилита <strong class="program">tarantoolctl</strong> уже настроена так, чтобы корректно работать с <strong class="program">systemd</strong>. Пожалуйста, не меняйте общесистемные настройки для <strong class="program">tarantoolctl</strong>, такие как пути, настройки прав для директорий и имена пользователей, т.к. это может привести к неожиданным проблемам.</p>
</li>
<li><p class="first">Поддержкой скриптов для <strong class="program">systemd</strong> занимается команда разработки Tarantool&#8217;а (<a class="reference external" href="http://tarantool.org">http://tarantool.org</a>). Если у вас возникли проблемы при работе Tarantool&#8217;а с <strong class="program">systemd</strong>, то мы просим сообщать об этом нашей команде (<a class="reference external" href="https://github.com/tarantool/tarantool/issues/">https://github.com/tarantool/tarantool/issues/</a>), а не разработчикам вашего Linux-дистрибутива.</p>
</li>
</ul>
</div>
<div class="section" id="limitations">
<h3>5.12.6. Ограничения<a class="headerlink" href="#limitations" title="Ссылка на этот заголовок">¶</a></h3>
<p>These limitations exist due to decisions by packagers
to support systemd alongside sysvinit.</p>
<p><code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">start</span></code> under systemd,
or <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool</span></code> (without an &#64;instance argument),
will start only those instances which were enabled before reboot
or before the last time that systemd was reloaded with <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code>.</p>
<p>(<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool</span></code>, without an &#64;instance argument,
is provided only for interoperability with sysvinit scripts.
Please use <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool&#64;instance</span></code> instead.)</p>
<p><code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">stop</span></code> under systemd,
or <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">tarantool</span> <span class="pre">stop</span></code> (without an &#64;instance argument),
will do nothing.</p>
<p>Starting with Tarantool version 1.7.1.42, a new version of
tarantool-common is required.
(tarantool-common is a downloadable package which provides
scripts to work with tarantool configuration and log files.)
An attempt to upgrade tarantool-common will cause restart of all instances.</p>
</div>
<div class="section" id="sysvinit-systemd-conversion">
<h3>5.12.7. sysvinit -&gt; systemd conversion<a class="headerlink" href="#sysvinit-systemd-conversion" title="Ссылка на этот заголовок">¶</a></h3>
<p>These instructions apply only for Debian/Ubuntu distros
where both sysvinit and systemd exist.</p>
<p>Install new systemd-enabled packages.</p>
<p>#For each instancename in /etc/tarantool/instances.enabled/: <br />
#To enable the instance to be automatically loaded by systemd: <br />
<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">tarantool&#64;instancename</span></code></p>
<p>#The following command does nothing but is recommended for consistency: <br />
<code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">stop</span></code></p>
<p>#Disable sysvinit-compatible wrappers: <br />
<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">tarantool;</span> <span class="pre">update-rc.d</span> <span class="pre">tarantool</span> <span class="pre">remove</span></code></p>
</div>
</div>
</div>


          
          
  <div id="disqus_thread"></div>
  <script>
    // DON'T EDIT
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//tarantooldb.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
      comments powered by Disqus.
    </a>
  </noscript>

          
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="app_server.html"
           class="b-prev b-ellipsis"
           title="4. Сервер приложений">4. Сервер приложений</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../_sources/book/administration.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="connectors/index.html"
           class="b-next b-ellipsis"
           title="6. Коннекторы">6. Коннекторы</a>
      </div>
    
    </div>
  
</div>
      </div>
    </div>
  

        </div>
        </div>

    <!-- FOOTER > -->
    
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

    <!-- < FOOTER -->
    <div id="mobile-checker"></div>
  </div>
  </body>
</html>

