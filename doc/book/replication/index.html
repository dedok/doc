





<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>4. Replication</title>
    <link rel="icon" type="image/png" sizes="192x192"
          href="/theme/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32"
          href="/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96"
          href="/theme/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16"
          href="/theme/favicon/favicon-16x16.png">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.1',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          // Replace PAGE_URL with your page's canonical URL variable
          // this.page.url = PAGE_URL;
          this.page.identifier = "book/replication/index";
          this.language = "en"
      };
    </script>
    <script id="dsq-count-scr" src="https://tarantooldb.disqus.com/count.js" async/></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.pin.min.js"></script>
    <script type="text/javascript" src="../../_static/headers.js"></script>
    <script type="text/javascript" src="../../_static/jquery-ui.js"></script>
    <script type="text/javascript" src="/js/menu.js"></script>
    <script type="text/javascript" src="/js/mobile_menu.js"></script>
    <link rel="stylesheet" href="/theme/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="../../_static/sphinx_design.css">
    <link rel="stylesheet" href="../../_static/jquery-ui.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design b-doc-book/replication/index">
  
    <div class="b-wrapper">
      <!-- HEADER > -->
      
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search" action="../../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

        </nav>
      </div>
      <div class="b-menu__close">
        <!-- empty -->
      </div>
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      </nav>
    </div>
  </header>

      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
    <div class="b-block-wrapper">
      <h2
      
        class="b-section-title b-ellipsis toggle-navigation"
      
        title="4. Replication">
          4. Replication
      </h2>
  <div class="b-doc-language_selector">
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../../book/replication/index.html
  
"
           class="b-doc-language_selector-item-url p-active"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../ru/book/replication/index.html
  
"
           class="b-doc-language_selector-item-url"> Ru </a>
      
      </li>
    
    </ul>
  </div>
</div>
  </section>
  
    <div class="b-cols_content b-clearbox">
      <div class="b-cols_content_left">
        
<form id="searchbox" role="search" class="search b-search" action="../../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#an-application-server-together-with-a-database-manager">An Application Server Together With A Database Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#database-features">Database Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">1. Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro.html#how-to-read-the-documentation">1.1. How to read the documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro.html#getting-in-touch-with-the-tarantool-community">1.2. Getting in touch with the Tarantool community</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide_getting_started.html">2. Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Downloading and installing a binary package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Starting Tarantool and making your first database</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#connecting-remotely">2.3. Connecting remotely</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../box/index.html">3. Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../box/index.html#document-data-model">3.1. Document data model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#space">3.1.1. Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#tuple-set">3.1.2. Tuple set</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#index">3.1.3. Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#data-types">3.1.4. Data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#operations">3.1.5. Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#saving-to-disk">3.1.6. Saving to disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#data-manipulation">3.1.7. Data manipulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#index-operations">3.1.8. Index operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/index.html#the-box-library">3.1.9. The box library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/index.html#submodules-of-the-box-library">3.2. Submodules of the box library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../box/index.html#the-two-storage-engines-memtx-and-vinyl">3.3. The two storage engines: memtx and vinyl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../box/index.html#library-reference">3.4. Library reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_schema.html">3.4.1. Submodule <cite>box.schema</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_schema.html#example">3.4.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_space.html">3.4.2. Submodule <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-read-space-tuples">3.4.2.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">3.4.2.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_index.html">3.4.3. Submodule <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#example-showing-use-of-the-box-functions">3.4.3.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#example-showing-a-user-defined-iterator">3.4.3.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">3.4.3.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_session.html">3.4.4. Submodule <cite>box.session</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_session.html#example">3.4.4.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_tuple.html">3.4.5. Submodule <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_tuple.html#example">3.4.5.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_introspection.html">3.4.6. Server introspection</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.cfg">3.4.6.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.info">3.4.6.2. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.slab">3.4.6.3. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_introspection.html#submodule-box-stat">3.4.6.4. Submodule <cite>box.stat</cite></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/admin.html">3.4.7. Administrative requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/atomic.html">3.4.8. Atomic execution</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/atomic.html#cooperative-multitasking-environment">3.4.8.1. Cooperative multitasking environment</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/atomic.html#example">3.4.8.2. Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/atomic.html#the-implicit-yield-rules">3.4.8.3. The Implicit Yield Rules</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html">3.4.9. Access control</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#passwords">3.4.9.1. Passwords</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#users-and-the-user-space">3.4.9.2. Users and the _user space</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#privileges-and-the-priv-space">3.4.9.3. Privileges and the _priv space</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#functions-and-the-func-space">3.4.9.4. Functions and the _func space</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#box-session-and-security">3.4.9.5. <code class="docutils literal"><span class="pre">box.session</span></code> and security</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#roles">3.4.9.6. Roles</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/authentication.html#example-showing-a-role-within-a-role">3.4.9.7. Example showing a role within a role</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/triggers.html">3.4.10. Triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#connection-triggers">3.4.10.1. Connection triggers</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../box/triggers.html#example">3.4.10.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#authentication-triggers">3.4.10.2. Authentication triggers</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#lua-module.box.space">3.4.10.3. Replace triggers</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../box/triggers.html#id1">3.4.10.3.1. Example</a></li>
<li class="toctree-l6"><a class="reference internal" href="../box/triggers.html#another-example">3.4.10.3.2. Another Example</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#getting-a-list-of-triggers">3.4.10.4. Getting a list of triggers</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/limitations.html">3.4.11. Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/vinyl_diff.html">3.4.12. Differences between memtx and vinyl storage engines</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Replication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#replication-architecture">4.1. Replication architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-master">4.2. Setting up the master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-replica">4.3. Setting up a replica</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recovering-from-a-degraded-state">4.4. Recovering from a degraded state</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instructions-for-quick-startup-of-a-new-two-server-simple-cluster">4.5. Instructions for quick startup of a new two-server simple cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-a-replica-s-actions">4.6. Monitoring a replica's actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preventing-duplicate-actions">4.7. Preventing duplicate actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#master-master-replication">4.8. Master-master replication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#all-the-what-if-questions">4.9. All the &quot;What If?&quot; questions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hands-on-replication-tutorial">4.10. Hands-on replication tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">5. Configuration reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html#command-options">5.1. Command options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html#uri">5.2. URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html#initialization-file">5.3. Initialization file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html#configuration-parameters">5.4. Configuration parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#basic-parameters">5.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#configuring-the-storage">5.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#snapshot-daemon">5.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#binary-logging-and-snapshots">5.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#replication">5.4.5. Replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#networking">5.4.6. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../configuration/index.html#logging">5.4.7. Logging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html#local-hot-standby">5.5. Local hot standby</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../administration.html">6. Server administration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#server-signal-handling">6.1. Server signal handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#process-title">6.2. Process title</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#using-tarantool-as-a-client">6.3. Using tarantool as a client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#conventions-used-in-this-section">6.3.1. Conventions used in this section</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#options-when-starting-client-from-the-command-line">6.3.2. Options when starting client from the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#tokens-requests-and-special-key-combinations">6.3.3. Tokens, requests, and special key combinations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#requests">6.3.4. Requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#utility-tarantoolctl">6.4. Utility tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#configuration-for-tarantoolctl">6.4.1. Configuration for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#commands-for-tarantoolctl">6.4.2. Commands for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#typical-code-snippets-for-tarantoolctl">6.4.3. Typical code snippets for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#a-detailed-example-for-tarantoolctl">6.4.4. A detailed example for tarantoolctl</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#utility-tarantoolctl-connect">6.5. Utility tarantoolctl connect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#admin-ports">6.6. Admin ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#system-specific-administration-notes">6.7. System-specific administration notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#debian-gnu-linux-and-ubuntu">6.7.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#fedora-rhel-centos">6.7.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#freebsd">6.7.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#mac-os-x">6.7.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#notes-for-systemd-users">6.8. Notes for systemd users</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#instance-management">6.8.1. Instance management</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#creating-instances">6.8.1.1. Creating instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#starting-instances">6.8.1.2. Starting instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#monitoring-instances">6.8.1.3. Monitoring instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#attaching-to-instances">6.8.1.4. Attaching to instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#checking-logs">6.8.1.5. Checking logs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#stopping-instances">6.8.1.6. Stopping instances</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#daemon-supervision">6.8.2. Daemon supervision</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#customizing-the-service-file">6.8.3. Customizing the service file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#debugging">6.8.4. Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#precautions">6.8.5. Precautions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#updating-tarantool-in-production">6.9. Updating Tarantool in production</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#backups">6.10. Backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#upgrades">6.11. Upgrades</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../connectors/index.html">7. Connectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#protocol">7.1. Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#packet-example">7.2. Packet example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#setting-up-the-server-for-connector-examples">7.3. Setting up the server for connector examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#java">7.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#go">7.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#r">7.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#perl">7.7. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#php">7.8. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#python">7.9. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#c">7.10. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../connectors/index.html#example-1">7.10.1. Example 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../connectors/index.html#example-2">7.10.2. Example 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#interpreting-function-return-values">7.11. Interpreting function return values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">8. Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules.html#installing-an-existing-module">8.1. Installing an existing module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules.html#creating-a-new-lua-module-locally">8.2. Creating a new Lua module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules.html#creating-a-new-c-c-module-locally">8.3. Creating a new C/C++ module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules.html#creating-a-mixed-lua-c-module-locally">8.4. Creating a mixed Lua/C module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules.html#tips-for-special-situations">8.5. Tips for special situations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app/a_errcodes.html">9. Appendix A. List of error codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app/b_internals.html">10. Appendix B. Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app/b_internals.html#data-persistence-and-the-wal-file-format">10.1. Data persistence and the WAL file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app/b_internals.html#the-snapshot-file-format">10.2. The snapshot file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app/b_internals.html#the-recovery-process">10.3. The Recovery Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app/b_internals.html#server-startup-with-replication">10.4. Server Startup With Replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app/c_lua_tutorial.html">11. Appendix C. Lua tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app/c_lua_tutorial.html#insert-one-million-tuples-with-a-lua-stored-procedure">11.1. Insert one million tuples with a Lua stored procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#configure">11.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#delimiter">11.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#create-a-function-that-returns-a-string">11.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#create-a-function-that-calls-another-function-and-sets-a-variable">11.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#modify-the-function-so-it-returns-a-one-letter-random-string">11.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#modify-the-function-so-it-returns-a-ten-letter-random-string">11.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#make-a-tuple-out-of-a-number-and-a-string">11.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#modify-main-function-to-insert-a-tuple-into-the-database">11.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/c_lua_tutorial.html#modify-main-function-to-insert-a-million-tuples-into-the-database">11.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../app/c_lua_tutorial.html#sum-a-json-field-for-all-tuples">11.2. Sum a JSON field for all tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app/c_lua_tutorial.html#indexed-pattern-search">11.3. Indexed Pattern Search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app/d_vinyl/index.html">12. Appendix D. Vinyl</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app/d_vinyl/index.html#introduction">12.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app/d_vinyl/index.html#under-the-hood">12.2. Under the hood</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app/d_vinyl/index.html#inserting-the-first-200-000-keys">12.2.1. Inserting the first 200.000 keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/d_vinyl/index.html#inserting-the-next-300-000-keys">12.2.2. Inserting the next 300.000 keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/d_vinyl/index.html#inserting-the-next-200-000-keys">12.2.3. Inserting the next 200.000 keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/d_vinyl/index.html#inserting-the-last-300-000-keys">12.2.4. Inserting the last 300.000 keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app/d_vinyl/index.html#reading-million-keys">12.2.5. Reading million keys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app/e_cookbook.html">13. Appendix E. Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app/f_c_tutorial.html">14. Appendix F. C tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app/f_c_tutorial.html#c-stored-procedures">14.1. C stored procedures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app/g_changes.html">15. Appendix G. Version-specific changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app/g_changes.html#changes-in-tarantool-version-1-7">15.1. Changes in Tarantool version 1.7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_lua/index.html">Lua reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/box.html">Module <cite>box</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../box/box_schema.html">3.4.1. Submodule <cite>box.schema</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_schema.html#example">3.4.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/box_space.html">3.4.2. Submodule <cite>box.space</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-read-space-tuples">3.4.2.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">3.4.2.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/box_index.html">3.4.3. Submodule <cite>box.index</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_index.html#example-showing-use-of-the-box-functions">3.4.3.1. Example showing use of the box functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_index.html#example-showing-a-user-defined-iterator">3.4.3.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">3.4.3.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/box_session.html">3.4.4. Submodule <cite>box.session</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_session.html#example">3.4.4.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/box_tuple.html">3.4.5. Submodule <cite>box.tuple</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_tuple.html#example">3.4.5.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/box_introspection.html">3.4.6. Server introspection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.cfg">3.4.6.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.info">3.4.6.2. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_introspection.html#lua-module.box.slab">3.4.6.3. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_introspection.html#submodule-box-stat">3.4.6.4. Submodule <cite>box.stat</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/triggers.html">3.4.10. Triggers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/triggers.html#connection-triggers">3.4.10.1. Connection triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#example">3.4.10.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/triggers.html#authentication-triggers">3.4.10.2. Authentication triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/triggers.html#lua-module.box.space">3.4.10.3. Replace triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#id1">3.4.10.3.1. Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/triggers.html#another-example">3.4.10.3.2. Another Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/triggers.html#getting-a-list-of-triggers">3.4.10.4. Getting a list of triggers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/clock.html">Module <cite>clock</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/console.html">Module <cite>console</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/crypto.html">Module <cite>crypto</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/crypto.html#incremental-methods-in-the-crypto-module">Incremental methods in the crypto module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/csv.html">Module <cite>csv</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/digest.html">Module <cite>digest</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/digest.html#incremental-methods-in-the-digest-module">Incremental methods in the digest module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/digest.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/box_error.html">Submodule <cite>box.error</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/fiber.html">Module <cite>fiber</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/fiber.html#example-of-fiber-use">Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/fiber_ipc.html">Submodule <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/fiber_ipc.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/fio.html">Module <cite>fio</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/fio.html#common-pathname-manipulations">Common pathname manipulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/fio.html#common-file-manipulations">Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/fun.html">Module <cite>fun</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/jit.html">Module <cite>jit</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/json.html">Module <cite>json</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/json.html#configuration-settings">Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/log.html">Module <cite>log</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/log.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/msgpack.html">Module <cite>msgpack</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/msgpack.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/net_box.html">Module <cite>net.box</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/net_box.html#example-showing-use-of-most-of-the-net-box-methods">Example showing use of most of the net.box methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/box_once.html">Function <cite>box.once</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/os.html">Module <cite>os</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/pickle.html">Module <cite>pickle</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/socket.html">Module <cite>socket</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/socket.html#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">Use of a TCP socket over the Internet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_lua/socket.html#use-of-a-udp-socket-on-localhost">Use of a UDP socket on localhost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/strict.html">Module <cite>strict</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/tap.html">Module <cite>tap</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/tap.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/tarantool.html">Module <cite>tarantool</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/uuid.html">Module <cite>uuid</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/uuid.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/yaml.html">Module <cite>yaml</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_lua/yaml.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_lua/other.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_rock/index.html">Lua rocks reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference_rock/dbms.html">SQL DBMS Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/dbms.html#mysql-example">MySQL Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#installation">Installation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference_rock/dbms.html#with-luarocks">With LuaRocks</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference_rock/dbms.html#with-github">With GitHub</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#connecting">Connecting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#how-to-ping">How to ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#executing-a-statement">Executing a statement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#closing-connection">Closing connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/dbms.html#postgresql-example">PostgreSQL Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id1">Installation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference_rock/dbms.html#id2">With LuaRocks</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference_rock/dbms.html#id3">With GitHub</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id4">Connecting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id5">How to ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id6">Executing a statement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id7">Closing connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference_rock/dbms.html#id8">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_rock/expirationd.html">Module <cite>expirationd</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_rock/shard.html">Module <cite>shard</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/shard.html#example-shard-init-syntax-for-one-shard">Example: shard.init syntax for one shard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/shard.html#example-shard-init-syntax-for-three-shards">Example: shard.init syntax for three shards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/shard.html#example-shard-minimal-configuration">Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/shard.html#example-shard-scaling-out">Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_rock/tdb.html">Module <cite>tdb</cite></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/tdb.html#debugger-commands">Debugger Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference_rock/tdb.html#example-session">Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_capi/index.html">C API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/box.html">Module <cite>box</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/clock.html">Module <cite>clock</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/coio.html">Module <cite>coio</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/error.html">Module <cite>error</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/fiber.html">Module <cite>fiber</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/box_index.html">Module <cite>index</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/latch.html">Module <cite>latch</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/utils.html">Module <cite>lua/utils</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/say.html">Module <cite>say</cite> (logging)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/schema.html">Module <cite>schema</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/trivia.html">Module <cite>trivia/config</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/tuple.html">Module <cite>tuple</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference_capi/txn.html">Module <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/intro.html">What documentation there is</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/building_from_source.html">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/building_documentation.html">Building documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/developer_guidelines.html">Developer guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/developer_guidelines.html#how-to-work-on-a-bug">How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html">Documentation guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#markup-issues">Markup issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#wrapping-text">Wrapping text</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#formatting-code-snippets">Formatting code snippets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#using-separated-links">Using separated links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#creating-labels-for-local-links">Creating labels for local links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#making-comments">Making comments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#language-and-style-issues">Language and style issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#us-vs-british-spelling">US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#examples-and-templates">Examples and templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#module-and-function">Module and function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#module-class-and-method">Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/box_protocol.html">Tarantool's binary protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#notion-in-diagrams">Notion in diagrams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#greeting-packet">Greeting Packet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#unified-packet-structure">Unified packet structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#authentication">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#requests">Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#response-packet-structure">Response packet structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#replication-packet-structure">Replication packet structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/box_protocol.html#xlog-snap">XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/c_style_guide.html">C Style Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/c_style_guide.html#general-guidelines">General guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#commenting-style">Commenting style</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#header-files">Header files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#allocating-memory">Allocating memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/c_style_guide.html#linux-kernel-coding-style">Linux kernel coding style</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-1-indentation">Chapter 1: Indentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-2-breaking-long-lines-and-strings">Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-3-placing-braces-and-spaces">Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-3-1-spaces">Chapter 3.1:  Spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-4-naming">Chapter 4: Naming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-5-typedefs">Chapter 5: Typedefs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-6-functions">Chapter 6: Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-7-centralized-exiting-of-functions">Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-8-commenting">Chapter 8: Commenting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-9-you-ve-made-a-mess-of-it">Chapter 9: You've made a mess of it</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-10-kconfig-configuration-files">Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-11-data-structures">Chapter 11: Data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-12-macros-enums-and-rtl">Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-13-printing-kernel-messages">Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-14-allocating-memory">Chapter 14: Allocating memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-15-the-inline-disease">Chapter 15: The inline disease</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-16-function-return-values-and-names">Chapter 16: Function return values and names</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-17-don-t-re-invent-the-kernel-macros">Chapter 17:  Don't re-invent the kernel macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-18-editor-modelines-and-other-cruft">Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#appendix-i-references">Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/python_style_guide.html">Python Style Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#code-lay-out">Code lay-out</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#indentation">Indentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#tabs-or-spaces">Tabs or Spaces?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#maximum-line-length">Maximum Line Length</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#blank-lines">Blank Lines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#encodings-pep-263">Encodings (PEP 263)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#imports">Imports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#whitespace-in-expressions-and-statements">Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#pet-peeves">Pet Peeves</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#other-recommendations">Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#comments">Comments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#block-comments">Block Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#inline-comments">Inline Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#documentation-strings">Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#version-bookkeeping">Version Bookkeeping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#naming-conventions">Naming Conventions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#descriptive-naming-styles">Descriptive: Naming Styles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#prescriptive-naming-conventions">Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#names-to-avoid">Names to Avoid</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#package-and-module-names">Package and Module Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#class-names">Class Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#exception-names">Exception Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#global-variable-names">Global Variable Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#function-names">Function Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#function-and-method-arguments">Function and method arguments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#method-names-and-instance-variables">Method Names and Instance Variables</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#constants">Constants</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#designing-for-inheritance">Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html#copyright">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/release_management.html">Release management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/release_management.html#how-to-make-a-minor-release">How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
      <div class="b-cols_content_right">
        <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="../index.html"
             class="b-path-list-item-url b-ellipsis">
            User Guide
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="4. Replication" class="b-path_current b-ellipsis">
          4. Replication
        </div>
      </li>
      
    </ul>
  </div>

  <div class="section" id="replication">
<span id="index-box-replication"></span><h1>4. Replication<a class="headerlink" href="#replication" title="Permalink to this headline">¶</a></h1>
<p>Replication allows multiple Tarantool servers to work on copies of the same
databases. The databases are kept in synch because each server can communicate
its changes to all the other servers. Servers which share the same databases
are a &quot;cluster&quot;. Each server in a cluster also has a numeric identifier which
is unique within the cluster, known as the &quot;server id&quot;.</p>
<p>To set up replication, it's necessary to set up the master servers which
make the original data-change requests, set up the replica servers which
copy data-change requests from masters, and establish procedures for
recovery from a degraded state.</p>
<div class="section" id="replication-architecture">
<h2>4.1. Replication architecture<a class="headerlink" href="#replication-architecture" title="Permalink to this headline">¶</a></h2>
<p>A replica gets all updates from the master by continuously fetching and
applying its write-ahead log (WAL). Each record in the WAL represents a
single Tarantool data-change request such as INSERT or UPDATE or DELETE,
and is assigned a monotonically growing log sequence number (LSN). In
essence, Tarantool replication is row-based: each data change command is
fully deterministic and operates on a single tuple.</p>
<p>A stored program invocation is not written to the write-ahead log. Instead,
log events for actual data-change requests, performed by the Lua code, are
written to the log. This ensures that possible non-determinism of Lua does
not cause replication to go out of sync.</p>
</div>
<div class="section" id="setting-up-the-master">
<h2>4.2. Setting up the master<a class="headerlink" href="#setting-up-the-master" title="Permalink to this headline">¶</a></h2>
<p>To prepare the master for connections from the replica, it's only necessary
to include &quot;<a class="reference internal" href="../configuration/index.html#cfg-basic-listen"><span class="std std-ref">listen</span></a>&quot; in the initial <code class="docutils literal"><span class="pre">box.cfg</span></code> request, for example
<code class="docutils literal"><span class="pre">box.cfg{listen=3301}</span></code>. A master with enabled &quot;listen&quot; URI can accept
connections from as many replicas as necessary on that URI. Each replica
has its own <a class="reference internal" href="#index-monitoring-replica-actions"><span class="std std-ref">replication state</span></a>.</p>
</div>
<div class="section" id="setting-up-a-replica">
<h2>4.3. Setting up a replica<a class="headerlink" href="#setting-up-a-replica" title="Permalink to this headline">¶</a></h2>
<p>A server requires a valid snapshot (.snap) file. A snapshot file is created
for a server the first time that <code class="docutils literal"><span class="pre">box.cfg</span></code> occurs for it. If this first
<code class="docutils literal"><span class="pre">box.cfg</span></code> request occurs without a &quot;replication source&quot; clause, then the
server is a master and starts its own new cluster with a new unique UUID.
If this first <code class="docutils literal"><span class="pre">box.cfg</span></code> request occurs with a &quot;replication source&quot; clause,
then the server is a replica and its snapshot file, along with the cluster
information, is constructed from the write-ahead logs of the master.
Therefore, to start replication, specify <a class="reference internal" href="../configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a>
in a <code class="docutils literal"><span class="pre">box.cfg</span></code> request. When a replica contacts a master for the first time,
it becomes part of a cluster. On subsequent occasions, it should always contact
a master in the same cluster.</p>
<p>Once connected to the master, the replica requests all changes that happened
after the latest local LSN. It is therefore necessary to keep WAL files on
the master host as long as there are replicas that haven't applied them yet.
A replica can be &quot;re-seeded&quot; by deleting all its files (the snapshot .snap
file and the WAL .xlog files), then starting replication again - the replica
will then catch up with the master by retrieving all the master's tuples.
Again, this procedure works only if the master's WAL files are present.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replication parameters are &quot;dynamic&quot;, which allows the replica to become
a master and vice versa with the help of the
<a class="reference internal" href="../box/box_introspection.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a> statement.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The replica does not inherit the master's configuration parameters, such
as the ones that cause the <a class="reference internal" href="../configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">snapshot daemon</span></a>
to run on the master. To get the same behavior, one would have to set the
relevant parameters explicitly so that they are the same on both master and
replica.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replication requires privileges. Privileges for accessing spaces could be
granted directly to the user who will start the replica. However, it is more
usual to grant privileges for accessing spaces to a
<a class="reference internal" href="../box/authentication.html#authentication-rep-role"><span class="std std-ref">role</span></a>, and then grant the role to the user
who will start the replica.</p>
</div>
</div>
<div class="section" id="recovering-from-a-degraded-state">
<h2>4.4. Recovering from a degraded state<a class="headerlink" href="#recovering-from-a-degraded-state" title="Permalink to this headline">¶</a></h2>
<p>&quot;Degraded state&quot; is a situation when the master becomes unavailable - due to
hardware or network failure, or due to a programming bug. There is no automatic
way for a replica to detect that the master is gone forever, since sources of
failure and replication environments vary significantly. So the detection of
degraded state requires a human inspection.</p>
<p>However, once a master failure is detected, the recovery is simple: declare
that the replica is now the new master, by saying
<span class="ccode">box.cfg{... listen=</span><span class="ccodei">URI &lt;index-uri&gt;</span><span class="ccode">}</span>.
Then, if there are updates on the old master that were not propagated before
the old master went down, they would have to be re-applied manually.</p>
</div>
<div class="section" id="instructions-for-quick-startup-of-a-new-two-server-simple-cluster">
<h2>4.5. Instructions for quick startup of a new two-server simple cluster<a class="headerlink" href="#instructions-for-quick-startup-of-a-new-two-server-simple-cluster" title="Permalink to this headline">¶</a></h2>
<p>Step 1. Start the first server thus:</p>
<pre class="highlight literal-block">
box.cfg{listen = <em>uri#1</em>}
-- replace with more restrictive request
box.schema.user.grant('guest', 'read,write,execute', 'universe')
box.snapshot()
</pre>
<p>... Now a new cluster exists.</p>
<p>Step 2. Check where the second server's files will go by looking at its
directories (<a class="reference internal" href="../configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> for snapshot files, <a class="reference internal" href="../configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> for .xlog files).
They must be empty - when the second server joins for the first time, it
has to be working with a clean state so that the initial copy of the first
server's databases can happen without conflicts.</p>
<p>Step 3. Start the second server thus:</p>
<pre class="highlight literal-block">
box.cfg{
  listen = <em>uri#2</em>,
  replication_source = <em>uri#1</em>
}
</pre>
<p>... where <code class="docutils literal"><span class="pre">uri#1</span></code> = the <a class="reference internal" href="../configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> that the first server is listening on.</p>
<p>That's all.</p>
<p>In this configuration, the first server is the &quot;master&quot; and the second server
is the &quot;replica&quot;. Henceforth every change that happens on the master will be
visible on the replica. A simple two-server cluster with the master on one
computer and the replica on a different computer is very common and provides
two benefits: FAILOVER (because if the master goes down then the replica can
take over), or LOAD BALANCING (because clients can connect to either the master
or the replica for select requests). Sometimes the replica may be configured with
the additional parameter <a class="reference internal" href="../configuration/index.html#cfg-basic-read-only"><span class="std std-ref">read_only = true</span></a>.</p>
</div>
<div class="section" id="monitoring-a-replica-s-actions">
<span id="index-monitoring-replica-actions"></span><h2>4.6. Monitoring a replica's actions<a class="headerlink" href="#monitoring-a-replica-s-actions" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="../box/box_introspection.html#box-introspection-box-info"><span class="std std-ref">box.info</span></a> there is a <code class="docutils literal"><span class="pre">box.info.replication.status</span></code> field:
&quot;off&quot;, &quot;stopped&quot;, &quot;connecting&quot;, &quot;auth&quot;, &quot;follow&quot;, or &quot;disconnected&quot;. <br />
If a replica's status is &quot;follow&quot;, then there will be two more fields: <br />
<code class="docutils literal"><span class="pre">box.info.replication.idle</span></code> = the number of seconds the replica has been idle, <br />
<code class="docutils literal"><span class="pre">box.info.replication.lag</span></code> = the number of seconds the replica is behind the master.</p>
<p>In the <a class="reference internal" href="../../reference_lua/log.html#log"><span class="std std-ref">log</span></a> there is a record of replication activity.
If a primary server is started with:</p>
<pre class="highlight literal-block">
box.cfg{
  &lt;...&gt;,
  logger = <em>log file name</em>,
  &lt;...&gt;
}
</pre>
<p>then there will be lines in the log file, containing the word &quot;relay&quot;,
when a replica connects or disconnects.</p>
</div>
<div class="section" id="preventing-duplicate-actions">
<span id="index-preventing-duplicate-actions"></span><h2>4.7. Preventing duplicate actions<a class="headerlink" href="#preventing-duplicate-actions" title="Permalink to this headline">¶</a></h2>
<p>Suppose that the replica tries to do something that the master has already done.
For example: <br />
<code class="docutils literal"><span class="pre">box.schema.space.create('X')</span></code> <br />
This would cause an error, &quot;Space X exists&quot;.
For this particular situation, the code could be changed to: <br />
<code class="docutils literal"><span class="pre">box.schema.space.create('X',</span> <span class="pre">{if_not_exists=true})</span></code> <br />
But there is a more general solution: the
<code class="samp docutils literal"><span class="pre">box.once(</span><em><span class="pre">key</span></em><span class="pre">,</span> <em><span class="pre">function</span></em><span class="pre">)</span></code> method.
If <code class="docutils literal"><span class="pre">box.once()</span></code> has been called before with the
same <code class="samp docutils literal"><em><span class="pre">key</span></em></code> value, then <code class="samp docutils literal"><em><span class="pre">function</span></em></code>
is ignored; otherwise <code class="samp docutils literal"><em><span class="pre">function</span></em></code> is executed.
Therefore, actions which should only occur once during the
life of a replicated session should be placed in a function
which is executed via <code class="docutils literal"><span class="pre">box.once()</span></code>. For example:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">f</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space_creator&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="master-master-replication">
<h2>4.8. Master-master replication<a class="headerlink" href="#master-master-replication" title="Permalink to this headline">¶</a></h2>
<p>In the simple master-replica configuration, the master's changes are seen by
the replica, but not vice versa, because the master was specified as the sole
replication source. In the master-master configuration,
also sometimes called multi-master configuration,
it's possible to go both ways.
Starting with the simple configuration, the first server has to say:</p>
<pre class="highlight literal-block">
box.cfg{ replication_source = <em>uri#2</em> }
</pre>
<p>This request can be performed at any time --
<a class="reference internal" href="../configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> is a dynamic parameter.</p>
<p>In this configuration, both servers are &quot;masters&quot; and both servers are
&quot;replicas&quot;. Henceforth every change that happens on either server will
be visible on the other. The failover benefit is still present, and the
load-balancing benefit is enhanced (because clients can connect to either
server for data-change requests as well as select requests).</p>
<p>If two operations for the same tuple take place &quot;concurrently&quot; (which can
involve a long interval because replication is asynchronous), and one of
the operations is <code class="docutils literal"><span class="pre">delete</span></code> or <code class="docutils literal"><span class="pre">replace</span></code>, there is a possibility that
servers will end up with different contents.</p>
</div>
<div class="section" id="all-the-what-if-questions">
<h2>4.9. All the &quot;What If?&quot; questions<a class="headerlink" href="#all-the-what-if-questions" title="Permalink to this headline">¶</a></h2>
<p>Q: What if there are more than two servers with master-master? <br />
A: On each server, specify the <a class="reference internal" href="../configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> for all the
others. For example, server #3 would have a request: <br />
<span class="ccode">box.cfg{</span> <br />
&nbsp; &nbsp; &nbsp; <span class="ccode">replication_source = {</span><span class="ccodei">uri#1, uri#2</span><span class="ccode">}</span> <br />
<span class="ccode">}</span></p>
<p>Q: What if a server should be taken out of the cluster? <br />
A: For a replica, run <code class="docutils literal"><span class="pre">box.cfg{}</span></code> again specifying a blank replication source: <br />
<code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code></p>
<p>Q: What if a server leaves the cluster? <br />
A: The other servers carry on. If the wayward server rejoins, it will
receive all the updates that the other servers made while it was away.</p>
<p>Q: What if two servers both change the same tuple? <br />
A: The last changer wins. For example, suppose that server#1 changes the
tuple, then server#2 changes the tuple. In that case server#2's change
overrides whatever server#1 did. In order to keep track of who came last,
Tarantool implements a <a class="reference external" href="https://en.wikipedia.org/wiki/Vector_clock">vector clock</a>.</p>
<p>Q: What if two servers both insert the same tuple? <br />
A: If a master tries to insert a tuple which a replica has inserted
already, this is an example of a severe error. Replication stops.
It will have to be restarted manually.</p>
<p>Q: What if a master disappears and the replica must take over? <br />
A: A message will appear on the replica stating that the connection is
lost. The replica must now become independent, which can be done by
saying <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code>.</p>
<p>Q: What if it's necessary to know what cluster a server is in? <br />
A: The identification of the cluster is a UUID which is generated when the
first master starts for the first time. This UUID is stored in a tuple
of the <a class="reference internal" href="../box/box_space.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a> system space. So to see it, say:
<code class="docutils literal"><span class="pre">box.space._schema:select{'cluster'}</span></code></p>
<p>Q: What if it's necessary to know what other servers belong in the cluster? <br />
A: The universal identification of a server is a UUID in <code class="docutils literal"><span class="pre">box.info.server.uuid</span></code>.
The ordinal identification of a server within a cluster is a number in <code class="docutils literal"><span class="pre">box.info.server.id</span></code>.
To see all the servers in the cluster, say:
<code class="docutils literal"><span class="pre">box.space._cluster:select{}</span></code>. This will return a table with all
{server.id, server.uuid} tuples for every server that has ever joined
the cluster.</p>
<p>Q: What if one of the server's files is corrupted or deleted? <br />
A: Stop the server, destroy all the database files (the ones with extension
&quot;snap&quot; or &quot;xlog&quot; or &quot;.inprogress&quot;), restart the server, and catch up
with the master by contacting it again (just say
<code class="docutils literal"><span class="pre">box.cfg{...replication_source=...}</span></code>).</p>
<p>Q: What if replication causes security concerns? <br />
A: Prevent unauthorized replication sources by associating a password with
every user that has access privileges for the relevant spaces, and every
user that has a replication <a class="reference internal" href="../box/authentication.html#authentication-rep-role"><span class="std std-ref">role</span></a>. That way,
the <a class="reference internal" href="../configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> for the <a class="reference internal" href="../configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a>
parameter will always have to have the long form <br />
<code class="docutils literal"><span class="pre">replication_source='username:password&#64;host:port'</span></code></p>
<p>Q: What if advanced users want to understand better how it all works? <br />
A: See the description of server startup with replication in the
<a class="reference internal" href="../app/b_internals.html#b-internals-replication"><span class="std std-ref">Internals</span></a> appendix.</p>
</div>
<div class="section" id="hands-on-replication-tutorial">
<h2>4.10. Hands-on replication tutorial<a class="headerlink" href="#hands-on-replication-tutorial" title="Permalink to this headline">¶</a></h2>
<p>After following the steps here, an administrator will have experience creating
a cluster and adding a replica.</p>
<p>Start two shells. Put them side by side on the screen. (This manual has a tabbed
display showing &quot;Terminal #1&quot;. Click the &quot;Terminal #2&quot; tab to switch to the
display of the other shell.)</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-1">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-1-content">
<div class="b-documentation-tab container" id="terminal-1-1">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-1-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On the first shell, which we'll call Terminal #1, execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_1/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The result is that a new cluster is set up, and the server's UUID is displayed. Now the
screen looks like this: (except that UUID values are always different):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-2">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-2-content">
<div class="b-documentation-tab container" id="terminal-2-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">$</span> ~/tarantool/src/tarantool: version 1.7.0-1724-g033ed69
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="go">&lt;...&gt; I&gt; creating ./00000000000000000000.xlog.inprogress&#39;</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-2-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On the second shell, which we'll call Terminal #2, execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ~/tarantool_test_node_2/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The result is that a replica is set up. Messages appear on Terminal #1
confirming that the replica has connected and that the WAL contents have
been shipped to the replica. Messages appear on Terminal #2 showing that
replication is starting. Also on Terminal#2 the _cluster UUID values are
displayed, and one of them is the same as the _cluster UUID value that was displayed
on Terminal #1, because both servers are in the same cluster.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-3">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-3-content">
<div class="b-documentation-tab container" id="terminal-3-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-3-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On Terminal #1, execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-4">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-4-content">
<div class="b-documentation-tab container" id="terminal-4-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-4-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The creation and insertion were successful on Terminal #1. Nothing has happened
on Terminal #2.</p>
<p>On Terminal #2, execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this (remember to click on the &quot;Terminal #2&quot; tab when looking at Terminal #2 results):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-5">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-5-content">
<div class="b-documentation-tab container" id="terminal-5-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-5-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The selection and insertion were successful on Terminal #2. Nothing has
happened on Terminal #1.</p>
<p>On Terminal #1, execute these Tarantool requests and shell commands:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> os.exit<span class="o">()</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">$</span> ls -l ~/tarantool_test_node_2
</pre></div>
</div>
<p>Now Tarantool #1 is stopped. Messages appear on Terminal #2 announcing that fact.
The <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-l</span></code> commands show that both servers have made snapshots, which have
similar sizes because they both contain the same tuples.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-6">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-6-content">
<div class="b-documentation-tab container" id="terminal-6-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-6-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On Terminal #2, ignore the error messages,
and execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this (ignoring the error
messages):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-7">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-7-content">
<div class="b-documentation-tab container" id="terminal-7-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-7-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 coio.cc:352 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 6, aka 127.0.0.1:58734, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Terminal #2 has done a select and an insert, even though Terminal #1 is down.</p>
<p>On Terminal #1 execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Now the screen looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-8">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-8-content">
<div class="b-documentation-tab container" id="terminal-8-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;Tuple inserted on Terminal #1&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-8-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The master has reconnected to the cluster, and has NOT found what the replica
wrote while the master was away. That is not a surprise -- the replica has not
been asked to act as a replication source.</p>
<p>On Terminal #1, say:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The screen now looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-9">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-9-content">
<div class="b-documentation-tab container" id="terminal-9-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">[28987] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="go">[22612] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="go">[22612] main/101/interactive I&gt; set &#39;replication_source&#39; configuration</span>
<span class="go">        option to &quot;replicator:password@localhost:3302&quot;</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; connected to 1.7.0 at 127.0.0.1:3302</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; authenticated</span>
<span class="go">[22612] wal/101/main I&gt; creating `./00000000000000000008.xlog.inprogress&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; recover from `./00000000000000000008.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-9-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main recovery.cc:211 W&gt; file</span>
<span class="go">     `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
</div>
<script>
    register_replication_tab(1);
    register_replication_tab(2);
    register_replication_tab(3);
    register_replication_tab(4);
    register_replication_tab(5);
    register_replication_tab(6);
    register_replication_tab(7);
    register_replication_tab(8);
    register_replication_tab(9);
</script></div>
<p>This shows that the two servers are once again in synch, and that each server
sees what the other server wrote.</p>
<p>To clean up, say &quot;<code class="docutils literal"><span class="pre">os.exit()</span></code>&quot; on both Terminal #1 and Terminal #2, and then
on either terminal say:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> rm -R ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_2
</pre></div>
</div>
</div>
</div>


          
          
  <div id="disqus_thread"></div>
  <script>
    // DON'T EDIT
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//tarantooldb.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
      comments powered by Disqus.
    </a>
  </noscript>

          
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="../box/vinyl_diff.html"
           class="b-prev b-ellipsis"
           title="3.4.12. Differences between memtx and vinyl storage engines">3.4.12. Differences between memtx and vinyl storage engines</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../../_sources/book/replication/index.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="../configuration/index.html"
           class="b-next b-ellipsis"
           title="5. Configuration reference">5. Configuration reference</a>
      </div>
    
    </div>
  
</div>
      </div>
    </div>
  

      </div>
    </div>

  <!-- FOOTER > -->
  
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      <li class="b-menu-item">
        <a href="/" class="b-menu-item-url">Overview</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/doc/" class="b-menu-item-url">Documentation</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/download.html" class="b-menu-item-url">Download</a>
      </li>
    
      <li class="b-menu-item">
        <a href="/careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      <li class="b-menu-item">
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

  <!-- < FOOTER -->
  </body>
</html>

